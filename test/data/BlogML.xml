<?xml version="1.0" encoding="utf-8"?>
<blog root-url="/" date-created="2010-10-17T10:54:26" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns="http://www.blogml.com/2006/09/BlogML">
  <title type="text"><![CDATA[lucisferre]]></title>
  <sub-title type="text"><![CDATA[...csharp... ...csharp run... ...run csharp run...]]></sub-title>
  <authors>
    <author id="chrisn" date-created="2010-10-17T10:54:26" date-modified="2010-10-17T10:54:26" approved="true" email="chnicola@gmail.com">
      <title type="text"><![CDATA[chrisn]]></title>
    </author>
  </authors>
  <extended-properties>
    <property name="CommentModeration" value="Anonymous" />
    <property name="SendTrackback" value="Yes" />
  </extended-properties>
  <categories>
    <category id="05aa3b7e-5327-4ed2-8c05-ba7f9675b475" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[ALT.NET]]></title>
    </category>
    <category id="5c2b051b-f6df-4b41-baa8-63eb610e5201" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[ASP.NET MVC]]></title>
    </category>
    <category id="cf150060-6a7a-4e62-98a3-d6ddc70a922a" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Blogging]]></title>
    </category>
    <category id="5cd0be3a-3124-4224-9a21-46b4befb628f" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Coding]]></title>
    </category>
    <category id="1091489b-35f0-473f-8e03-c2b8aa031f8c" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Agile]]></title>
    </category>
    <category id="832202cb-b074-4686-8c64-efb0d3a1aa9c" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[TDD]]></title>
    </category>
    <category id="0ae10b56-7656-4192-bd7d-4aac5a14e403" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[nHibernate]]></title>
    </category>
    <category id="80a93719-d0b6-493d-a18c-d82537b759e3" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Tools and Tricks]]></title>
    </category>
    <category id="02e1c448-89bc-4ed3-b7eb-616a79502dec" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Events]]></title>
    </category>
    <category id="60961e3d-020b-4362-8aad-91d6b33f1261" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Food]]></title>
    </category>
    <category id="fd020249-be87-49a8-bc2b-2a5ddbb8ffaa" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Recipies]]></title>
    </category>
    <category id="2d8fc2fe-cb40-4d21-b2ec-5400c1693ff4" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[From other blogs]]></title>
    </category>
    <category id="d259b49c-a79d-456b-97d9-c4b585a4a0ef" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Graphite]]></title>
    </category>
    <category id="cf1f8747-baf3-4952-8d1a-659dfad1e794" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[iPhone (and other toys)]]></title>
    </category>
    <category id="0a5ca7b4-d45c-4df1-9e90-8928262d248b" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Landscapes]]></title>
    </category>
    <category id="38f5fc4d-2f6a-4f4d-9015-9d44ae6d607b" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Music]]></title>
    </category>
    <category id="0a32c036-5cbd-463a-a067-e91944e45d05" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[nCQRS]]></title>
    </category>
    <category id="69991539-4bfc-4cb9-a66d-09f836c0b344" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[News]]></title>
    </category>
    <category id="2c07e59a-ca1c-4daa-8218-0cb00efde8b7" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Opinion]]></title>
    </category>
    <category id="1b70b1a2-2a7c-4e85-a6ba-6accc0b980f8" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Politcs]]></title>
    </category>
    <category id="b483fd48-b2f5-44af-b1ae-6fb4648d5bc2" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Photography]]></title>
    </category>
    <category id="0ef29b7d-d0ff-4312-858e-fdc6791dd80b" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[City Life]]></title>
    </category>
    <category id="22488829-47f6-4140-bd30-5a9dbe7e89fd" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[s#arp architecture]]></title>
    </category>
    <category id="ac3232d9-d92c-492b-ba4a-12bd53e6a9d1" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[The City]]></title>
    </category>
    <category id="f464751e-12eb-4fe0-98d4-ba9abc8703c8" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Going out]]></title>
    </category>
    <category id="c9544665-8ae2-41a0-b1b5-93a70ae5525f" date-created="0001-01-01T00:00:00" date-modified="0001-01-01T00:00:00" approved="true" parentref="0">
      <title type="text"><![CDATA[Travel]]></title>
    </category>
  </categories>
  <posts>
    <post id="42db730b-0562-4418-af03-8ce415e3295b" date-created="2010-09-22T20:11:16" date-modified="2010-09-22T20:31:50" approved="true" post-url="/post/2010/09/22/My-pragma-just-killed-your-dogma.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[My pragma just killed your dogma]]></title>
      <content type="text"><![CDATA[<p><em><a href="http://www.lucisferre.net/image.axd?picture=beware-of-dogma_2.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 6px; display: inline; border-top: 0px; border-right: 0px" title="beware-of-dogma" border="0" alt="beware-of-dogma" align="right" src="http://www.lucisferre.net/image.axd?picture=beware-of-dogma_thumb_2.jpg" width="166" height="169" /></a> I realize that "pragma" isn't really a word outside of compiler directives but it is the root of "pragmatism" and it made for a catchy title.</em></p>  <p>In the world of software development there may be no statement that can so easily end an argument than to dub it a "religious debate."&#160; I would tend to argue this is akin to <a href="http://en.wikipedia.org/wiki/Godwin's_law">Godwin's Law</a> and could be expressed as:</p>  <blockquote>   <p>Arguments around programming often wind up with someone claiming hopelessness as it is clearly a "religious debate".&#160; This introduces an artificial stalemate by suggesting that neither side will ever be swayed.&#160; It further implies that both sides are right (and/or wrong) together. [more]</p> </blockquote>  <p>There are definitely some religious debates in programming which one could fairly argue are really at a stalemate.&#160; The age-old Vim v. Emacs is a classic, Python v. Ruby - the languages not the frameworks around them - is a hot one too.&#160; There are certainly others, Java v. C# has kind of died down I think.&#160; However, the generic assumption that any time two programmers disagree vehemently about something that must be "religious" is somewhat prevalent.</p>  <p>This has had me thinking about whether my opinions mostly center on issues that are merely "programming religion" and really have no discernable merit over the contrary.&#160; Which in turn has caused me to question how much of what I believe to be the <em>right</em> way or the <em>best</em> tool is simply dogmatic - hence, the use of the religious metaphor for this particular stream of consciousness that's turning into a blog post.</p>  <p>I'm going to make the bold assertion that I do in fact regularly question my own assumptions - eventually anyway, since anyone who's had an argument with me before probably has doubts about that claim - and my end goal is always to find what works, but with an eye out for better ways to do things.&#160; Challenging assumptions will always involve some amount of trying different ways of doing things. So I'd like to think I lean on the pragmatic side, but at the same time, there are certain things I certainly feel pretty dogmatic about.</p>  <h2></h2>  <p>Here are a few of my "religious" coding beliefs:</p>  <ol>   <li>I believe Git to be a superior SCM system in every respect even though I have only briefly tried Hg and only used SVN for a few years (longer than I've used Git though). </li>    <li>I believe in <a href="http://en.wikipedia.org/wiki/The_C_Programming_Language_(book)">K&amp;R</a> and <a href="http://www.paulgraham.com/power.html">concise coding style</a> and most (if not all) of what is preached in Uncle Bob's book.&#160; And I feel most of the <a href="https://computing.llnl.gov/linux/slurm/coding_style.pdf">Kernel style guide</a> still pretty much apply to all C-like languages: C#, Java, Javascript, etc (I've really never used C++ so I'll keep my mouth shut on that one).</li>    <li>I believe that consistent coding style is important, even if only for the sake of consistency, though should arguments arise regarding style, see #2.</li>    <li>I believe continuous integration and deployment should be one of the most important practices of any team working on code along with a strong dedication to TDD. </li>    <li>I believe text editors like Vim and Emacs are worth learning even if they offer a major learning curve but I don't believe I will ever care which one is best (though I've chosen to learn Vim). </li>    <li>I believe that being a polyglot (both in languages, frameworks and tools) is an important and necessary part of programming, and will be for the foreseeable future. </li>    <li>I believe that MVC is currently the <em>right </em>way to do web development in .NET and that anyone using WebForms when they have other options is kidding themselves.&#160; At the same time I don't believe that .NET MVC is necessarily the <em>best </em>way to do web development but it works. </li>    <li>I believe that using open source frameworks to do software development is awesome in uncountable ways and should be embraced by all. </li>    <li>Finally, I believe that VB and VB.NET are fugly. that is all.</li> </ol>  <p>While I feel pretty strongly about all of these things, and you could even accuse me of a dogmatic devotion to them, I've developed these "beliefs" out of a practice of pragmatism and being willing to try new and sometimes better ways of doing things.&#160; Typically, after taking the advice of others when they've suggested things they've found to be better.&#160; Nothing will ever perfect, so we can safely assume that there will always be new and frequently better ways to do what we do available to us -though Vim and Emacs seem to be defying the odds.</p>  <p>I will freely admit that I do enjoy change and trying out new ways of doing my work.&#160; For me, trying out a new FOSS framework is like getting a free Christmas present (one which occasionally sucks like getting a sweater when your 5).&#160; Though to be fair, software development is still a fairly recent calling, so perhaps maybe I will embrace change less and become more dogmatic as time progresses.&#160; I expect perhaps more dogmatic, but I doubt I will enjoy change and the newness of things any less.</p>  <p>One could argue - and many have - that too much change slows things, hampers efficiency and your ability to deliver working software.&#160; However, I've almost only ever found the opposite to be true, and I can tolerate quite a lot of change.&#160; Sure, you could take change to an unhealthy extreme, but change is still hard, time consuming and tiring.&#160; I can't say I imagine there are a lot of people who have the energy to embrace that much change.</p>  <p>"Discovering better ways of developing software," as the Agile manifesto begins, is rewarding in so many ways.&#160; It's what keeps me both excited and interested in what I do, and as a bonus it has always seemed to work out to increase both the efficiency and quality of the software I deliver.&#160; While I would never be able to show it with numbers, I'd find it hard to believe that it has been wasted time.</p>]]></content>
      <post-name type="text"><![CDATA[My pragma just killed your dogma]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <tags>
        <tag ref="coding" />
        <tag ref="agile" />
        <tag ref="code style" />
        <tag ref="git" />
        <tag ref="asp.net mvc" />
      </tags>
      <comments>
        <comment id="c9ceebc3-1dc4-4939-9283-2056c0bb76e8" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-22T21:51:13" date-modified="2010-09-22T21:51:13" approved="true" user-name="Justice~!" user-email="justice.gray@gmail.com" user-ip="96.52.44.230" user-url="">
          <title type="text"><![CDATA[re: My pragma just killed your dogma]]></title>
          <content type="text"><![CDATA[I agreed with almost all of your points, and the only reason I didn't totally agree with #1 is simply that I haven't played around with git.   My endorsement isn't proof that you're right, but...well, you are right!!  :)  Nothing wrong being dogmatic when you're dogmatic about that stuff.]]></content>
        </comment>
        <comment id="d8be0460-b875-41d3-8b89-33dbad079f08" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-23T09:18:16" date-modified="2010-09-23T09:18:16" approved="true" user-name="Stefan Moser" user-email="stefan.moser@gmail.com" user-ip="206.12.49.225" user-url="http://stefanmoser.blogspot.com/">
          <title type="text"><![CDATA[re: My pragma just killed your dogma]]></title>
          <content type="text"><![CDATA[Great post Chris! However, like claiming dogma, I've found that nothing kills a healthy debate like one side either claiming that they're just being pragmatic, or accusing the other side of not being pragmatic.  Pragmatism has become a warning word for me.]]></content>
        </comment>
        <comment id="a9e52796-249e-4840-82a0-ecaf0f832996" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-23T10:59:17" date-modified="2010-09-23T10:59:17" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="76.77.75.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: My pragma just killed your dogma]]></title>
          <content type="text"><![CDATA[Agreed, and I hate buzzwords as much as anyone, but the idealist in me says they should still retain their original meaning even if they are often abused.  Take &quot;agile&quot;, it's overused so much that many of the people who originated the word and concepts around it have called for it's death.  But how else should we refer to the concepts from the agile manifesto.  I'd love a new word to take the pressure off, (lean seems popular these days, but I'd rather use it for things that actually refer to 'leanness' vs 'agility') but eventually those will be corrupted too.

It does seem somewhat subjective though.  In the end I think the only person who can decide if we are being pragmatic or dogmatic is ourselves.  It is definitely subjective.  Likewise, the only people we have to convince of our own pragmatism is ourselves.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="55691388-79df-45e0-b20f-9a866a0fa05d" date-created="2010-08-28T14:43:33" date-modified="2010-08-28T14:43:33" approved="true" post-url="/post/2010/08/28/A-big-thank-you-to-TekPub.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
     <title type="text"><![CDATA[A big thank you to TekPub]]></title>
     <content type="text"><![CDATA[<p>If you have not heard of TekPub yet, I recommend you give it a whirl.&#160; <a href="http://www.tekpub.com/">TekPub</a> is a site with video learning for various software development technologies.&#160; Topics include MVC, nHibernate, Git, JQuery, Rails and more.</p>  <p>The videos are a great way to get started but they are also fairly in depth.&#160; Most series contain 8 or more videos so they are very good for taking your first deep dive into a particular technology.</p>  <p>TekPub also gives back by <a href="http://blog.tekpub.com/user-group-sponsorship/">sponsoring various user groups</a>, now including <a href="http://altnetvan.grou.ps">ALT.NET Vancouver</a>.&#160; They will be providing us with one-day subscription coupons which we will start to give away at monthly meet-ups and events.&#160; So on behalf of everyone who is a part of ALT.NET Vancouver I want to thank TekPub.</p>]]></content>
     <post-name type="text"><![CDATA[A big thank you to TekPub]]></post-name>
     <authors>
      <author ref="chrisn" />
     </authors>
     <categories>
      <category ref="05aa3b7e-5327-4ed2-8c05-ba7f9675b475" />
     </categories>
     <tags>
      <tag ref="alt.net" />
      <tag ref="tekpub" />
     </tags>
    </post>
    <post id="dbc166b0-3e4b-41ec-8bb8-0aae515bb883" date-created="2010-08-28T10:46:19" date-modified="2010-08-28T10:54:09" approved="true" post-url="/post/2010/08/28/Summere28099s-almost-over-ite28099s-conference-time.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Summer's almost over, it's conference time]]></title>
      <content type="text"><![CDATA[<p>Well it's almost Fall in Vancouver, and that means both <a href="http://www.techdays.ca/speakers">TechDays</a> and the <a href="http://www.agilevancouver.ca/">Agile Vancouver</a>: Much Ado about Agile conferences are coming up.&#160; Last year unfortunately I missed TechDays, but I am fortunate this year to have the opportunity to go to both.</p>  <p>I will actually be speaking at TechDays in the "Local Flavors" track, which consists of speakers from here in Vancouver.&#160; I'll be giving a talk on CQRS and how to leverage the pattern to achieve greater reversibility in software designs.</p>  <p>I recently received the draft program for Agile Vancouver and once again it has an amazing line-up of speakers.&#160; I don't want to spill the beans before they post it though so I'll post a link as soon as I know it's official.&#160; I can say that there will be an Open Spaces portion on the Friday that will be faciliated by <a href="http://adventuresinagile.blogspot.com/">Adam Dymitruk</a>, <a href="http://robertblogs.wordpress.com/">Robert Reppel</a> and myself.&#160; </p>  <p>I am excited to be involved in both Agile Vancouver and TechDays.&#160; I highly recommend attending both of them, they are great opportunities to learn and discuss and on the topic of discussions, there is a good chance that there will be one or two 'extra-curricular' (think #altnetbeers) events happening.&#160; So be sure to keep an eye out for announcements either here or at <a href="http://altnetvan.grou.ps">ALT.NET Vancouver</a>.</p>  <p>Time to get back to preparing slides.</p>  <table border="0" cellspacing="0" cellpadding="0" width="400"><tbody>     <tr>       <td valign="top" width="200"><a href="http://www.lucisferre.net/image.axd?picture=logo.gif"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="logo" border="0" alt="logo" align="left" src="http://www.lucisferre.net/image.axd?picture=logo_thumb.gif" width="215" height="95" /></a></td>        <td valign="top" width="200"><a href="http://www.lucisferre.net/image.axd?picture=techdays-2010.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="techdays_canada" border="0" alt="techdays_canada" align="right" src="http://www.lucisferre.net/image.axd?picture=techdays-2010_thumb.png" width="220" height="88" /></a></td>     </tr>   </tbody></table>]]></content>
      <post-name type="text"><![CDATA[Summer's almost over, it's conference time]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1091489b-35f0-473f-8e03-c2b8aa031f8c" />
        <category ref="05aa3b7e-5327-4ed2-8c05-ba7f9675b475" />
        <category ref="02e1c448-89bc-4ed3-b7eb-616a79502dec" />
      </categories>
      <tags>
        <tag ref="TechDays" />
        <tag ref="Agile" />
        <tag ref="alt.net" />
        <tag ref="CQRS" />
      </tags>
    </post>
    <post id="c5c9f785-534b-42cc-bb7b-07538b93ff21" date-created="2010-08-02T10:41:42" date-modified="2010-08-02T11:18:08" approved="true" post-url="/post/2010/08/02/CQRS-From-NoSQL-to-NoDB.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[CQRS: From NoSQL to NoDB]]></title>
      <content type="text"><![CDATA[<a href="http://www.lucisferre.net/image.axd?picture=ncqrs.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 6px; display: inline; border-top: 0px; border-right: 0px" title="ncqrs" border="0" alt="ncqrs" align="right" src="http://www.lucisferre.net/image.axd?picture=ncqrs_thumb.jpg" width="106" height="106" /></a> This weekend I spent most of my Sunday working on a filesystem based provider for nCQRS, something largely inspired by some work @adymitruk did recently.&#160; I've done this for a few reasons:   <p></p>  <ul>   <li>To provide a quick and simple way for people to get up and running with NCQRS and test locally </li>    <li>To allow developers minimize their reliance on third-party DB providers </li>    <li>Make nCQRS more web-hosting friendly (you won't find many providers supporting .NET and MongoDB) </li>    <li>Make a point, that using CQRS is not nearly as complex an architecture as <a href="http://blog.robustsoftware.co.uk/2009/12/cqrs-crack-for-architecture-addicts.html">some out there would have you believe</a>. </li> </ul>  <p>The core idea behind <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> is not to facilitate the CQRS pattern (though they often go hand in hand), rather it's to recognize that a SQL database is not always the right tool for the job.&#160; Similarly, there are likely to be scenarios where using <em>anything </em>more than some data files is overkill, or merely inconvenient and that is the idea behind the NoDB provider.&#160; Just store the events in text files, of course the query-side data can still go wherever you want it to.</p>  <p><em>(Note that I'm using the term 'database' here to refer to sophisticated database providers, arguably even file-based data storage is a form of database.)</em></p>  <p>[more]</p>  <p>The design of NoDB is extremely simple.&#160; Each aggregate root gets it's own individual file for event history.&#160; Files are divided into folders and filenames based on their Guid for example:</p>  <blockquote>   <p>/a1/8156bf-fa5a-422e-91da-2a6b30e1fc6c</p> </blockquote>  <p>The first line of the file tells us how many events there are in the store in a fixed length long, this is updated every time we append a new event.&#160; Events are appended one line at a a time, so we have one line for each event.</p>  <p>The provider also re-uses the existing support in the nCQRS framework that allow us to serialize/deserialize the event data to JSON.&#160; An event file is pretty much human readable and looks like this:</p>  <div><script src="http://gist.github.com/504981.js"></script></div>  <p>There is some very basic support for multi-threaded read/write access.&#160;&#160; Multiple readers can read the event store, but only one writer at a time can write.&#160; @SzymonPobiega pointed out to me that this is similar to <a href="http://ayende.com/Blog/archive/2010/06/18/building-data-stores-ndash-append-only.aspx">Ayende's append only data store</a> except that in NoDB readers must wait for an active writer.</p>  <p>While this seems like a disadvantage it actually isn't.&#160; In CQRS the event store is for the command side only, we don't use it to query data ever.&#160; So the only reason we would read the data store would be to begin executing a command against an aggregate root.&#160; If we don't wait for the writer we will have a stale version of the aggregate and this will guarantee a concurrency exception when we try to execute the command against the stale aggregate root. </p>  <p>Typically, you will want to have command processed via a queue anyways so threading concurrency issues like this will be abstracted away behind the queue.</p>  <p>I welcome people to take a look at <a href="http://github.com/lucisferre/ncqrs">my fork on GitHub</a> and checkout the code (currently it is under the NoDB branch).&#160; I would love to hear about any comments and criticisms.&#160; In the meantime I am going to keep working away, I plan to try to add snapshot support today.</p>]]></content>
      <post-name type="text"><![CDATA[CQRS: From NoSQL to NoDB]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0a32c036-5cbd-463a-a067-e91944e45d05" />
      </categories>
      <tags>
        <tag ref="nosql CQRS nCQRS NoDB" />
      </tags>
      <comments>
        <comment id="93ab0c64-21d6-44e0-86e8-e5d2877ec43b" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-08-02T12:13:00" date-modified="2010-08-02T12:13:00" approved="true" user-name="Jonathan Oliver" user-email="jonathan.s.oliver42+blogs@gmail.com" user-ip="67.214.231.210" user-url="http://jonathan-oliver.blogspot.com/">
          <title type="text"><![CDATA[re: CQRS: From NoSQL to NoDB]]></title>
          <content type="text"><![CDATA[There is one small failure condition that you may want to consider to make the file-based storage more resilient during things like power failures.

You'll actually want to have the header row duplicated.  The idea behind this is that you write the header and then flush (fsync) and then write the second header and flush again.  This is very similar to what CouchDB does for transactional consistency.  In most cases this is performant enough.  If you really need high performance, there are techniques that you can use that update the header information asynchronously and are still fault tolerant and fully consistent.

One other thing that Greg Young does in his event storage is to prefix the length of the serialized event to each &quot;row&quot;.  In this way, you know how far to read instead of worrying about line break quirks.

]]></content>
        </comment>
        <comment id="d3437405-894a-48e7-82ef-2f31e353fe29" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-08-03T00:21:54" date-modified="2010-08-03T00:21:54" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: CQRS: From NoSQL to NoDB]]></title>
          <content type="text"><![CDATA[In taking a very TDD approach I realize I will miss many potentially obvious fault tolerance scenarios.  I would like to try to have tests for each of these scenarios and I am currently working out how to write those tests.  I like your idea though, I definitely want to have a way to detect and handle potential corruption though.

One thing I would really like to know is what people think about the design as far as performance.  Is there a more efficient way to read/write to files than what I've done?  I should point out that when I posted this my implementation was actually broken (though the tests passed).  I made some incorrect assumptions which meant I set up the tests wrong, I have since corrected these after testing it out in the sample app.]]></content>
        </comment>
        <comment id="4e1abddd-9cd8-4f53-8d3e-c4ee18bc982e" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-08-03T07:58:46" date-modified="2010-08-03T07:58:46" approved="true" user-name="Jonathan Oliver" user-email="jonathan.s.oliver42+blogs@gmail.com" user-ip="67.214.231.210" user-url="http://jonathan-oliver.blogspot.com/">
          <title type="text"><![CDATA[re: CQRS: From NoSQL to NoDB]]></title>
          <content type="text"><![CDATA[The way that Greg does it is that he has a single file for all aggregates, but he has said that one file per aggregate would work great.

In general, what he does is he has a single process that is writing the file (let's assume one file per aggregate).  We he serializes all events for the transaction, he writes out the following into the file (which is *not* human readable):

1. The number of events as part of the commit.
2. The contents of each event:
 a) The number of bytes in the event
 b) The event index (sequence)
 c) The bytes for the serialized data (for which he uses his own custom serialization)

The file is written in an append-only manner.  When the application calls commit, it writes out the data to the file.  In case of some kind of hardware/power failure, the transaction is either fully written (and committed) or partially written which means that it has failed and will be over-written on the next attempt to commit.

Once committed, he has a thread that updates a header file which points to the last-known good position in the file.  In other words, this header (which can be in a completely separate file) points to the end of the file for which a transaction has been committed.

When the event store starts up, he looks at the header file, then reads the event log from the position in the header file till the end of the stream to see if there are any committed transactions that haven't updated the header file yet.

When a query comes in, typically it reads from the end of the file to the beginning.  Essentially it reads backwards.  The only query operation that you need to support is to get the events for a particular aggregate starting at version X.

Snapshots should be kept in a separate file and are done asynchronously.  They can be done in much the same manner as the events.

There is definitely a lot to consider in building a production-grade, high-performance event store.  Your implementation would work though and would still be relatively high performance.  But it would be a lot of work to make it extremely high performance.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="96ea0904-f300-43b1-b0e9-b5f67acaa458" date-created="2010-07-21T19:47:00" date-modified="2010-07-21T19:49:13" approved="true" post-url="/post/2010/07/21/Simple-tools-make-integration-testing-easy.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Simple tools make integration testing easy]]></title>
      <content type="text"><![CDATA[<p>&nbsp;</p>
<div id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:4a6a77a4-05e3-491c-8bd3-eaa947a86245" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">Technorati Tags: <a rel="tag" href="http://technorati.com/tags/TDD">TDD</a>,<a rel="tag" href="http://technorati.com/tags/.NET">.NET</a></div>
<p>I've been working on a small library that requires using an FTP client to upload and access files stored on a remote FTP.&nbsp; Now I want to do TDD, but the .NET FTP libraries (FtpWebRequest/FtpWebResponse) are absolutely untestable.&nbsp; They have no interfaces, you can't mock them at all (though I've heard TypeMock may be capable of doing this) to TDD they are an immovable object.&nbsp; I should point out my team has also committed to maintaining over 80% code coverage on things like libraries, APIs and services and for this library the FTP related code is currently about 50% of the code.</p>
<p>&nbsp;</p>
<p>Even if I wanted to simply ignore this from coverage metrics, that would still leave a lot of code that will need to be written and likely maintained without <em>any</em> tests.</p>
<p>Now, you could, if you wanted to, simply wrap the .NET FTP classes and delegate all their members (or just the ones you needed) but to successfully TDD you will need to wrap and delegate three different classes (including the WebException class) and perform a little C# wizardry, not an entirely tall task (particularly if you have ReSharper) but an unattractive one at best.</p>
<p>After traversing down the wrapper route a little way I switched gears and figured the simplest solution would be, in fact, to put all the FTP responsibility behind a single interface and implementation class and then just write very simple "<em>almost unit"</em> integration tests against the implementation.&nbsp; The integration tests could then be run quickly against a local FTP daemon even on the build server.&nbsp; However I still didn't feel like setting up an FTP server under IIS on the build server (or on my local machine).&nbsp; I wanted something quick, simple and small enough that I could include it in the project and check it in.</p>
<p>Whenever I work with nHibernate, I often write <a href="http://ayende.com/Blog/archive/2009/04/28/nhibernate-unit-testing.aspx">simple DB tests</a> against a SQLite in memory database, so I figured there might be something similar I use for an FTP testing (at this point I feel it necessary to point of that if this was Linux this would have been a piece of cake).&nbsp; After about 15 minutes on Google I found <a href="http://www.sentex.net/~mwandel/ftpdmin/">FTPDMIN</a> a 65kb executable, no-frills FTP daemon.&nbsp; Just for a few laughs here is what my integration tests look like:</p>
<div id="codeSnippetWrapper" style="border: 1px solid silver; text-align: left; padding: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; width: 97.5%; font-family: 'Courier New',courier,monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; cursor: text;">
<div id="codeSnippet" style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">[TestFixture]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> FtpServiceIntegrationTests</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">{</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">private</span> Process _ftpd;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">private</span> FtpService _ftpService;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">string</span> _filename;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">string</span> _server;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">private</span> <span style="color: #0000ff">readonly</span> <span style="color: #0000ff">byte</span>[] _data = <span style="color: #0000ff">new</span> <span style="color: #0000ff">byte</span>[10];</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    </pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [TestFixtureSetUp]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> OneTimeSetup()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        <span style="color: #0000ff">new</span> Random().NextBytes(_data);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        var pi = <span style="color: #0000ff">new</span> ProcessStartInfo(<span style="color: #006080">"ftpdmin.exe"</span>, <span style="color: #006080">"./"</span>)</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">            CreateNoWindow = <span style="color: #0000ff">true</span>,</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">            UseShellExecute = <span style="color: #0000ff">false</span></pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        };</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpd = Process.Start(pi);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpService = <span style="color: #0000ff">new</span> FtpService(<span style="color: #0000ff">new</span> NetworkCredential(<span style="color: #006080">"me@localhost.com"</span>, <span style="color: #006080">""</span>));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        var address = Dns.GetHostAddresses(Dns.GetHostName())[0];</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _server = <span style="color: #006080">"ftp://"</span> + address;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _filename = <span style="color: #006080">"Test.txt"</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanUploadData()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpService.Upload(<span style="color: #0000ff">new</span> MemoryStream(_data), _server + <span style="color: #006080">"/"</span> + _filename);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        Assert.That(_ftpService.FileExists(_server + <span style="color: #006080">"/"</span> + _filename));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanListFiles()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpService.Upload(<span style="color: #0000ff">new</span> MemoryStream(_data), _server + <span style="color: #006080">"/"</span> + _filename);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        var files = _ftpService.ListFiles(_server);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        Assert.That(files.Any(f =&gt; f.ToLower() == _filename.ToLower()));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanCreateFolders()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        var randnum = <span style="color: #0000ff">new</span> Random().Next(100);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpService.CreateFolder(_server + <span style="color: #006080">"/"</span> + <span style="color: #006080">"Folder"</span> + randnum);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        Assert.That(_ftpService.FolderExists(_server + <span style="color: #006080">"/"</span> + <span style="color: #006080">"Folder"</span> + randnum));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanGetFileData()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpService.Upload(<span style="color: #0000ff">new</span> MemoryStream(_data), _server + <span style="color: #006080">"/"</span> + _filename);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        var returnedData = <span style="color: #0000ff">new</span> <span style="color: #0000ff">byte</span>[_data.Length];</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">            _ftpService.Get(_server + <span style="color: #006080">"/"</span> + _filename).Read(returnedData, 0, _data.Length);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">            Assert.AreEqual(_data, returnedData);</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CheckingForANonExistantFolderReturnsFalse()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        Assert.IsFalse(_ftpService.FolderExists(_server + <span style="color: #006080">"/Folder/Test"</span>));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [Test]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CheckingForANonExistantFileReturnsFalse()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        Assert.IsFalse(_ftpService.FileExists(_server + <span style="color: #006080">"/"</span> + <span style="color: #006080">"File"</span> + <span style="color: #0000ff">new</span> Random().Next(101, 200)));</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    [TestFixtureTearDown]</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> OneTimeTearDown()</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    {</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpd.Kill();</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">        _ftpd.Dispose();</pre>
<!--CRLF-->
<pre style="border-style: none; text-align: left; padding: 0px; line-height: 12pt; background-color: white; margin: 0em; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt; overflow: visible;">    }</pre>
<!--CRLF--></div>
</div>]]></content>
      <post-name type="text"><![CDATA[Simple tools make integration testing easy]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="832202cb-b074-4686-8c64-efb0d3a1aa9c" />
      </categories>
      <tags>
        <tag ref=".net" />
        <tag ref="TDD" />
        <tag ref="coding" />
        <tag ref="csharp" />
      </tags>
    </post>
    <post id="d42fcc81-64e6-4712-af29-e25582c2ca4f" date-created="2010-07-04T17:04:00" date-modified="2010-07-04T17:11:08" approved="true" post-url="/post/2010/07/04/How-to-poach-an-egg.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[How to poach an egg]]></title>
      <content type="text"><![CDATA[<p>Today I finally managed to make poached eggs properly.&nbsp; Sadly, while I am generally a pretty good cook, poaching an egg without it falling apart in the pot of water always seemed to elude me, I could never quite get it perfect.&nbsp; Today I found out why.</p>
<p>Apparently, the water must not actually be boiling, it should be a low simmer at the most.&nbsp; The violent movement of the water was what was thwarting me, poached eggs need calm seas. I feel like a bit of an idiot for not realizing this earlier.</p>
<p>Finally, one of the simplest cooking techniques (outside of making toast perhaps) is mine!</p>]]></content>
      <post-name type="text"><![CDATA[How to poach an egg]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="60961e3d-020b-4362-8aad-91d6b33f1261" />
      </categories>
      <tags>
        <tag ref="cooking" />
      </tags>
    </post>
    <post id="9b98c1ea-1377-4899-ad5d-4eff3ad18bf5" date-created="2010-06-25T00:54:00" date-modified="2010-06-26T10:26:17" approved="true" post-url="/post/2010/06/25/Back-to-our-regular-scheduled-programe280a6.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Back to our regular scheduled program...]]></title>
      <content type="text"><![CDATA[<p>&nbsp;</p>
<div id="scid:8747F07C-CDE8-481f-B0DF-C6CFD074BF67:1ee8788f-f703-48b7-aaea-6656e2b94b7a" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: right; padding-top: 0px"><a rel="thumbnail" href="http://www.lucisferre.net/image.axd?picture=IMGP3507-8x6_1.jpg"><img src="http://www.lucisferre.net/image.axd?picture=IMGP3507_1.png" border="0" alt="" width="357" height="295" /></a></div>
<p>Well, not exactly.&nbsp; I was really hoping not to do a blog post about why I have not been posting, it has become a bit of a clich&eacute;.&nbsp; Still, it's what I've got on my mind right now so why not?</p>
<p>&nbsp;</p>
<p>The problem isn't that I have nothing to post about, but it is partly that I don't have anything brief.&nbsp; I have been doing a lot lately, CQRS, DDD, TDD, Silverlight, WCF (ugh!), some ALT.NET stuff (well going out for beers anyways).&nbsp; I just recently got back from Africa, we are in the middle of a kitchen renovation (going disastrously, thanks for asking) and work has been fairly hectic last month.</p>
<p>In lieu of anything more interesting you can check out my Picasa album of Africa pics.</p>
<p><a title="http://picasaweb.google.ca/chnicola/Africa?authkey=Gv1sRgCNPYt7KQ1dfE8wE#" href="http://picasaweb.google.ca/chnicola/Africa?authkey=Gv1sRgCNPYt7KQ1dfE8wE#">http://picasaweb.google.ca/chnicola/Africa?authkey=Gv1sRgCNPYt7KQ1dfE8wE#</a></p>
<p><a title="http://picasaweb.google.ca/chnicola/Christopher?authkey=Gv1sRgCLeT-4WC4qXyxwE#" href="http://picasaweb.google.ca/chnicola/Christopher?authkey=Gv1sRgCLeT-4WC4qXyxwE#">http://picasaweb.google.ca/chnicola/Christopher?authkey=Gv1sRgCLeT-4WC4qXyxwE#</a></p>
<p>I am planning a couple of posts though, and this weekend I hope to get out at least one or two and post date them for the next couple of weeks.&nbsp; I have a couple of code sample/tutorial style posts planned and I am eager to get them done so hopefully they get done soon to, but here is what I'm thinking about [more]</p>
<h3>MAF -&gt; MEF Sample Application</h3>
<p>Right before I went to ALT.NET Seattle I was tasked with reviewing and documenting a add-ins framework at work that used MAF (managed add-ins framework).&nbsp; Now the code behind this was pretty good, but MAF feels awkward, bloated and like an unfinished painting.&nbsp; To even use it you have to download this <a href="http://pipelinebuilder.codeplex.com/">Pipeline Builder</a> from codeplex that MS never even finished properly.&nbsp; Someone who used MAF had to fix it up themselves to get it working again.&nbsp; <em>Note to Microsoft, open source software is not a licence to half-ass everything.</em></p>
<p>Anyways, I decided to do something about it and began to look into the <em>managed extensibility framework<strong> -</strong></em> MEF (you wouldn't believe how many confusing conversations I've had at work talking about MAF and MEF in the same discussion) which is an altogether different beast from MAF, but nonetheless serves some similar purposes in that it allows you to make application design more "pluggable" or in their words "extensible".</p>
<p>Well I started a conversation on Twitter with team lead Glen Block (@gblock) and started to ask about the possibility of switching one from the other.&nbsp; Fortune had it we would both be at ALT.NET Seattle so we took about an hour or so during a Code-Dojo session and refactored one of the sample apps replacing MAF entirely with MAF.&nbsp; It was quite easy in fact, so easy the when I got back from the conference I took some of my 'scheduled "documentation" time to replace it in our production app.&nbsp; Successfully, I might add, the change is already in production and even fixed a couple of hard to pinpoint performance issues.</p>
<p>While Glen and I were doing this, I kept my Git workflow going and synced up with a Github repo so that everyone could follow our process.&nbsp; So for anyone who has worked with a MAF application and is interested in what MEF has to offer please <a href="http://github.com/lucisferre/MAFtoMEFSample">feel free to pull it down</a>.&nbsp; A quick warning though, we did this in a hurry and did not have time to clean up (and there was a lot to clean up), or wire up all of the features of the calculates (the graphing part isn't working yet).</p>
<h3>NCQRS Quickstart</h3>
<p>I have had the opportunity to start building a CQRS/DDD based system as part of my work (I know right!).&nbsp; It's been quite an experience, I am finally beginning to grok the concepts of DDD much more clearly in the framework of a CQRS design.&nbsp; I started "rolling my own" but after reviewing the code and design of the very new NCQRS framework I decided it would be much better to use and support NCQRS than to continue down my own path.&nbsp; I plan to put together a simple getting started post soon, but I need time to put the code together.</p>]]></content>
      <post-name type="text"><![CDATA[Back to our regular scheduled program...]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="975cc08b-8b3a-4237-ab81-2181657335c8" date-created="2010-05-21T07:56:00" date-modified="2010-05-21T09:27:31" approved="true" post-url="/post/2010/05/21/Goal-setting-Measurements.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Goal setting: Measurements]]></title>
      <content type="text"><![CDATA[<p>Early this year <a href="http://www.lucisferre.net/post.aspx?id=838a0086-6ef3-4b8d-b82b-00e059bb4b53">I set out a list of goals</a> and reviewed what I felt my goals for last year would have been had I bothered to take note of them.&nbsp; However, set and forget is all to easy with goals and so I am going to also try to review them a few times this year (basically every quarter).&nbsp;&nbsp;</p>
<p>The purpose of doing this&nbsp;isn't just to see how I'm doing or pat myself on the back, but&nbsp;to reivew the goals themselves and refresh them.&nbsp; Goals can become stale, what is important to us one&nbsp;day may not be so important 3 months from now.&nbsp; Just as in Agile having&nbsp;regular&nbsp;retrospective is important not just to keep on track&nbsp;but to ensure we are moving in the right&nbsp;direction.&nbsp;</p>
<p>A brief&nbsp;word of warning: This is entirely for my own&nbsp;benefit, so if you feel like commenting on how uninteresting or pointless this post is to you... tell it to your shrink<img title="Tongue out" src="http://www.lucisferre.net/editors/tiny_mce3/plugins/emotions/img/smiley-tongue-out.gif" border="0" alt="Tongue out" />. [more]</p>
<p>First, here are some status updates for my goals:</p>
<li><strong>Read Domain Driven Design</strong> <em>and</em> the new chapter Eric Evans gave me at the conference (if I read nothing else I will read this book this year) </li>
<p>[Not started] This is not going well... I'm sorry Eric.&nbsp; I have been reading, but I have not got back to this yet, this is still highly important to me (particularly now that I am actually using CQRS in my work) so I will be starting this as soon as I am done The&nbsp;Pragmatic Programmer.</p>
<li>Develop at least two new client relationships </li>
<p>[Completed] The nature of this goal changed a bit now that I have taken a position with Vision Critical.&nbsp;&nbsp;Taking a job with a dynamic and active development team was always an alterntive option I had on the table and overall I feel this was a better move for my career and professional development.&nbsp; So I am going to give myself a pass here.</p>
<li>Complete the first release candidate for Graphite </li>
<p>[Postponed Indefinitely] I have decided not to move forward with Graphite for the moment.&nbsp; This isn't a failure as much as it is a shift in priorities.&nbsp; I am not really sure I want to maintain an open source project, or at least I don't want to be responsible for heaping yet-another-blog-engine on to the pile.&nbsp; Graphite was always intended as a learning tool for me to explore MVC, at this point I am starting to question the value of the ASP.NET MVC in the face of Ruby/Rails and other technologies.&nbsp; Using CQRS and examining document database&nbsp;is also making me question the standard nHibernate/ORM/SQL approach I take to web applications as well.&nbsp; I will probably continue to use Graphite to explore these technologies and who knows?&nbsp; Maybe one day it will finally be a first class FOSS blog engine.</p>
<li>Contribute to at least one open source project [Needs Improvement]</li>
<p>I would not say I have really completed this yet.&nbsp; I did submit some work that has probably in a round about way contributed to S#arp Architecture.&nbsp; I did also update some pages on their wiki too.&nbsp; I would like to step this one up a notch and at the least have multiple patches applied to an active project, perhaps NCQRS even better-becomming a full&nbsp;contributer to one of these projects.&nbsp; This goal needs to have significantly more focus directed to it, unfortunately time has been tight.</p>
<li>Practice my TDD technique and start learning BDD [Good]</li>
<p>This has been going fairly well since where I work we use TDD.&nbsp; Doing TDD with other people doing it as well has stepped up my game a bit, I have also had some time to review some OSS projects that use MSpec which is an excellent BDD framework.&nbsp; I feel I understand how it works well enought to try using it soon, I will probably use Graphite first and then introduce it to my team.</p>
<li>Organize discussions/talks with ALT.NET locally [Great Success!]</li>
<p>Perhaps not&nbsp;'great' but at least&nbsp;'good'.&nbsp; We have had two consecutive and well attended&nbsp;#altnetbeers and this has even&nbsp;attracted the <a href="http://twitter.com/jeff_tucker/statuses/14313460875">attention</a> (and dare I say <a href="http://twitter.com/jeff_tucker/statuses/14315029854">jeolousy</a>) of the Seattle&nbsp;contingent.&nbsp; Next we&nbsp;will be trying to organize a small open spaces event, Vision Critical has been generous to offer up their space for this, it is just a matter of generating enough interest.</p>
<li>Submit at least one presentation/talk to a conference (doesn't have to be a big one) [Incomplete]</li>
<p>I'm not quite sure I'm ready for this, but I still think I should try anyways.&nbsp; I have taken some steps in the right direction, for example, I recently gave a talk for the VC dev team about using Git with their Subversion repositories.&nbsp; I could tell it needed work though, hopefully I will find an opportunity to give a similar talk to .NET BC, perhaps jointly with Adam who is also a big Git user.</p>
<li>And of course. be more like Ju<a href="http://graysmatter.codivation.com/">stice Gray</a> (or at least try to make my blog posts a little less dry) [Undetermined]</li>
<p>Well, I suppose I will just&nbsp;have to let Justice Gray speak for this one... or perhaps <a href="http://twitter.com/justicegray/status/13082708828">he already has</a>.</p>
<li>Learn Ruby on Rails (if I still have time after everything else)&nbsp;&nbsp;[In Progress]</li>
<p>I have completed the first of the Peepcode webcasts on learning RoR.&nbsp; I am very excited about it and it has been tremendous fun, I would suggest to anyone thinking of learning one new language in the next while to give RoR a serious look.&nbsp; I've actually been learning RoR but using IronRuby.&nbsp; I definitely have to give&nbsp;credit to the IronRuby/Python guys (some of whom are fellow ALT.NET'rs)&nbsp;for IronRuby.&nbsp; Thanks guys!</p>
<p>Well after that review I think I can update my goals:</p>
<ul>
<li>Read Domain Driven Design</li>
<li>Contribute to at least one open source project (most likely NCQRS) </li>
<li>Start <strong>using</strong> BDD</li>
<li>Learn to use NCQRS&nbsp;</li>
<li>Help to&nbsp;organize one open spaces event for ALT.NET </li>
<li>Submit a presentation/talk to a conference or the&nbsp;.NET BC user group </li>
<li>Complete&nbsp;Ruby on Rails series from Peepcode</li>
<li>Continue to try to write more interesting blog posts&nbsp;</li>
<li>Learn to properly use a powerful text editor like Vim or Emacs</li>
</ul>
<p>Well that was good for me, see you again in approximately another 3 months or so...</p>]]></content>
      <post-name type="text"><![CDATA[Goal setting: Measurements]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1091489b-35f0-473f-8e03-c2b8aa031f8c" />
      </categories>
      <tags>
        <tag ref="agile" />
        <tag ref="goals" />
      </tags>
    </post>
    <post id="78b33132-97ad-4e7c-ba0c-28662764fcf3" date-created="2010-04-29T07:58:00" date-modified="2010-04-29T08:17:03" approved="true" post-url="/post/2010/04/29/Chris-Nicola-Blade-Runner.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Chris Nicola... Blade Runner]]></title>
      <content type="text"><![CDATA[<p>Well I promised I'd follow up on <a href="http://www.lucisferre.net/post.aspx?id=aeddbcb0-c4d5-41fd-ae62-05dd1853d132">this post</a> however it will be my last post on blog spam I think (I don't want this to turn into a blog about dealing with spam).&nbsp; So far, my <a href="http://blogengine.codeplex.com/Thread/View.aspx?ThreadId=208176">experiment</a> with confusing the bots has been fairly successful.&nbsp; I&rsquo;ve added a simple hidden form field disguised as the e-mail field.&nbsp; Some javascript validation will block any submission where that field contains any input.&nbsp; This scheme has managed to reduce the number of spam comments received from and average 37 comments a day to 21 (about 45%).&nbsp; Even better is that it seems to have fooled the most successful bots at beating the Akismet and Typepad filters, as the amount of comments getting through the filters went down from 2 a day to less than 2 a week (either that or those filters have gotten better lately).&nbsp; <img style="border-bottom: 0px; border-left: 0px; margin: 6px; display: inline; border-top: 0px; border-right: 0px" title="bladerunner-voight-kampff1" src="http://www.lucisferre.net/image.axd?picture=bladerunner-voight-kampff1_thumb.jpg" border="0" alt="bladerunner-voight-kampff1" width="244" height="115" align="right" /></p>
<p>Overall it has been a resounding success, and has reduced the spam deluge to more of a trickle.&nbsp; I still think I can still tweak the form trap to make it better, but I'm happy with the level of automated protection I've managed to achieve without resorting to annoying captcha style human verification or implementing a full fledged VK test.</p>]]></content>
      <post-name type="text"><![CDATA[Chris Nicola... Blade Runner]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf150060-6a7a-4e62-98a3-d6ddc70a922a" />
      </categories>
      <tags>
        <tag ref="spam" />
        <tag ref="akismet" />
        <tag ref="typepad" />
      </tags>
    </post>
    <post id="74786c00-e1af-4d73-a2ab-6e09ce3ddd9c" date-created="2010-04-21T16:41:00" date-modified="2010-04-17T16:41:31" approved="true" post-url="/post/2010/04/21/Virtualizing-Stack-Panel-WPF!-Part-Duex.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Virtualizing Stack Panel WPF!??? Part Duex]]></title>
      <content type="text"><![CDATA[<p>So, as I mentioned in an update to part one I did end up finding a solution to the problem.&#160; It was a hybrid of all the other, largely broken solutions out there.&#160; I should also mention I was not happy with this solution, it felt hacky and performed somewhat poorly, instead I took a different approach altogether to get the desired result for my users.&#160; Nonetheless, despite not using this solution I think the resulting code is worth writing about and considering so here it is.</p>  <p>A couple of conclusion I came to from working on this and discussing it with others:</p>  <ol>   <li>The ability to bring an item into view should be built-in, not a hack or afterthought.&#160; I can't understand how it was released this way. </li>    <li>The VSP current design completely breaks the MVVM pattern, since virtualized items don't actually have a view and thus the view-model is left unbound to the UI (@kellyleahy and I discussed this at ALT.NET Seattle and he has some ideas to solve this that I may try to implement in a custom VSP implementation) </li> </ol>  <p>I do realize that WPF and SL development probably began before the MVVM pattern was considered fundamental, so that is probably part of the reason for this (and other) oversights.</p>  <p>You can download the solution code <a href="/file.axd?file=2010%2f4%2fTreeViewitemFinder.cs">here</a>.&#160; It provides a static <strong>BringIntoView</strong>&#160; extension method for the TreeView control.&#160; Now lets look at the code in more detail. [more]</p>  <p>The first thing to note is that to do this at all we have to extend the VSP in order to expose a protected method that is protected for no valid reason I can think of:</p>  <div id="codeSnippetWrapper">   <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">     <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> MyVirtualizingStackPanel : VirtualizingStackPanel {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> BringIntoView(<span style="color: #0000ff">int</span> index) { BringIndexIntoView(index); }</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">}</pre>
<!--CRLF--></div>
</div>

<p>Lest you think this is just a limitation of my solution, let me point out that both of the solutions provided by MS employees used the same approach.</p>

<p>One of the things I didn't like about the other solutions is that they did not make use of the MVVM pattern at all.&#160; They roughly searched through the tree for the item they wanted.&#160; I understand why though, these are only sample solutions provided for guidance, which is fair enough (though it isn't exactly hard to use MVVM even in a sample). </p>

<p>I made sure to pass my VM instance for the item I wanted to bring into view to my <strong>BringIntoView</strong> method and extended the TreeView control like this:</p>

<div id="codeSnippetWrapper">
  <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
    <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">
      <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> TreeViewItem BringTreeViewItemIntoView(<span style="color: #0000ff">this</span> TreeView treeView, TreeViewItemModel item) {</pre>
<!--CRLF-->

      <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">if</span> (item == <span style="color: #0000ff">null</span>) <span style="color: #0000ff">return</span> <span style="color: #0000ff">null</span>;</pre>
<!--CRLF-->

      <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    ItemsControl parentContainer = (ItemsControl) treeView.BringTreeViewItemIntoView(item.Parent) ?? treeView;</pre>
<!--CRLF-->

      <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">return</span> parentContainer.BringItemIntoView(item);</pre>
<!--CRLF-->

      <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">}</pre>
<!--CRLF--></div>
  </div>
</div>

<p>Finally, I found that initially this was not exactly working as expected.&#160; It would scroll my TreeView but not actually scroll my item into view.&#160; My working theory is that the VSP does not actually know how large it's items are until it renders them first.&#160; Again probably another short-coming (or defect) in the current VSP.</p>

<p>I tried numerous things to make this work and I found the most reliable way was to make a second call to bring the item into view, but use the Dispatcher to call it at a lower priority than my first call.&#160; In theory this should always get called after the VSP renders the item first:</p>

<div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">
  <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">
    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">for</span> (<span style="color: #0000ff">int</span> i = 0; i &lt; container.Items.Count; i++) {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    vsp.Dispatcher.Invoke(DispatcherPriority.ContextIdle, (Action&lt;<span style="color: #0000ff">int</span>&gt;) vsp.BringIntoView, i);</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    var nextitem = (TreeViewItem) container.ItemContainerGenerator.ContainerFromIndex(i);</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">if</span> (nextitem.DataContext == item) {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">        nextitem.Dispatcher.Invoke(DispatcherPriority.ContextIdle, (Action) nextitem.BringIntoView);</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">        <span style="color: #0000ff">return</span> nextitem;</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    }</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">}</pre>
<!--CRLF--></div>
</div>

<p>Anyways I am no WPF/SL expert.&#160; I am certain there is a better way, however I am not certain there is a better way without implementing a completely new VSP.&#160; If there is I would certainly like to hear about it though.</p>

<p>I will probably spend a bit of time playing with the VSP code from SL (thank you for open sourcing it MS) to see if I can't learn more and find a more appropriate solution.</p>

<p><a href="/file.axd?file=2010%2f4%2fTreeViewitemFinder.cs">TreeViewitemFinder.cs (2.02 kb)</a></p>]]></content>
      <post-name type="text"><![CDATA[Virtualizing Stack Panel WPF!??? Part Duex]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="d0dc3107-546d-4823-ae60-1ad781222420" date-created="2010-04-17T13:09:00" date-modified="2010-04-17T13:54:36" approved="true" post-url="/post/2010/04/17/Git-user-Need-to-work-with-SVN-DONT-PANIC.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[So you have to use Subversion? DONT PANIC]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.lucisferre.org/image.axd?picture=dontpanic_1.png"><img style="border-bottom: 0px; border-left: 0px; margin: 0px 0px 8px 8px; display: inline; border-top: 0px; border-right: 0px" title="dontpanic" border="0" alt="dontpanic" align="right" src="http://www.lucisferre.org/image.axd?picture=dontpanic_thumb_1.png" width="148" height="128" /></a> Distributed source control (DSCM) using Git (or Hg) is truly a beautiful thing.&#160; It's wonderful, it's revolutionary and it will <em><span style="text-decoration: underline">free</span> <span style="text-decoration: underline">your</span>&#160;<span style="text-decoration: underline">mind</span></em>.&#160; But the reality is that subversion <em>is still out there</em> and you are probably going to come into contact with it again at some point.&#160; The important thing to remember is <strong>DONT PANIC, git svn</strong> is here for you.</p>  <p>For those of you who are reading this and saying, &quot;I've worked with SVN for years, it's been good to me, what's the big deal with Git?&quot; Learning to use Git is going to make your workflow more agile, make you less timid about changing code and exactly as promised it <em>will</em> <strong>free your mind.&#160; </strong>It may just save your code one day. <strong>&#160;</strong>[more]</p>  <p><strong>git svn </strong>is a tool that almost every Git user has used at some point.&#160; For most of us, one of the first things we did was run:</p>  <p></p>  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git svn clone svn://the-source-of-my-pain/ /c/dev/freedom</pre>

<p></p>

<p>Afterwards we never looked back.&#160; Once you're weened off svn, you're done with that SVN thing, right?&#160; Sure, occasionally you have to check-out some open source project from SVN (*cough* nHibernate *cough*) but a simple <strong>git svn clone . -rHEAD</strong> is enough, if you're not a committer.</p>

<p>Unfortunately, it may come to pass that you will actually have to do real work with SVN again, or perhaps you've just never been shown the way and still work with SVN.&#160; That is where git svn can help you.&#160; Recently, I once again have the pleasure of working with SVN.&#160; No really, I actually mean<em> </em>pleasure, because I've learned how to bolt my git workflow onto that SVN repository and it's great (well <em>almost</em> great).&#160; Sure, I still have to wait for Git to pull down those bulky SVN revisions but once I've got them I'm on my way and I'm working blazing fast.</p>

<h2>Installation and Setup</h2>

<p>Ok so unfortunately I am going to have to break this into parts.&#160; The first part will get just about everyone started.&#160; If you have zero experience with Git then obviously the first thing to do is get it and install it, <a href="http://code.google.com/p/msysgit/" target="_blank">MySysGit</a> is what you will use for Windows (also <a href="http://code.google.com/p/gitextensions/" target="_blank">GitExtensions</a> will give you some integration with VS2008).&#160; Linux users simply have to pull it down with whatever package manager their distro uses.</p>

<p>Installation is pretty simple, but you may want to give some thought to how you want to handle LF/CRLFs.&#160; If you are largely working in one platform with other devs doing the same then leave them unchanged.&#160; If you are sharing code between platforms then the option to convert LFs to CRLFs when you checkout/checkin may be of use (you can set this option per repository so don't worry too much now, leaving them unchanged is usually a safe bet).</p>

<p>I also do some basic configuration to make it easier to work with Git.&#160; Here is a copy of my <a href="/file.axd?file=2010%2f4%2f.gitconfig">~/.gitconfig</a> file which contains some simple aliases for SVN like <strong>spull </strong>(fetch + rebase) and <strong>spush</strong>, which allow me to easily update my local repository and checkin a new commit to SVN.</p>

<h2>Cloning Your Repository</h2>

<p>In order to start working with svn we need to <strong>pull</strong> down the source from the remote (git calls it pull to differentiate it from checkins which are done locally).&#160; There are a couple of approaches we can take depending on your situation:</p>

<p><strong>A)</strong> You have a clean and organized SVN repo with a <strong>trunk, branches </strong>and <strong>tags</strong> all in separate folders (for those of you who use SVN at work I know this situation is highly unlikely so bear with me).&#160; Also you want to have full access to all of the SVN repository locally and don't mind that it may take a while to checkout the first time.</p>

<p></p>

<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git svn clone &lt;remote address&gt; -T &lt;trunk dir&gt; -b &lt;branches dir&gt; -t &lt;tags dir&gt; &lt;dest dir&gt;</pre>

<p></p>

<p>This will take a while (depending on how much history your repo has) but it is a one time deal (if you don't want to wait use -<strong>r HEAD</strong> to only get the last revision).&#160; This is actually cloning the entire svn repo locally, but don't worry it won't be as large as you think, Git's compression is far better than SVN.&#160; This will ensure that you have easy access to checkout any branch or tag using git locally making it extremely easy to work with SVN.&#160; After this is done, change&#160; to the <strong>&lt;dest dir&gt; </strong>and use <strong>git gc</strong> to do a garbage collection.</p>

<p><strong>B)</strong> You don't have a standard organized SVN repository and branches are everywhere.&#160; So for now you just want to checkout one folder (i.e., branch) and/or you probably don't want to get all of the svn history right now either. </p>

<p></p>

<pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git svn clone &lt;remote address&gt; -r HEAD</pre>

<p></p>

<p>You can substitute any SVN revision number after -r if you want to checkout another revision.&#160; This is good if you only need to work in one branch.&#160; You will unfortunately have to checkout other SVN branches separately or add then as svn-remotes manually which is explained <a href="http://www.dmo.ca/blog/20070608113513/" target="_blank">here</a>.</p>

<p>You will also need to setup a .gitignore file for ignoring artifact paths and user settings files.&#160; Here is a copy of my global <a href="/file.axd?file=2010%2f4%2f.gitignore">~/.gitignore</a>.</p>

<h2>Git Workflow</h2>

<p>This is my current Git&lt;-&gt;SVN workflow, but remember Git is all about flexibility, you can define your own workflow once you are comfortable with the tools.&#160; I am going to use the full command names for the common git command below, but my .gitconfig contains shortened aliases like <strong>co</strong> instead of <strong>checkout</strong>.</p>

<ol>
  <li>Create a new branch, typically named after the feature or bug I am working on like &quot;FeatureA&quot; 
    <ol>
      <div id="codeSnippetWrapper">
        <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git checkout -b FeatureA</pre>
      </div>
    </ol>
  </li>

  <li>Make changes to my source code to complete the feature.&#160; At any point I can view changes using <strong>git status</strong> and <strong>git</strong>&#160;<strong>diff</strong>.&#160; If you have it installed <strong>gitk</strong> will bring up a GUI as well. </li>

  <li>'Stage' my changes using the <strong>add </strong>command.&#160; The command below will stage all my changes including adding and removing files.&#160; However you can specify a specific file or folder in your project to add changes from.&#160; You can also use the -<strong>p</strong> option to add changes from a file line-by-line.&#160; Git allows you to stage changes and commit them with any level of granularity you wish. 

    <ol>
      <div id="codeSnippetWrapper">
        <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git add -A .</pre>
      </div>
    </ol>
  </li>

  <li>Now I can commit my staged changes.&#160; Note that un-staged changes will not be part of the commit.&#160; That way I can separate my changes by selectively using <strong>add</strong> into multiple small or 'atomic' commits where the commit message clearly states what changed and is closely matched by the <strong>diff</strong>.&#160; This makes code changes easy for other team members to understand.&#160; If you understand what "clean code" means then think of this approach as "clean source control". 

    <ol>
      <div id="codeSnippetWrapper">
        <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git commit -m <span style="color: #006080">'commit message (leave it blank to use an editor (usually vim)'</span></pre>
      </div>
    </ol>
  </li>

  <li>Finally, once my Feature is complete I want to merge my branch back to the master branch before pushing it up to the SVN repo.&#160; There are a number of way to do this.&#160; I can <strong>rebase</strong> or I can do a <strong>merge.</strong>&#160; To closely match the current behavior of my colleagues using SVN where every commit to trunk is a complete feature or bug fix I merge and "squash" my commits into one single commit like this: 

    <ol>
      <div>
        <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;,courier,monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">git co master <br />git spull     <span style="color: #008000">#my fetch + rebase alias </span><br />git merge FeatureA --no-commit <span style="color: #008000">#merge branch but don't commit</span><br />git ci -m     <span style="color: #008000">#I use vim to create a SVN-like commit message</span><br />git spull     <span style="color: #008000">#pull again just to be sure we are on the latest SVN commit</span><br />git spush     <span style="color: #008000">#my git svn dcommit alias</span></pre>
      </div>
    </ol>
  </li>
</ol>

<p>The reason I create a single large commit is because where I work they have a workflow where a single commit is used with a message that summarizes all of the details of the bug-fix or feature being committed.</p>

<h2>Other Resources</h2>

<p>That is all for the basics.&#160; This intro should get any SVN user away from using mouse-driven tools like SVN and into a more agile git based workflow locally.&#160; It will make you a less timid developer because you will commit more often and always know you can go back a step or two, or even "cherry-pick" changes.</p>

<p>I could go on and on about the features available in git on my blog, but there are so many great resources already and this is only meant as a "getting started" guide for SVN users.&#160; I've decided not to make this into a multi-part post, instead here is a lot of some excellent resources that I have found invaluable:</p>

<ul>
  <li><code>git help &lt;any command&gt;</code> - brings up the man pages, loads them in a web browser on windows </li>

  <li><a href="http://progit.org/book/" target="_blank">Pro-Git</a>- completely free only book, but buy a print edition for your workplace) 

    <ul>
      <li><a href="http://progit.org/book/ch8-1.html" target="_blank">Chapter on git svn</a> </li>
    </ul>
  </li>

  <li><a href="http://www.dmo.ca/blog/20070608113513/" target="_blank">Working with SVN branches</a>- a blog post on svn branches.&#160; Very useful if you SVN repo doesn't conform to the standard tags/branches layout </li>

  <li><a href="http://github.org" target="_blank">GitHub</a>- a great place to setup free (public) repositories and learn to work with git </li>
</ul>]]></content>
      <post-name type="text"><![CDATA[So you have to use Subversion? DONT PANIC]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="git scm svn" />
      </tags>
    </post>
    <post id="1af002f0-dab5-4e7e-bf67-ac0b6c2a694d" date-created="2010-04-09T07:55:50" date-modified="2010-04-09T07:55:50" approved="true" post-url="/post/2010/04/09/ALTNET-Seattle-this-weekend.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[ALT.NET Seattle this weekend]]></title>
      <content type="text"><![CDATA[<p>Just getting ready to head off to ALT.NET Seattle after work today.&#160; Looking forward to the open-spaces events (and the bar-related events as well).&#160; I am hoping that during some of the downtime I will have time to finish some of the blogs entries I've been planning including:</p>  <ul>   <li>Working with SVN (only if I have too!) using git </li>    <li>Psake part 2: continuous integration with Teamcity</li>    <li>An update to my TreeView problem and a solution in code (though not an elegant one, I don't believe there is an elegant solution without writing a brand new VSP)</li> </ul>  <p>Hope to see some of you at alt.net.</p>]]></content>
      <post-name type="text"><![CDATA[ALT.NET Seattle this weekend]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="aeddbcb0-c4d5-41fd-ae62-05dd1853d132" date-created="2010-03-29T01:04:00" date-modified="2010-05-29T09:51:04" approved="true" post-url="/post/2010/03/29/The-continuing-adventures-of-a-spam-assassin.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[The continuing adventures of a spam assassin]]></title>
      <content type="text"><![CDATA[<p>Yet another post about spam, I suppose I find spam kind of fascinating in some ways.&#160; I mean, it is largely an automated, yet adaptive attack on a system and so the process of improving that system so that it is more resilient to the attacker is interesting to me.</p>  <p>First some good news is that the latest Hg checkins on the Codeplex site include <a href="http://www.lucisferre.net/post.aspx?id=630fe213-4b62-4235-a50a-e253b0d0801b" target="_blank">my changes</a> to both the spam filters and the whitelist/blacklist behaviour.&#160; Even better news is that Codeplex is using Hg now! (I would have preferred Git, but beggars can't be choosers)</p>  <p>I've been tracking my spam since adding the Type Pad filter and after 415 spam messages here are some results:</p>  <table style="width: 510px; height: 77px" border="0" cellpadding="4" width="498" align="center"><tbody>     <tr>       <td valign="top" width="72"><strong>Filter</strong></td>        <td valign="top" width="117"><strong>Spam Checked</strong></td>        <td valign="top" width="105"><strong>Spam Missed</strong></td>        <td valign="top" width="102"><strong>Spam Caught</strong></td>        <td valign="top" width="100"><strong>% spam remaining</strong></td>     </tr>      <tr>       <td valign="top" width="72"><strong>SFS</strong></td>        <td valign="top" width="117">414</td>        <td valign="top" width="105">241</td>        <td valign="top" width="102">173</td>        <td valign="top" width="100">58.2%</td>     </tr>      <tr>       <td width="72"><strong>Akismet</strong></td>        <td width="117">241</td>        <td width="105">45</td>        <td width="102">196</td>        <td width="100">10.9%</td>     </tr>      <tr>       <td valign="top" width="72"><strong>Type Pad</strong></td>        <td valign="top" width="117">45</td>        <td valign="top" width="105">22</td>        <td valign="top" width="102">23</td>        <td valign="top" width="100">5.3%</td>     </tr>   </tbody></table>  <p>[more]The filters use a fall-through approach.&#160; Any approved messages are passed onto the next filter in the list.&#160; If any filter detects spam it is simply marked as spam and is not passed on further.</p>  <p>Now the checked/caught numbers are a bit inflated since the blacklist was turned off (actually I broke it) which meant some of this is obvious repeat spamming.&#160; The key metric is what made it all the way through to the last filter.&#160; It managed to catch 50% of the remaining spam that was previously getting through.&#160; Now this data doesn't suggest that Type Pad is better than Akismet, merely that using both together can cut down the missed spam by 50%.</p>  <p>This also shows that Stop Forum Spam is basically useless as a spam filter.</p>  <p>The second thing that really stands out is the shear volume of the spam, 525 comments in two weeks!&#160; This unfortunately means I'm still deleting an average of 2 comments a day :(.&#160; I now want to try a couple of things to see if I can slow this deluge.&#160; One simple thing I did was to remove some site text containing some keywords and phrases I was noticing in my Analytics.&#160; These were search terms that were clearly being used by spam bots to locate BE.NET sites as well as find the comment form.&#160; These will henceforth only be referred to as "the-keywords-that-shall-not-be-named".</p>  <p>I'm also trying something creative with the comment form, and idea I stole from <a href="http://www.webmasterworld.com/webmaster/3322243.htm" target="_blank">here</a>.&#160; I've added an invisible email address field.&#160; The hope is it will trick the spam bots to entering data there.&#160; The validation will then refuse to process the form if the field contains any data, effectively stopping the bot in it's tracks.&#160; It almost seems <em>too</em> simple, so it will be interesting to see if this cheap trick is effective.&#160; Check back here in a week to find out.</p>]]></content>
      <post-name type="text"><![CDATA[The continuing adventures of a spam assassin]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf150060-6a7a-4e62-98a3-d6ddc70a922a" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="spam" />
        <tag ref="blogengine.net" />
      </tags>
    </post>
    <post id="a07db51c-e582-4bdc-bd09-d541f0565af0" date-created="2010-03-26T15:46:00" date-modified="2010-03-26T16:27:48" approved="true" post-url="/post/2010/03/26/Color-your-Kanban.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Color your Kanban]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.lucisferre.net/image.axd?picture=2215433121_6573bcd8b1.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 6px; display: inline; border-top: 0px; border-right: 0px" title="2215433121_6573bcd8b1" src="http://www.lucisferre.net/image.axd?picture=2215433121_6573bcd8b1_thumb.jpg" border="0" alt="2215433121_6573bcd8b1" width="244" height="155" align="right" /></a>It was quite a while back now when <a href="http://www.lucisferre.net/post.aspx?id=83a26a2a-e88b-4e31-ab51-86e3745c5575">I posted</a> about Phillipe Krutchen's idea of coloring the items of a blacklog to make their purpose more visible (visibility is an important part of agile and lean).&nbsp; Specifically, he recommended separating Feature, Achitecture, Defects and Technical Debt.&nbsp; You can <a href="http://www.lucisferre.net/post.aspx?id=83a26a2a-e88b-4e31-ab51-86e3745c5575">read my old post</a> and check out <a href="http://pkruchten.wordpress.com/talks/">Phillipe's presentation</a> if you want to understand this better.</p>
<p>We wanted to be able to use the colors idea but at the time we were using Eric Davis' Redmine Kanban.&nbsp; What I did was basically hack the plugin to add the ability to assign colors to four different issue tracker types, however until know if you wanted to try this you had to get my patch file and patch the plugin yourself.</p>
<p>No more!&nbsp; For those of you who don't want to mess with patches you can now download it from my <a href="http://github.com/lucisferre/redmine_kanban/tree/kanban_colors">fork on GitHub</a>.&nbsp; Do let me know if it is useful to you I'd be happy to hear about it.&nbsp; Though, I'm sure there are many ways in which it can be improved.</p>
<p>I was also looking at the videos for <a href="http://agilezen.com/">AgileZen</a>, a commercial Kanban board site which also has the ability to color your Kanban items.&nbsp; It is very affordable (and is free for individuals with one board) and the interface looks really slick and dare I say *fun*, so I think I am going to go play with that a bit (sorry Eric).&nbsp; I will try to report back shortly on the level of "fun" to be had after using it for a while.</p>
<p>So now those craving a more colourful Kanban have two solutions (other than having many colors of post-its or stickers) available to them.</p>]]></content>
      <post-name type="text"><![CDATA[Color your Kanban]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1091489b-35f0-473f-8e03-c2b8aa031f8c" />
      </categories>
      <tags>
        <tag ref="agile" />
        <tag ref="lean" />
        <tag ref="kanban" />
        <tag ref="redmine" />
        <tag ref="agilezen" />
      </tags>
      <comments>
        <comment id="ab6ddc0d-b541-404c-b27a-b04986dc2f9d" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-26T17:21:48" date-modified="2010-03-26T17:21:48" approved="true" user-name="Eric Davis" user-email="edavis@littlestreamsoftware.com" user-ip="96.225.232.41" user-url="http://theadmin.org/">
          <title type="text"><![CDATA[re: Color your Kanban]]></title>
          <content type="text"><![CDATA[No problem, AgileZen does look nice.  I'm planning some big UI updates for the redmine_kanban plugin over the next few versions (some are already in place).  This version is the &quot;quick prototype to get the workflow correct&quot; release.

I'm still planning to review your coloring patches, I think they will be a great addition.]]></content>
        </comment>
        <comment id="42b5dc53-c0e2-4c2c-82eb-a937a62d66a1" parentid="ab6ddc0d-b541-404c-b27a-b04986dc2f9d" date-created="2010-03-26T21:48:08" date-modified="2010-03-26T21:48:08" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Color your Kanban]]></title>
          <content type="text"><![CDATA[I know, I've been following along and trying to keep up.  Hopefully I can be of some help.  I've been meaning to keep learning more ROR.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="7dae51e2-7112-4437-8900-c89f4673adfd" date-created="2010-03-21T15:52:00" date-modified="2010-03-21T19:52:11" approved="true" post-url="/post/2010/03/21/The-next-big-step.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[The next big step]]></title>
      <content type="text"><![CDATA[<p>For the past two and a half years, most of my work as a software developer has been done independently, with a few exceptions where I have occasionally partnered with developers like Paul Newton, <a href="http://www.chrisnicol.com/" target="_blank">Chris Nicol</a> (no relation), <a href="http://adventuresinagile.blogspot.com/" target="_blank">Adam Dymitruk</a> and most recently <a href="http://shrt.tylerhamilton.net" target="_blank">Tyler Hamilton</a>.&nbsp; While working independently has allowed me a lot of control over the software I design, the tools I use, and how I learn, I have felt that I was missing out on the potential for growth and learning that working with an experienced development team would provide. [more]</p>
<p>As an independent developer, I&rsquo;ve had the opportunity to try my hand at all aspects of development, everything from gathering user requirements to UI design and architecture.&nbsp; It has challenged me to learn and adapt quickly, to evaluate different approaches and techniques to solve problems and to develop a broad array of skills.&nbsp; I have also tried hard to minimize the disadvantages of working in isolation by involving myself in the community.&nbsp; DevTeach, Agile Vancouver, ALT.NET and open source communities have all helped keep me continually exposed to new techniques and new ideas.&nbsp;</p>
<p>Nonetheless,&nbsp; I have reached a point in my professional development where it was time to seek experience working as part of a larger team and on much larger projects.&nbsp; With that goal in mind, I&rsquo;ve taken an exciting position as a software engineer with <a href="http://www.visioncritical.com/" target="_blank">Vision Critical</a>, a very well known industry leader in market research located here in Vancouver.</p>
<p>My experience as a developer thus far, has also almost exclusively been developing applications for <a href="http://www.nicolawealth.com/" target="_blank">Nicola Wealth Management</a> company that my father started and continues to run.&nbsp; They are, in fact, a IT leader in their industry with some of the most advanced client reporting technology among any of their peers.&nbsp; I really want to thank everyone there for the opportunities they have provided me and for allowing me to learn and hone my craft developing unique and interesting applications for them.</p>
<p>Thanks very much to NWM, it is now time for me to take my career to the next level.&nbsp; I am eager to continue to learn and develop my skills and knowledge with the great team I will be joining at Vision Critical and look forward to creating new and exciting software solutions with them.</p>]]></content>
      <post-name type="text"><![CDATA[The next big step]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="69991539-4bfc-4cb9-a66d-09f836c0b344" />
      </categories>
    </post>
    <post id="630fe213-4b62-4235-a50a-e253b0d0801b" date-created="2010-03-16T19:20:00" date-modified="2010-04-06T14:39:29" approved="true" post-url="/post/2010/03/16/Improving-BlogEngineNET-spam-filtering.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Improving BlogEngine.NET spam filtering]]></title>
      <content type="text"><![CDATA[<p>BlogEngine.NET isn't a bad little blog engine, I mean I still intend to finish Graphite and move over too that, but in the meantime BE is doing it's thing for me.&nbsp; I do have a few pet peeves though and a big one is spam.&nbsp; BE attracts a ton of spam.&nbsp; I think part of the problem is that it is popular enough to be a target and doesn't make it very hard for spammers to find the comment submit form (I see search keywords on my analytics page like "&lt;removed search phrase for obvious reasons&gt;").[more]</p>
<p>By default, it comes with two filters, StopForumSpam, which is so bad at detecting spam you may as well disable it (except for some reason you can't disable it) and Akismet.&nbsp; Now Akismet does a decent job of filtering spam, but I'm still only getting about 85% of it and like I said BE attracts <em>a lot of spam</em>.&nbsp; As another issue BE.NET has some <a href="http://blogengine.codeplex.com/WorkItem/View.aspx?WorkItemId=11884" target="_blank">pretty stupid whitelist behavior</a> which can cause it to whitelist spammers.&nbsp; Finally, the Akismet filter doesn't use the "FallThrough" property correctly, so if Akismet runs before StopForumSpam does then it allows SFS to re-approve it's spam. (a problem that is easily fixed by running them the other way around).</p>
<p>The other day I found out that TypePad's spam filter uses exactly the same api as Akismet and since BE.NET already has an Akismet filter, I just created a second filter that used the Akismet filter's api class.&nbsp; I've posted the code as an <a href="http://blogengine.codeplex.com/WorkItem/View.aspx?WorkItemId=11885" target="_blank">issue</a> over at the BE.NET codeplex site so I am hoping it will make it into the next release.&nbsp; If you can't wait for better spam protection for blogengine then feel free to just <a href="http://blogengine.codeplex.com/WorkItem/View.aspx?WorkItemId=11885" target="_blank">grab the code yourself</a>.</p>
<p>I am hoping that between TypePad and Akismet I will be able to reduce the spam flow to barely a trickle.</p>]]></content>
      <post-name type="text"><![CDATA[Improving BlogEngine.NET spam filtering]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="blogging" />
        <tag ref="spam" />
        <tag ref="coding" />
      </tags>
      <comments>
        <comment id="39abdffd-8f8f-4f00-b275-631e81e0fde8" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-12T10:51:08" date-modified="2010-09-12T10:51:08" approved="true" user-name="Kindler Chase" user-email="kindler@gmail.com" user-ip="98.178.156.36" user-url="http://www.tumorville.com/">
          <title type="text"><![CDATA[re: Improving BlogEngine.NET spam filtering]]></title>
          <content type="text"><![CDATA[Does BE.NET v1.6.1 resolve the fall through issue? In the comments settings, you can set the priority of the custom filters... does priority mean:
- which filter carries more weight?
- or the order in which the service is run?]]></content>
        </comment>
        <comment id="ec519c5c-5598-41a3-b591-a0b59ff46d9d" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-23T11:02:13" date-modified="2010-09-23T11:02:13" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="76.77.75.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Improving BlogEngine.NET spam filtering]]></title>
          <content type="text"><![CDATA[Yes it has the patches I submitted as well as the new TypePad filter which is as good, if not better than Akismet.  I find the combination of the two works fairly well and cuts down the spam, but still I found about 10% or so getting through.  In my last spam battle post I found that some site optimizations to confuse the bots worked the best and since then I get one spam post that gets through every few months.

Here is the link:
http://www.lucisferre.net/post/2010/04/29/Chris-Nicola-Blade-Runner.aspx]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="981f0086-4a92-4f8b-94b5-3e95a45add05" date-created="2010-03-14T10:35:00" date-modified="2010-03-16T19:27:17" approved="true" post-url="/post/2010/03/14/Linq-is-elegant.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[LINQ is elegant]]></title>
      <content type="text"><![CDATA[<p>Sometimes I just love LINQ.&#160; I had to traverse an object tree today and I wanted something simple to enumerate every object in the tree into a dictionary.&#160; Here is the recursive function I wrote:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:4f8f7004-e002-45a6-bc87-bad74e1021d5" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background-color: #191919; max-height: 300px; overflow: auto; padding: 2px 5px;"><span style="background:#191919;color:#c8c8c8"></span><span style="background:#191919;color:#40c4ff">public</span><span style="background:#191919;color:#c8c8c8"> </span><span style="background:#191919;color:#00ffff">IEnumerable</span><span style="background:#191919;color:#c0c0c0">&lt;</span><span style="background:#191919;color:#00ffff">TestDataItem</span><span style="background:#191919;color:#c0c0c0">&gt;</span><span style="background:#191919;color:#c8c8c8"> </span><span style="background:#191919;color:#eddac0">GetAllSubItems</span><span style="background:#191919;color:#c8c8c8">() {</span><br>   <span style="background:#191919;color:#c8c8c8"></span><span style="background:#191919;color:#40c4ff">return</span><span style="background:#191919;color:#c8c8c8"> </span><span style="background:#191919;color:#eddac0">Items</span><span style="background:#191919;color:#c0c0c0">.</span><span style="background:#191919;color:#eddac0">Aggregate</span><span style="background:#191919;color:#c8c8c8">(</span><span style="background:#191919;color:#eddac0">Items</span><span style="background:#191919;color:#c0c0c0">.</span><span style="background:#191919;color:#eddac0">AsEnumerable</span><span style="background:#191919;color:#c8c8c8">(),(</span><span style="background:#191919;color:#eddac0">list</span><span style="background:#191919;color:#c8c8c8">, </span><span style="background:#191919;color:#eddac0">item</span><span style="background:#191919;color:#c8c8c8">) </span><span style="background:#191919;color:#c0c0c0">=&gt;</span><span style="background:#191919;color:#c8c8c8"> </span><span style="background:#191919;color:#eddac0">list</span><span style="background:#191919;color:#c0c0c0">.</span><span style="background:#191919;color:#eddac0">Union</span><span style="background:#191919;color:#c8c8c8">(</span><span style="background:#191919;color:#eddac0">item</span><span style="background:#191919;color:#c0c0c0">.</span><span style="background:#191919;color:#eddac0">GetAllSubItems</span><span style="background:#191919;color:#c8c8c8">()));</span><br> <span style="background:#191919;color:#c8c8c8">}</span></div> </div> </div>  <p>Calling that on any item in the tree will return all of that items sub items.&#160; Then it is a simple matter of calling ToDictionary() on the return value.</p>]]></content>
      <post-name type="text"><![CDATA[LINQ is elegant]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="linq" />
        <tag ref="csharp" />
        <tag ref="coding" />
      </tags>
    </post>
    <post id="eb5a2ed4-2467-44b5-8058-5e394c3854a0" date-created="2010-03-04T18:01:00" date-modified="2010-03-10T15:28:04" approved="true" post-url="/post/2010/03/04/Going-to-ALTNET-Seattle.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Going to ALT.NET Seattle]]></title>
      <content type="text"><![CDATA[<p>I am excited about the <a href="http://www.altnetseattle.org/" target="_blank">ALT.NET Seattle</a> conference coming up soon.&#160; I really learned a lot at the last two ALT.NET Vancouver events after DevTeach and the Agile Vancouver conference.&#160; I've been told the Seattle event is even better (hard to be better if it not in Vancouver imo, but we will see).&#160; </p>  <p>If anyone reading this is thinking of going make sure to use <a href="http://altnetseattle2010.eventbrite.com/" target="_blank">this link</a> to sign up, a google search for alt.net seattle will likely take you to an old event page which will say the event is sold out (not sure why they haven't taking it down yet).&#160; On that note, does anyone know of any good places to stay near the Microsoft campus?</p>]]></content>
      <post-name type="text"><![CDATA[Going to ALT.NET Seattle]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="05aa3b7e-5327-4ed2-8c05-ba7f9675b475" />
      </categories>
      <tags>
        <tag ref="alt.net" />
        <tag ref="conference" />
      </tags>
    </post>
    <post id="285730ca-c83c-44fa-a9db-da205de6674d" date-created="2010-03-03T11:15:00" date-modified="2010-07-04T16:55:11" approved="true" post-url="/post/2010/03/03/MVVM-and-VirtualizingStackPanel-WPF!!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[MVVM and VirtualizingStackPanel: WPF!!?]]></title>
      <content type="text"><![CDATA[<p>Ok this has been rather frustrating and I am hoping someone out there can help with this.&nbsp; Let me start with the scenario:</p>
<blockquote>
<p>I have a TreeView that contains a two-level hierarchy of editable data objects.&nbsp; The objects are databound view-models and they are bound to the TreeItem with a DataTemplate.&nbsp; They have the IsSelected and IsExpanded properties also bound.&nbsp;</p>
<p>A user can add a new data object by hitting the enter key and sometimes that item is added off screen.&nbsp; When an item is selected I want to make sure it is scrolled into view (sometimes it is added to the end of a long list off screen).</p>
<p>Additionally, there is some data validation, the user can make some mistakes and continue on while being able to correct them later.&nbsp; I would like to have a &ldquo;Find Next Error&rdquo; feature that finds the next data object with an error, selects it and scrolls it into view. [more]</p>
</blockquote>
<p>This has been harder than I had imagined.&nbsp; One thing I tried was <a href="http://www.codeproject.com/KB/WPF/AttachedBehaviors.aspx" target="_blank">Josh Smith&rsquo;s attached behaviors solution</a>.&nbsp; This attaches a &ldquo;BringIntoView&rdquo; behavior to the OnSelected event of a TreeViewItem.&nbsp; This works as long as you are not using virtualization with the tree view.&nbsp; However some of the hierarchies have large collections of child objects, over 1000 sometimes (which I do realize is ridiculous and probably a sign of bad UX but it is the reality of my situation).&nbsp; Without virtualization expanding one of the larger items take 5-10s which is unacceptable.&nbsp; Even if my collections were smaller, virtualizing the UI is still the smart choice.</p>
<p>Then I looked into <a href="http://code.msdn.microsoft.com/getwpfcode/Release/ProjectReleases.aspx?ReleaseId=1446" target="_blank">another solution from Ben Carter</a>.&nbsp; This was intended to solve the problem of scrolling a particular item into view when using a virtualized TreeView.&nbsp; Except the context is different, in this case we know which item we want to move to, we scroll to it and then set IsSelected.</p>
<p>The problem here is that I want to change a property in my ViewModel like &ldquo;IsSelected&rdquo; and have the UI respond to that change.&nbsp; The virtualized TreeView however has not yet bound the view-model&rsquo;s that are not in view yet so it does not know about that change and hence cannot respond to the change in any way.</p>
<p>Now there are still a few ways I could potentially solve this.&nbsp; One idea is that I could fire an event somewhere else that sends the object I want to scroll into view to some handler that looks like Ben Carters which would then scroll the item into view and select it.&nbsp; However that doesn&rsquo;t feel very MVVM like to me.&nbsp; Another way would be to use the parent view-model (the VM that is bound to the view containing the tree-view) somehow update the tree-view, but that would probably require the view have a ScrollIntoView(object item) method in the codebehind that the VM could then call.&nbsp; Not sure I like that but it could work.</p>
<p>I am asking for help or guidance from the WPF/SL gurus out there.&nbsp; How should I be handle this?&nbsp; I am going to keep working on it so if I manage to find a solution on my own I will certainly post it here.</p>
<p>&nbsp;</p>
<p>Update: I have a potential solution from this based on this <a href="http://blogs.msdn.com/wpfsdk/archive/2010/02/23/finding-an-object-treeviewitem.aspx">solution</a> which is very similar to the one Ben Carter did.&nbsp; It still isn't completely to my liking but I've been playing with it and trying to make it more MVVM friendly, using the VM more (and doing some R#-fu) has also reduced the solution from 100+ lines to 13 which I am pretty proud of.&nbsp; I have it mostly working but the VSP doesn't completely scroll my item into view yet, it isn't fully capable of getting to the exact position in one go.&nbsp; So, still needs some work but I'm almost there, once I have it finished I will post the final code I've used in a sample solution.</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[MVVM and VirtualizingStackPanel: WPF!!?]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <tags>
        <tag ref="wpf mvvm" />
      </tags>
    </post>
    <post id="6c7bd6f8-5c0a-48d5-8e87-d5ddcddfc4ad" date-created="2010-02-27T17:32:46" date-modified="2010-02-27T18:57:42" approved="true" post-url="/post/2010/02/27/WPF-AutoCompleteBoxe280a6-finally!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[WPF AutoCompleteBox. finally!]]></title>
      <content type="text"><![CDATA[<p>I was delighted to find out that the WPF Toolkit now includes an AutoCompleteBox, something that is a standard UI component and has been available in Silverlight for a while now.&#160; Up until now I've had to make do with something I sort of hacked together out of a ComboBox and some creative ViewModel bindings.</p>  <p>The AutoCompleteBox is easy to use with databinding, since I typically use MVVM when working with WPF I used a ViewModel with a property containing the list of auto-complete items and bound the AutoCompleteBox to that property.&#160; The code is shown below. [more]</p>  <p>The AutoCompleteBox:</p>  <div id="codeSnippetWrapper">   <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">&lt;</span><span style="color: #800000">toolkit:AutoCompleteBox</span> <span style="color: #ff0000">ItemsSource</span><span style="color: #0000ff">=&quot;{Binding Clients}&quot;</span> <span style="color: #ff0000">ValueMemberPath</span><span style="color: #0000ff">=&quot;FullName&quot;</span> <br />  <span style="color: #ff0000">FilterMode</span><span style="color: #0000ff">=&quot;Contains&quot;</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">=&quot;{Binding ClientName}&quot;</span> <span style="color: #ff0000">IsTextCompletionEnabled</span><span style="color: #0000ff">=&quot;True&quot;</span><span style="color: #0000ff">/&gt;</span></pre>

  <br /></div>

<div id="codeSnippetWrapper">My ViewModel and Client classes:</div>

<div>&#160;</div>

<div id="codeSnippetWrapper">
  <div id="codeSnippetWrapper">
    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> ViewModel {<br />  ... <br />  <span style="color: #0000ff">public</span> List&lt;Client&gt; Clients { get { <span style="color: #0000ff">return</span> _clientsList; } }<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> ClientName {<br />    get { <span style="color: #0000ff">return</span> _entrySplit.ClientName; }<br />    set { <br />      <span style="color: #0000ff">if</span> (<span style="color: #0000ff">value</span> != _clientName) { _clientName = <span style="color: #0000ff">value</span>; NotifyPropertyChanged(<span style="color: #006080">&quot;ClientName&quot;</span>);}<br />    }<br />  }<br />  ...<br />}<br /><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Client {<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">virtual</span> <span style="color: #0000ff">string</span> Fullname { get; set; }<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">virtual</span> <span style="color: #0000ff">string</span> Lastname { get; set; }<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">virtual</span> <span style="color: #0000ff">string</span> Firstname { get; set; }<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">virtual</span> <span style="color: #0000ff">string</span> RepCodeString { get; set; }<br />  <span style="color: #0000ff">public</span> <span style="color: #0000ff">virtual</span> <span style="color: #0000ff">int</span> ClientUID { get; set; }<br />}</pre>

    <br /></div>
</div>

<div>In this case the <strong>ItemSource</strong> is a list of objects that provide the auto-complete values.&#160; If your <strong>ItemSource</strong> is of type <strong>IEnumerable&lt;string&gt;</strong> you are done at this point, you do not need to specify anything else.&#160; If you are binding to a more complex object then you would either specify the <strong>ValueMemberBinding </strong>using a binding expression (allowing you to specific an <strong>IValueConvertor</strong> as well),<strong>&#160;</strong>or alternatively the <strong>ValueMemberPath</strong> as I have done above.&#160; Also, if you actually want to have auto-complete functionality and not just a drop down with suggestions you must set <strong>IsTextCompletionEnabled="True"</strong>.</div>

<div>&#160;</div>

<div>You can specify a <strong>FilterMode</strong> with several different options like 'Contains', 'StartsWith', etc. which will determine how auto-complete will filter your ItemSource list.&#160; If you have a need to use a customized filter you can use the <strong>ItemFilter </strong>property which allows a lambda based filter expression.&#160; You can do this in your ViewModel by binding to a property like this:</div>

<div>&#160;</div>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; height: 49px; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">&lt;</span><span style="color: #800000">toolkit:AutoCompleteBox</span> <span style="color: #ff0000">ItemsSource</span><span style="color: #0000ff">=&quot;{Binding Clients}&quot;</span> <span style="color: #ff0000">ValueMemberPath</span><span style="color: #0000ff">=&quot;FullName&quot;</span><br />  <span style="color: #ff0000">ItemFilter</span><span style="color: #0000ff">=&quot;{Binding ClientFilter}&quot;</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">=&quot;{Binding ClientName}&quot;</span> <br />  <span style="color: #ff0000">IsTextCompletionEnabled</span><span style="color: #0000ff">=&quot;True&quot;</span><span style="color: #0000ff">/&gt;</span><br /></pre>
</div>

<div id="codeSnippetWrapper">&#160;</div>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">public</span> AutoCompleteFilterPredicate&lt;Client&gt; ClientFilter {<br />  get { <span style="color: #0000ff">return</span> (search, item) =&gt; item.Fullname.Contains(search); } <br />}</pre>

  <br />Obviously this is a somewhat silly filter to define since it does the same thing as setting <strong>FilterMode=&quot;Contains&quot;</strong> but you can see the flexibility you have here.</div>

<p>One caveat about the AutoCompleteBox is that it does not recognize the TabIndex property.&#160; It is currently just a direct port of the Silverlight control and apparently Silverlight does not have a TabIndex concept.&#160; It turns out that the TabIndex property isn't really needed in WPF either, you will always tab through your controls in the order they are defined in your XAML.&#160; So to ensure tab order will be respected, do not set the TabIndex property on any of your controls and just make sure you place them in the XAML in the desired tab order.</p>

<p></p>

<p></p>

<p></p>

<p></p>

<p>If you want more information on using the AutoCompleteBox and the other features of the WPFToolkit, <a href="http://www.jeff.wilcox.name/2010/02/wpfautocompletebox/" target="_blank">Jeff Wilcox has provided links to the download and several useful blog posts</a>.</p>]]></content>
      <post-name type="text"><![CDATA[WPF AutoCompleteBox. finally!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="WPF" />
        <tag ref="csharp" />
        <tag ref="MVVM" />
      </tags>
      <comments>
        <comment id="580f47e7-001a-4c21-bfef-3539f35ebafe" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-05-11T08:26:31" date-modified="2010-05-11T08:26:31" approved="true" user-name="Bogdan" user-email="bogdanvarlamov@gmail.com" user-ip="66.23.240.66" user-url="">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[Can you post (or e-mail me) a complete .zip file of the solution + code files? I seem to be using the same code you have but end up with an error whenever I try to use a custom ItemFilter.]]></content>
        </comment>
        <comment id="af8f350b-9d07-41c3-926f-d4cd380cfb29" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-05-11T08:41:48" date-modified="2010-05-11T08:41:48" approved="true" user-name="Bogdan" user-email="bogdanvarlamov@gmail.com" user-ip="66.23.240.66" user-url="">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[Oh, I think I figured out what the problem was. 

In your code you have:

public AutoCompleteFilterPredicate&lt;Client&gt; ClientFilter 

Instead if you use 

public AutoCompleteFilterPredicate&lt;object&gt; ClientFilter 

the null reference error goes away.

The error occured at this line of the AutoCompleteBox source:

if (!inResults)
                {
                    inResults = stringFiltering ? TextFilter(text, FormatValue(item)) : ItemFilter(text, item);
                }

My guess is that the ItemFilter property was null because of the signature mismatch. Once I changed my code to match the signature (public AutoCompleteFilterPredicate&lt;object&gt;) everything started to work : )]]></content>
        </comment>
        <comment id="0aa85b96-cafd-4a89-957a-351248a0dd12" parentid="af8f350b-9d07-41c3-926f-d4cd380cfb29" date-created="2010-05-11T09:29:22" date-modified="2010-05-11T09:29:22" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.17.159.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[Yes the predicate is a generic, it is Predicate&lt;T&gt; where 'T' is the type of object being filtered.  In my example it was a list of clients.]]></content>
        </comment>
        <comment id="0319d165-2f25-433c-bbe6-b8076ba9f5cf" parentid="0aa85b96-cafd-4a89-957a-351248a0dd12" date-created="2010-05-11T10:12:06" date-modified="2010-05-11T10:12:06" approved="true" user-name="Bogdan" user-email="bogdanvarlamov@gmail.com" user-ip="66.23.240.66" user-url="">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[In the sourcecode for AutoCompleteBox it does not appear that the predicate is generic:

        public AutoCompleteFilterPredicate&lt;object&gt; ItemFilter
        {
            get { return GetValue(ItemFilterProperty) as AutoCompleteFilterPredicate&lt;object&gt;; }
            set { SetValue(ItemFilterProperty, value); }
        }

from https://wpf.svn.codeplex.com/svn/Toolkit-development/Input/AutoCompleteBox/System/Windows/Controls/AutoCompleteBox.cs]]></content>
        </comment>
        <comment id="ff8b382b-80c2-4c28-82cc-91122e33d9ab" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-15T15:08:19" date-modified="2010-09-15T15:08:19" approved="true" user-name="Sebasti&amp;#225;n Rodr&amp;#237;guez" user-email="sebasrodriguez@gmail.com" user-ip="200.40.249.158" user-url="">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[Could you also give me the full version by mail or post it here because i'm trying to bind to a list of custom objects but it doesn't works. 
So i want to know what i'm doing wrong.

thanks]]></content>
        </comment>
        <comment id="cd6ade08-5153-4586-b770-81da2e4b3c78" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-09-15T15:23:32" date-modified="2010-09-15T15:23:32" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="76.77.75.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: WPF AutoCompleteBox. finally!]]></title>
          <content type="text"><![CDATA[I didn't actually write the AutoCompleteBox it is part of the WPFToolkit which you should be able to find on the WPF site or Codeplex.  ]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="4ef432d3-3cf7-4d29-bd3b-6a14582a0e2a" date-created="2010-02-13T17:14:43" date-modified="2010-02-13T17:14:43" approved="true" post-url="/post/2010/02/13/The-return-of-psake.aspx" type="normal" hasexcerpt="false" views="0" is-published="False">
      <title type="text"><![CDATA[The return of psake]]></title>
      <content type="text"><![CDATA[<p>Amazingly, one of my most popular posts so far has been the one on using psake to automate build tasks.&#160; I was meaning to get further along on this far sooner than now, but have been distracted with Graphite and other newer things (new things are always more interesting than old things).&#160; However I do want to move these psake posts along, moving towards automated deployment is one of the best ways to eliminate friction in the development process and learning to use build scripts and continuous integration together is key to making that happen.&#160; So without further ado.</p>  <h4>Part 2: Running psake build scripts from TeamCity</h4>  <p>In <a href="http://www.lucisferre.net/post/2009/11/18/Automating-Deployment-with-TeamCity-and-psake.aspx" target="_blank">part 1</a> we went over how to create a simple script for an ASP.NET web app.&#160; The script allowed us to perform tasks like "clean", "compile" and "package" which put the entire web site into a zip file which definitely simplifies deployment.&#160; Now I want to take this a step further so that our CI server can do the deployment for us after testing the build.</p>  <p>The first thing I am going to suggest though is that you get PowerShell 2.0.&#160; The newer versions of psake only work with PS2 so you will be missing out on some of the newer features and the code I post here probably won't work for you.</p>  <p><strong>The Basic Script:</strong></p>]]></content>
      <post-name type="text"><![CDATA[The return of psake]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="4c9715d9-36dc-464d-a787-8ea65aa993f0" date-created="2010-02-01T13:32:00" date-modified="2010-03-28T11:06:04" approved="true" post-url="/post/2010/02/01/Vancouver-ALTNET-meetup-e28093-ASPNET-MVC-and-more.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Vancouver ALT.NET meetup - ASP.NET MVC and more]]></title>
      <content type="text"><![CDATA[<p>I probably should have posted this earlier, but there will be a meetup 6PM Feb 4th at the Library Square Pub downtown.&nbsp; You can go <a href="http://altnetvancouver.ning.com/events/aspnet-mvc-meetup-and">here to RSVP and for details</a>.&nbsp; It should be interesting.&nbsp; Here is a short list of some potential topics for discussion:</p>
<ul>
<li>ASP.NET MVC 
<ul>
<li>Why MVC is better than WebForms</li>
<li>Using s#arp architecture as scaffolding for rapid application development</li>
</ul>
</li>
<li>Silverlight web development (thanks to Justin Angel)
<ul>
<li>MVVM patterns</li>
<li>Composite application guidance (PRISM)</li>
<li>Silverlight and MVC together?</li>
</ul>
</li>
<li>JQuery
<ul>
<li>Role of JQuery in client-side functionality in ASP.NET MVC</li>
<li>corMVC (a jquery only client-side MVC framework)</li>
</ul>
</li>
</ul>
<p>The meetup will start around 6pm.&nbsp; There is parking available nearby at the library&rsquo;s underground parking lot.&nbsp; Everyone is welcome, spread the word.</p>]]></content>
      <post-name type="text"><![CDATA[Vancouver ALT.NET meetup - ASP.NET MVC and more]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5c2b051b-f6df-4b41-baa8-63eb610e5201" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="22488829-47f6-4140-bd30-5a9dbe7e89fd" />
      </categories>
      <tags>
        <tag ref="alt.net" />
        <tag ref="asp.net mvc" />
        <tag ref="s#arp architecture" />
        <tag ref="silverlight" />
        <tag ref="jquery" />
      </tags>
    </post>
    <post id="09d599e6-66f4-44e2-b291-e78c637e1e43" date-created="2010-01-27T18:01:00" date-modified="2010-04-25T20:47:42" approved="true" post-url="/post/2010/01/27/Graphite-Ite28099s-Alive!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Graphite: It's Alive!]]></title>
      <content type="text"><![CDATA[<p>Today I managed to put about 5 hours in on Graphite and managed to finish off the BlogML importer.&nbsp; While there are still a number of bugs the whole thing is pretty much working so I decided to deploy it for the first time.&nbsp; I had yet to deploy it into a shared hosting environment so I wanted to make sure there wouldn't be any problems.</p>
<p><a href="http://graphite.lucisferre.net/">Low and behold...</a></p>
<p>It is still early days, but feel free to log in and look around.&nbsp; You can use the User: admin Password: tester if you want to try it out while I am testing it.</p>
<p>There is still a lot to do before I will consider moving my blog over to Graphite.&nbsp; I have yet to add slug based links to the titles of each post and login/logout isn't quite working properly and a number of the views and links are not working right.&nbsp; For the most part it is working pretty well though.&nbsp; I did notice that the BlogML imported <em>all</em> of the undeleted spam because I didn't bother to check the "approved" flag before importing.</p>
<p>So while there is a lot to do, it has come a long way in two months as a spare-time project.&nbsp; Taking another look at&nbsp; my laundry list from last time:</p>
<ul>
<li><span style="text-decoration: line-through;">Can create/edit/delete blog posts</span></li>
<li><span style="text-decoration: line-through;">Can add comments to a post</span></li>
<li><span style="text-decoration: line-through;">Can create/edit/delete blog users</span></li>
<li><span style="text-decoration: line-through;">Users can login/logout and be authenticated to perform administrative tasks</span></li>
<li><span style="text-decoration: line-through;">Can show a standard RSS feed of posts</span> </li>
<li>Can ping blogging services </li>
<li>Can handle trackbacks from other blogs </li>
<li><span style="text-decoration: line-through;">Can import from other blog engines (or from RSS feeds at least) </span></li>
<li>Provide some form of comment spam protection (Askimet and/or Captcha) </li>
<li>Some sort of twitter following plug-in </li>
</ul>
<p>The Atom feed seems broken though.&nbsp; So now I need to work on the staple blog features like, trackbacks, pings, and comment spam protection.&nbsp; I am going to add a couple more features to the queue now:</p>
<ul>
<li>BlogML Import can migrate local files and images over (this could be a bit tricky)</li>
<li>Ability to create themes/skins for the blog</li>
<li>Simple UI for comment and post management</li>
<li>OpenID based comment authentication (optionally enabled)</li>
<li>DISQUS based comments (optionally enabled) 
<ul>
<li>Migrate tool to move local comments from the SQL DB to DISQUS [more]</li>
</ul>
</li>
</ul>
<p>Since I've used nHibernate, right out of the box Graphite should already support just about any database nHibernate supports, though I'll admit I have only tested with SQLExpress so far.&nbsp; I also don't know if it will run under Mono, but my guess is the code should be compatible with Mono 2.6.</p>
<p>If you have any feature suggestions please leave them in the comments.</p>]]></content>
      <post-name type="text"><![CDATA[Graphite: It's Alive!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5c2b051b-f6df-4b41-baa8-63eb610e5201" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="d259b49c-a79d-456b-97d9-c4b585a4a0ef" />
        <category ref="22488829-47f6-4140-bd30-5a9dbe7e89fd" />
      </categories>
      <tags>
        <tag ref="graphite" />
        <tag ref="asp.net mvc" />
        <tag ref="s#arp architecture" />
        <tag ref="blogging" />
      </tags>
      <comments>
        <comment id="e38027f3-e07f-4dde-bd8d-7632b87be276" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-02-05T17:00:51" date-modified="2010-02-05T17:00:51" approved="true" user-name="Anthony" user-email="Anthony@PlasticAvalon.org" user-ip="78.86.147.234" user-url="">
          <title type="text"><![CDATA[re: Graphite: It's Alive!]]></title>
          <content type="text"><![CDATA[I get a &quot;Server Error in '/' Application.&quot; when trying to log in.
]]></content>
        </comment>
        <comment id="9d583022-9e2c-4eb3-b385-400a4c968574" parentid="e38027f3-e07f-4dde-bd8d-7632b87be276" date-created="2010-02-06T02:16:28" date-modified="2010-02-06T02:16:28" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Graphite: It's Alive!]]></title>
          <content type="text"><![CDATA[Odd, I can login fine.  There was a problem earlier with medium trust not being set, but I had my hosting provider fix that.  

I don't have any error handling at the moment for the application so if you login with the wrong username/password it will have a &quot;server error&quot; message.  Just make sure to use admin/tester.]]></content>
        </comment>
        <comment id="d05b8178-ea90-4e09-8feb-471791b3d35a" parentid="9d583022-9e2c-4eb3-b385-400a4c968574" date-created="2010-02-06T23:35:19" date-modified="2010-02-06T23:35:19" approved="true" user-name="Anthony" user-email="Anthony@PlasticAvalon.org" user-ip="85.92.214.142" user-url="">
          <title type="text"><![CDATA[re: Graphite: It's Alive!]]></title>
          <content type="text"><![CDATA[Yep, I was getting your login failure.]]></content>
        </comment>
        <comment id="2ab19eb8-1a83-43f8-8bad-e0d92036cd13" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-02-09T04:26:55" date-modified="2010-02-09T04:26:55" approved="true" user-name="Anthony" user-email="Anthony@PlasticAvalon.org" user-ip="85.92.214.142" user-url="">
          <title type="text"><![CDATA[re: Graphite: It's Alive!]]></title>
          <content type="text"><![CDATA[So what is the scope of the Graphite blog engine? From &quot;Users can login/logout and be authenticated to perform administrative tasks&quot; statement I assume that there can be more than one user. Can it host more than one blog? Is a commenter a user, logged in via OpenId or the like?]]></content>
        </comment>
        <comment id="84469d02-9494-4f1d-aa59-74f654bd31fb" parentid="2ab19eb8-1a83-43f8-8bad-e0d92036cd13" date-created="2010-02-10T12:40:33" date-modified="2010-02-10T12:40:33" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Graphite: It's Alive!]]></title>
          <content type="text"><![CDATA[Initially, no.  I find that most people do not use multiblog engines for their own blogging, but eventually I will probably add that feature since it shouldn't be very difficult.  I do plan to allow commenters to log in with openID though.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="39acd904-988d-4631-90ca-18957932afce" date-created="2010-01-22T10:58:00" date-modified="2010-03-25T17:46:30" approved="true" post-url="/post/2010/01/22/Even-images-need-boundaries.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Even images need boundaries]]></title>
      <content type="text"><![CDATA[<p>This morning I was looking for some simple code to do basic resizing of images.&nbsp; A website I am working on has an image upload and the upload needs to restrict the images to maximum height and width values.&nbsp; This is a very simple and probably fairly common task.&nbsp; As a rule, I don't usually keep a reference library worth of code snippets in my head (or anywhere for that matter) since I can quickly google anything when I need it and doing so I found <a href="http://www.mikeborozdin.com/post/High-Quality-Image-Resizing-with-NET.aspx">this post</a> which had a solution I liked.</p>
<p>Immediately upon reading the code, something about the geometry of the solution seemed off to me.&nbsp; As far as I could tell, this would only correctly shrink the image if the boundary values were 1:1.&nbsp; Clearly, no such restriction is placed on the input values, so we can assume that this is a bug.&nbsp; I made some corrections and did some "clean-code" refactoring and ended up with what I thought was working code.&nbsp; Actually, trying it out revealed another bug though, the logic was entirely backwards.&nbsp;</p>
<p>It was resizing by the width when it needed to use height and vice versa.&nbsp; A couple more changes and some more "clean-code" refactoring and the final corrected code is as follows:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d399fd0a-36bc-4a48-8591-7db3c942f788" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px; white-space: nowrap">
<li><span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#2b91af">Image</span> ResizeImage(<span style="color:#2b91af">Image</span> original, <span style="color:#0000ff">int</span> maxHeight, <span style="color:#0000ff">int</span> maxWidth) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">if</span> (ImageIsSmallerThanMaxSize(original, maxWidth, maxHeight)) <span style="color:#0000ff">return</span> original;</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">var</span> scaleFactor = (AspectRatioIsLessThanMaxRatio(original, maxWidth, maxHeight))</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? <span style="color:#2b91af">Decimal</span>.Divide(maxHeight, original.Height)</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span style="color:#2b91af">Decimal</span>.Divide(maxWidth, original.Width);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> ScaleImage(original, scaleFactor);</li>
<li>}</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li><span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#2b91af">Bitmap</span> ScaleImage(<span style="color:#2b91af">Image</span> original, <span style="color:#0000ff">decimal</span> scaleFactor) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">var</span> output = <span style="color:#0000ff">new</span> <span style="color:#2b91af">Bitmap</span>((<span style="color:#0000ff">int</span>) (original.Width * scaleFactor),(<span style="color:#0000ff">int</span>) (original.Height * scaleFactor));</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">var</span> tmpGraph = <span style="color:#2b91af">Graphics</span>.FromImage(output);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;tmpGraph.InterpolationMode = System.Drawing.Drawing2D.<span style="color:#2b91af">InterpolationMode</span>.HighQualityBilinear;</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;tmpGraph.DrawImage(original, 0, 0, output.Width, output.Height);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> output;</li>
<li>}</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li><span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">bool</span> ImageIsSmallerThanMaxSize(<span style="color:#2b91af">Image</span> original, <span style="color:#0000ff">int</span> maxWidth, <span style="color:#0000ff">int</span> maxHeight) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> original.Width &lt; maxWidth &amp;&amp; original.Height &lt; maxHeight;</li>
<li>}</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li><span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">bool</span> AspectRatioIsLessThanMaxRatio(<span style="color:#2b91af">Image</span> original, <span style="color:#0000ff">int</span> maxWidth, <span style="color:#0000ff">int</span> maxHeight) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> <span style="color:#2b91af">Decimal</span>.Divide(original.Width, original.Height) &lt; <span style="color:#2b91af">Decimal</span>.Divide(maxWidth, maxHeight);</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>I think you will agree that not only is the code correct but it is much clearer that it is in-fact correct.&nbsp; So what can I take away from this:</p>
<ul>
<li>Always try to double check your blog post code (I'm sure this statement is going to bite me in the ass)</li>
<li>Never take anything you find via. Google or the internets for granted</li>
<li>Cleanliness is next to correctness</li>
<li>I should have TDD'd this code</li>
</ul>]]></content>
      <post-name type="text"><![CDATA[Even images need boundaries]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="csharp" />
        <tag ref="coding" />
      </tags>
    </post>
    <post id="838a0086-6ef3-4b8d-b82b-00e059bb4b53" date-created="2010-01-12T09:17:00" date-modified="2010-05-21T08:34:45" approved="true" post-url="/post/2010/01/12/My-goals-for-2009.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[A brief retrospective and my goals for 2009]]></title>
      <content type="text"><![CDATA[<p>Seems lots of people are doing this these days.&nbsp; Both <a href="http://scottmuc.com/blog/development/my-developer-resolutions-for-2010/">Scott Muc</a> and <a href="http://graysmatter.codivation.com/post/Your-2010-New-Years-Resolutions-%28thats-right-I-said-yours%29.aspx">Justice Gray</a> have posted theirs, well... Justice actually posted <em>yours</em>.</p>
<p>Usually, I just keep an general idea of my goals in mind.&nbsp; This keeps my goal setting flexible, but it makes it really hard to measure my progress relative to goals and doesn't make me very accountable to them.&nbsp; This year I remedying that by posting them here on my blog.[more]</p>
<p>First a little retrospective of how I think I did last year.&nbsp; Thinking back to early last year my goals were things like:</p>
<ul>
<li>Learn and use nHibernate in my projects </li>
<li>Learn to use messaging in service architecture </li>
<li>Learn to use IoC framworks </li>
<li>Start learning Agile programming </li>
<li>Start blogging and do it regularly </li>
<li>Read more books on coding 
<ul>
<li>Specifically: Read DDD by Eric Evans </li>
</ul>
</li>
<li>Start using TDD in all my development work </li>
<li>Begin to branch out to more clients as a contractor </li>
</ul>
<p>On framework learning I did fairly well,&nbsp; I've become very comfortable with using nHibernate and I can comfortably configure and customize it for most situations.&nbsp; For messaging, I actually learned by building a small simple message bus architecture (I will do a short blog post on it in the near future).&nbsp; Inversion of control containers originally confused me, now I use Castle Windsor IoC container in every new project I start.</p>
<p>In the agile category, I invested quite a bit of time into books like "Clean Code" and "Pragmatic Thinking and Learning" as well as many of the "agile themed" blogs.&nbsp; I attended both DevTeach and the excellent Much Ado About Agile conference put on by Agile Vancouver this year.&nbsp; Both conferences were incredible learning experiences for me at this stage in my career.</p>
<p>I've kept up with my blogging as well. It has been something I really enjoy and I find it is helpful to write about my work and what I am learning.&nbsp; It is an excellent way to reflect on things.&nbsp; Since starting this blog in May I have managed 66 posts and 6 in December alone.&nbsp; My goal was to average one a week so I'd say that was achieved handily.</p>
<p>my reading goals fell short a bit.&nbsp; I finished most of "Clean Code" and all of "Pragmatic Thinking and Learning", but I really wanted to complete DDD and some of the other "masterworks".&nbsp; That said, I did manage to read a lot of blog posts this year.&nbsp; I also learn by doing, so much of my learning came from writing code and reading code in open source projects.&nbsp;&nbsp;&nbsp; I'd maybe give myself a B- here, but I was never really a hard marker as a T.A. so.</p>
<p>TDD was a real challenge too.&nbsp; I've learned that it is a technique that requires time and practice to master.&nbsp; I've learned to write tests and can use them to drive my design, but I am not sure that I feel confident in my TDD use yet.&nbsp; This year I will continue to practice my TDD and also explore BDD.</p>
<p>Where I made no progress whatsoever was exploring work opportunities with new clients.&nbsp; While I certainly did not lack for work (my sole client always has something on the go) it is still very important for me to form new business relationships.&nbsp; This is an area I will definitely not neglect in the early part of this year.</p>
<p>Of course those were not the only things I managed to cram into last year (I also have been learning Salsa!) just a some goals I had in mind early last year.</p>
<p>My goals (so far) for 2009 are as follows (I'll stick to my professional goals and leave the salsa dancing out):</p>
<ul>
<li><strong>Read Domain Driven Design</strong> <em>and</em> the new chapter Eric Evans gave me at the conference (if I read nothing else I will read this book this year) </li>
<li>Develop at least two new client relationships </li>
<li>Complete the first release candidate for Graphite </li>
<li>Contribute to at least one open source project </li>
<li>Practice my TDD technique and start learning BDD </li>
<li>Organize discussions/talks with ALT.NET locally </li>
<li>Submit at least one presentation/talk to a conference (doesn't have to be a big one) </li>
<li>And of course. be more like Ju<a href="http://graysmatter.codivation.com/">stice Gray</a> (or at least try to make my blog posts a little less dry) </li>
<li>Learn Ruby on Rails (if I still have time after everything else) </li>
</ul>
<p>I think those are some pretty good goals to start with for this year.&nbsp; As I said, I like to be flexible so I will try to review these every few months to see if I still have the same goals.&nbsp; Now I just need to work on a plan to achieve all these goals.</p>]]></content>
      <post-name type="text"><![CDATA[A brief retrospective and my goals for 2009]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <tags>
        <tag ref="agile" />
        <tag ref="goals" />
        <tag ref="blogging" />
        <tag ref="coding" />
      </tags>
    </post>
    <post id="a080e0b2-376f-4d2a-ab9c-cde1db3fd091" date-created="2010-01-10T16:39:00" date-modified="2010-03-28T11:06:04" approved="true" post-url="/post/2010/01/10/A-Tag-by-any-other-name.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[A Tag by any other name.]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.lucisferre.org/image.axd?picture=tagcloud.jpg"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="tagcloud" src="http://www.lucisferre.org/image.axd?picture=tagcloud_thumb.jpg" border="0" alt="tagcloud" width="240" height="221" align="right" /></a> I have really enjoyed working on Graphite lately, which has actually made it hard to blog about it since I am having trouble tearing my self away from the code long enough to write a post.&nbsp; The progress has been pretty good so far.&nbsp; Just to update from last time I have added an RSS and Atom feed that uses the System.ServiceModel.Syndication API.&nbsp; I have also added tagging to posts (thinking about tags for comments too).</p>
<p>One of the thing that occurred to me while implementing tags was that I didn&rsquo;t really need both categories <em>and</em> tags.&nbsp; While it is true that most blogs support both categories and tags, I honestly can&rsquo;t tell you functionally what&rsquo;s the difference.&nbsp; What functionality does the category provide that the tag doesn&rsquo;t or can&rsquo;t? - That isn&rsquo;t a rhetorical question, if anyone can answer it please do.[more]</p>
<p>Tags seem almost like an evolution of categories.&nbsp; Tags are intended to be easy to use, flexible and dynamic.&nbsp; Tags tend to stay more relevant and current than static categories.&nbsp; Most tag interfaces will let you type out new ones as you need them and usually auto-hint previously used tags so you don&rsquo;t end up with C# and csharp <em>and &ldquo;</em>c sharp&rdquo; all as tags.&nbsp;</p>
<p>BlogEngine.NET supports both tags and categories, you can select multiple categories for a post (just like tags) and even nest&nbsp; your categories into a hierarchy.&nbsp; You can see both a category list and a tag cloud on the right side of my site.&nbsp;&nbsp; Technically the tag cloud could be a category list, with post counts and even RSS feeds for each tag but it isn&rsquo;t.&nbsp; That&rsquo;s because in general we feel that a tag cloud is a more useful visual representation, if it wasn&rsquo;t we would just display our tags like our categories.&nbsp; Clearly we feel this is a superior way to organize blog posts.</p>
<p>Both RSS feeds and BlogML (which I am using as an import/export format) only define a categories item and not tags.&nbsp; This generally means that if you are importing content from a blog that has both categories and tags you can only bring over one of the two, or merge them both.&nbsp; Well, in that case I would choose my tags and by not implementing both I can ensure Graphite users will not ever have this problem.</p>
<p>Until someone can convince me otherwise categories will not be a feature in Graphite, only tags.&nbsp; This will allow me to focus on providing better functionality built around tags alone, including tag management, and perhaps even <em>tag-categorization </em>which I can see being potentially useful.</p>
<p><em>Afterthought</em>: I just googled this topic after writing this and found these two old posts debating the same thing.&nbsp; <a href="http://www.duncanmackenzie.net/blog/categories-vs-tags-in-blogs-and-blog-editors/" target="_blank">Duncan Mackenzie</a> seems to agree and decided to do away with categories as well, while <a href="http://haacked.com/archive/2006/09/27/Categories_vs_Tags.aspx" target="_blank">Phil Haack</a> defends categories as &ldquo;a structural element and navigational aid&hellip; &hellip;a way to group posts into large high-level groupings&rdquo;</p>
<p>I&rsquo;m not sure I really understand what Phil is trying to say there, but it seems like a lot to expect from a lowly category.&nbsp; I don&rsquo;t really agree with the &lsquo;use categories sparingly&rsquo; and &lsquo;use tags liberally&rsquo; suggestions either.&nbsp; Keeping a few categories with large numbers of posts doesn&rsquo;t really people find relevant content any more than liberally using tags which is likely to dilute their value and lead to a <strong>tag fog</strong>&hellip; <a href="http://haacked.com/Tags/default.aspx" target="_blank">*ahem*</a>.</p>
<p>In the end I don&rsquo;t think it matters that much how we <em>define </em>the difference but what practical examples tell us.&nbsp; Do many blogs actually use both categories and tags in a way that separates them into two clearly definable functions?</p>]]></content>
      <post-name type="text"><![CDATA[A Tag by any other name.]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="2c07e59a-ca1c-4daa-8218-0cb00efde8b7" />
      </categories>
      <tags>
        <tag ref="graphite" />
        <tag ref="blogging" />
        <tag ref="opinion" />
      </tags>
      <comments>
        <comment id="6dd5d0f3-f0f0-4a10-9827-165021254521" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-08T14:57:33" date-modified="2010-01-08T14:57:33" approved="true" user-name="Scott Muc" user-email="smuc@thoughtworks.com" user-ip="70.75.2.163" user-url="http://scottmuc.com/">
          <title type="text"><![CDATA[re: A Tag by any other name.]]></title>
          <content type="text"><![CDATA[I totally agree with you. I used categories on my blog and then eventually realized that there's no point. The inner conflict of what should be a tag vs category ends up taking a lot of time.

Once you start with categorizes then you want to categorize everything. Doing away with the categories removes that choice therefore you think about better tagging strategies.

I'm having the same dilema with organizing Evernote right now. It has tags and notebooks (which is essentially a category). I'm starting to do away with my notebooks now too and using some sort of specification (saved search) as an encapsulation of a category.

How about this for your blog engine. Allow the user to determine categories by specifying some sort of rules on the tags. Eg: A category of Agile is anything that matches [agile], [tdd], [xp], [scrum], [pair-programming]. 

]]></content>
        </comment>
        <comment id="f4c3a764-b480-4c82-afd5-9b44b59a0d8f" parentid="6dd5d0f3-f0f0-4a10-9827-165021254521" date-created="2010-01-09T01:04:46" date-modified="2010-01-09T01:04:46" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: A Tag by any other name.]]></title>
          <content type="text"><![CDATA[Exactly what I was thinking.  I was considering having categories for grouping tags rather than posts.  Then the category has a clear and distinct purpose.]]></content>
        </comment>
        <comment id="687ce43a-1bf2-4d5e-a0c5-cd78817913b3" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-09T18:16:25" date-modified="2010-01-09T18:16:25" approved="true" user-name="Mike Maskery" user-email="mikem@ece.ubc.ca" user-ip="66.46.103.18" user-url="">
          <title type="text"><![CDATA[re: A Tag by any other name.]]></title>
          <content type="text"><![CDATA[
Perhaps tags are supposed to be searchable, while categories are supposed to be browseable.  Yes, you can search for categories, and you can browse tags, so on a macro-level they're more or less equivalent.  Categories also lend themselves well to sub-categories, while I've never heard of a sub-tag (although perhaps you could invent a hierarchical tagging structure)...]]></content>
        </comment>
        <comment id="915cd5f3-2b89-459b-a21f-38ea88d74ec3" parentid="687ce43a-1bf2-4d5e-a0c5-cd78817913b3" date-created="2010-01-11T22:55:57" date-modified="2010-01-11T22:55:57" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.139.204.161" user-url="http://lucisferre.net/">
          <title type="text"><![CDATA[re: A Tag by any other name.]]></title>
          <content type="text"><![CDATA[Nested categories are definitely distinct from tags, the question is are they actually useful in the blogging context?  I don't think nested tags are a good idea, we can apply multiple tags in a simple and flexible way already, nested tags can't add to much to this.

Relying on the dictionary definition, &quot;a division in a system of classification&quot; we can see categories as truly distinct from tags.  Categories should separate the things they classify, i.e., [i]belonging to one category should exclude belonging to any other category at the same level of hierarchy [/i](you could also belong to a subcategory of a category you belong too, but not of a category you don't).  In single-user blogging I don't see the value of being able to divide blog posts like this.

Categories would make sense on a site like http://www.massively.com/ which blogs about every MMO out there.  WoW and AoC would definitely be two separate categories in this case.  However, that is a multi-blog and multi-author environment (with multiple domains too), quite a different context from a single-user blog.  If I ran a personal blog about MMO gaming then WoW and AoC would probably just be tags for me.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="19f5da67-3e66-4061-acbf-c6f52149c543" date-created="2010-01-08T16:51:00" date-modified="2010-01-10T11:17:55" approved="true" post-url="/post/2010/01/08/TekPub-Linq-Challenge!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[TekPub Linq Challenge!]]></title>
      <content type="text"><![CDATA[<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:1ded8a29-62fd-44b2-ae66-5d280f2c2940" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px; white-space: nowrap">
<li><span style="color:#0000ff">var</span> primes = <span style="color:#2b91af">Enumerable</span>.Range(1, n)</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;.Where(x =&gt; (x &gt; 1 &amp;&amp; x &lt; 4) || </li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!<span style="color:#2b91af">Enumerable</span>.Range(2, x/2 - 1).Any(p =&gt; x % p == 0));</li>
</ol></div>
</div>
</div>
<p><a title="http://www.codethinked.com/post/2010/01/08/TekPubs-Mastering-LINQ-Challenge.aspx" href="http://www.codethinked.com/post/2010/01/08/TekPubs-Mastering-LINQ-Challenge.aspx">http://www.codethinked.com/post/2010/01/08/TekPubs-Mastering-LINQ-Challenge.aspx</a></p>
<p><a title="http://www.tekpub.com/" href="http://www.tekpub.com/">http://www.tekpub.com/</a></p>
<p>Edit: This is definitely a pretty lazy solution I will admit ;P</p>]]></content>
      <post-name type="text"><![CDATA[TekPub Linq Challenge!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <comments />
      <trackbacks />
    </post>
    <post id="f7d66eba-738b-434b-a98d-e1632eaea2c5" date-created="2009-12-31T18:00:18" date-modified="2010-07-02T09:15:07" approved="true" post-url="/post/2009/12/31/Graphite-Update-The-AutoMapFilter-for-Model-e280933e-ViewModel-mapping.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Using an AutoMapFilter for Model -> ViewModel mapping]]></title>
      <content type="text"><![CDATA[<p>This is my second post on the development of Graphite.&#160; So far progress has been slow but good and I have learned a lot.&#160; </p>  <p>To get started I managed to come up with a basic list of features the blog engine needs so I can work on them one-by-one, so far I have:</p>  <ul>   <li><strike>Can create/edit/delete blog posts</strike></li>    <li><strike>Can add comments to a post</strike></li>    <li><strike>Can create/edit/delete blog users</strike></li>    <li><strike>Users can login/logout and be authenticated to perform administrative tasks</strike></li>    <li>Can show a standard RSS feed of posts</li>    <li>Can ping blogging services</li>    <li>Can handle trackbacks from other blogs </li>    <li>Can import from other blog engines (or from RSS feeds at least)</li>    <li>Provide some form of comment spam protection (Askimet and/or Captcha)</li>    <li>Some sort of twitter following plugin</li> </ul>  <p>The twitter plugin isn't completely necessary but I like the one that I have with BlogEngine and it is a good excuse to try out the twitter API.&#160; </p>  <p>While it has been a slow start, I am just learning ASP.NET MVC, s#arp architecture and Spark so there are many challenges as I learn the architecture.&#160; A number of people in the .NET community have been a big help to me but I want to mention two in particular as they are both relevant to what I am going to show later.</p>  <p>First, I really like <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/tags/ASP.NET+MVC/default.aspx">Jimmy Bogard's posts on MVC</a> particularly the posts on <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/10/28/mvc-best-practices.aspx">MVC best practices</a> and "<a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/04/24/how-we-do-mvc.aspx">How we do MVC</a>".&#160; More recently, <a href="http://consultingblogs.emc.com/howardvanrooijen/">Howard van Rooijen</a> and some of his colleagues have re-released their "<a href="http://whocanhelpme.codeplex.com/">Who Can Help Me</a>" web application using #A and a few other open source tools.&#160; It is a great example of how to build a #A based app right and has provided me with some excellent guidance.</p>  <p>One 'best practice' I took away from all this was matching each strongly-typed view with a ViewModel rather than passing the Model directly to the view.&#160; There are many reasons why you should do this but I won't get into them here as Jimmy has some good articles on this already.&#160; </p>  <p>In order to facilitate the mundane and repetitive task of mapping fields from Model to ViewModel Jimmy has thoughtfully provided us with <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/01/22/automapper-the-object-object-mapper.aspx">AutoMapper</a> which Howard has also used in WCHM.&#160; WCHM actually wraps the AutoMapper in interfaces which can then be used for dependency injection.&#160; However Jimmy takes a bit of different approach and shows how to perform <a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/06/29/how-we-do-mvc-view-models.aspx">mapping using an ActionFilter attribute</a>.&#160; This allows us to use attributes to handle the mapping.&#160; Then you simply decorate the Action with an attribute like [AutoMap(typeof(ModelType), typeof(ViewModelType)] and the ActionFilter handles mapping the Model data contained in the ActionResult to the ViewModel.</p>  <p>What I wanted was the best of both worlds, wrapping the mappers like in WCHM but still being able to use Jimmy's ActionFilter approach.&#160; Something that could work like this if I just wanted a generic automapper:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:852af642-4dee-484a-bc80-16f96399439b" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li>[<span style="color:#2b91af">AutoMap</span>(<span style="color:#0000ff">typeof</span>(<span style="color:#2b91af">Post</span>),<span style="color:#0000ff">typeof</span>(<span style="color:#2b91af">ShowPostWithComments</span>))]</li> <li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#2b91af">ActionResult</span> Show(<span style="color:#2b91af">Guid</span> id) {</li> <li>&#160;&#160;<span style="color:#2b91af">Post</span> post = _posts.GetWithComments(id);</li> <li style="background: #f3f3f3">&#160;&#160;<span style="color:#0000ff">return</span> View(post);</li> <li>}</li> </ol> </div> </div> </div>  <p>or like this if I want to use a specific mapper that I've registered to my container:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:508b48ab-6f56-40c9-98c9-393d10b5d186" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li>[<span style="color:#2b91af">AutoMap</span>(<span style="color:#0000ff">typeof</span>(<span style="color:#2b91af">IUserIndexMapper</span>))]</li> <li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#2b91af">ActionResult</span> Index() {</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">return</span> View(_userTasks.GetUsers());</li> <li style="background: #f3f3f3">}</li> </ol> </div> </div> </div>  <p>In order to do this I modified the ActionFilter from Jimmy's post like this:</p>  <p></p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6741251b-0c8a-4270-8c31-9f20da16c705" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li>[<span style="color:#2b91af">AttributeUsage</span>(<span style="color:#2b91af">AttributeTargets</span>.Method, AllowMultiple = <span style="color:#0000ff">false</span>)]</li> <li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">AutoMapAttribute</span> : <span style="color:#2b91af">ActionFilterAttribute</span> {</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">readonly</span> <span style="color:#2b91af">Type</span> _sourceType;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">readonly</span> <span style="color:#2b91af">Type</span> _destType;</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">readonly</span> <span style="color:#2b91af">Type</span> _mapperType;</li> <li style="background: #f3f3f3">&nbsp;</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> AutoMapAttribute(<span style="color:#2b91af">Type</span> sourceType, <span style="color:#2b91af">Type</span> destType) {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_sourceType = sourceType;</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_destType = destType;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> AutoMapAttribute(<span style="color:#2b91af">Type</span> mapperType) {</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_mapperType = mapperType;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#2b91af">Type</span> SourceType { <span style="color:#0000ff">get</span> { <span style="color:#0000ff">return</span> _sourceType; } }</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#2b91af">Type</span> DestType { <span style="color:#0000ff">get</span> { <span style="color:#0000ff">return</span> _destType; } }</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">override</span> <span style="color:#0000ff">void</span> OnActionExecuted(<span style="color:#2b91af">ActionExecutedContext</span> filterContext) {</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#2b91af">IMapper</span> mapper;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">if</span> (_mapperType != <span style="color:#0000ff">null</span>) mapper = (<span style="color:#2b91af">IMapper</span>) <span style="color:#2b91af">ServiceLocator</span>.Current.GetInstance(_mapperType);</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">else</span> mapper = GetDefaultMapperFor(SourceType, DestType);</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">var</span> filter = <span style="color:#0000ff">new</span> <span style="color:#2b91af">AutoMapFilter</span>(mapper);</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;filter.OnActionExecuted(filterContext);</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#2b91af">IMapper</span> GetDefaultMapperFor(<span style="color:#2b91af">Type</span> sourceType, <span style="color:#2b91af">Type</span> destType) {</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#2b91af">Type</span> genericClass = <span style="color:#0000ff">typeof</span> (<span style="color:#2b91af">IMapper</span>&lt;,&gt;);</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#2b91af">Type</span> constructedClass = genericClass.MakeGenericType(<span style="color:#0000ff">new</span>[] {sourceType, destType});</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">return</span> (<span style="color:#2b91af">IMapper</span>) <span style="color:#2b91af">Activator</span>.CreateInstance(constructedClass);</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li> <li>}</li> </ol> </div> </div> </div>  <p>The AutoMapAttrbute now has two constructors.&#160; The first one is if we just want to use a default generic automapper, this is virtually identical to Jimmy's example.&#160; The second one allows me to specify a specific automapper interface type I want to use. S#arp arch uses the common service locator so I just use that to access my IoC container and instantiate whichever mapper class I have registered.&#160; The actual filter is really simple:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:1cbe8551-9ad3-406a-b988-050f59d5687c" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">AutoMapFilter</span> : <span style="color:#2b91af">EmptyActionFilter</span> {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">readonly</span> <span style="color:#2b91af">IMapper</span> _mapper;</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> AutoMapFilter(<span style="color:#2b91af">IMapper</span> mapper) { _mapper = mapper; }</li> <li>&nbsp;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">override</span> <span style="color:#0000ff">void</span> OnActionExecuted(<span style="color:#2b91af">ActionExecutedContext</span> filterContext) {</li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">object</span> model = filterContext.Controller.ViewData.Model;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;filterContext.Controller.ViewData.Model = _mapper.MapFrom(model);</li> <li>&#160;&#160;&#160;&#160;}</li> <li style="background: #f3f3f3">}</li> <li>&nbsp;</li> <li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#0000ff">abstract</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">EmptyActionFilter</span> : <span style="color:#2b91af">IActionFilter</span>, <span style="color:#2b91af">IResultFilter</span> {</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">void</span> OnActionExecuting(<span style="color:#2b91af">ActionExecutingContext</span> filterContext) { }</li> <li style="background: #f3f3f3">&nbsp;</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">void</span> OnActionExecuted(<span style="color:#2b91af">ActionExecutedContext</span> filterContext) { }</li> <li style="background: #f3f3f3">&nbsp;</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">void</span> OnResultExecuting(<span style="color:#2b91af">ResultExecutingContext</span> filterContext) { }</li> <li style="background: #f3f3f3">&nbsp;</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">void</span> OnResultExecuted(<span style="color:#2b91af">ResultExecutedContext</span> filterContext) { }</li> <li style="background: #f3f3f3">}</li> </ol> </div> </div> </div>  <p>Finally, the generic mapper and interfaces are very similar to the ones from WCHM:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:4cad85c9-b828-4e87-b933-7104cd7779f5" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">interface</span> <span style="color:#2b91af">IMapper</span>&lt;TSource, TDest&gt; : <span style="color:#2b91af">IMapper</span> <span style="color:#0000ff">where</span> TSource : <span style="color:#0000ff">class</span> <span style="color:#0000ff">where</span> TDest : <span style="color:#0000ff">class</span> {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;TDest MapFrom(TSource source);</li> <li>}</li> <li style="background: #f3f3f3">&nbsp;</li> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">interface</span> <span style="color:#2b91af">IMapper</span> {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">object</span> MapFrom(<span style="color:#0000ff">object</span> source);</li> <li>}</li> </ol> </div> </div> </div>  <p></p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:1c237eb5-8d0c-4329-9a22-427359001c5d" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">GenericMapper</span>&lt;TSource, TDest&gt; : <span style="color:#2b91af">IMapper</span>&lt;TSource, TDest&gt; <span style="color:#0000ff">where</span> TDest : <span style="color:#0000ff">class</span> <span style="color:#0000ff">where</span> TSource : <span style="color:#0000ff">class</span> {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> GenericMapper() { <span style="color:#2b91af">Mapper</span>.CreateMap&lt;TSource, TDest&gt;(); }</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> TDest MapFrom(TSource source) { <span style="color:#0000ff">return</span> <span style="color:#2b91af">Mapper</span>.Map&lt;TSource, TDest&gt;(source); }</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">object</span> MapFrom(<span style="color:#0000ff">object</span> source) { <span style="color:#0000ff">return</span> MapFrom(source <span style="color:#0000ff">as</span> TSource); }</li> <li>}</li> </ol> </div> </div> </div>  <p></p>  <p>I'm really happy with how this works now, though I do wish that there was a more convention based approach.&#160; I don't really like using attributes and I think a convention based approach makes sense here.&#160; In other words we would always map our model to&#160; ViewnameViewModel whenever the action renders View.&#160; Keep in mind that since we are sticking to the 1:1 View:ViewModel rule this would be appropriate.</p>  <p>I would really like to thank both Jimmy and Howard for all their hard work in helping provide the .NET community with guidance on ASP.NET MVC.&#160; It has been invaluable to me. </p>]]></content>
      <post-name type="text"><![CDATA[Using an AutoMapFilter for Model -> ViewModel mapping]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5c2b051b-f6df-4b41-baa8-63eb610e5201" />
        <category ref="d259b49c-a79d-456b-97d9-c4b585a4a0ef" />
        <category ref="22488829-47f6-4140-bd30-5a9dbe7e89fd" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="graphite" />
        <tag ref="asp.net mvc" />
        <tag ref="sharp architecture" />
        <tag ref="automapper" />
      </tags>
    </post>
    <post id="0c0eb379-f939-406b-bfb9-a1130a5be664" date-created="2009-12-23T13:29:00" date-modified="2010-04-20T08:47:13" approved="true" post-url="/post/2009/12/23/nHibernate-Convention-over-Configuration-and-Constraints.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Convention over configuration with fluent nhibernate and AutoPersistenceModel]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.lucisferre.net/image.axd?picture=xmlschool_1.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 0px 6px 0px 0px; display: inline; border-top: 0px; border-right: 0px" title="xmlschool" border="0" alt="xmlschool" align="left" src="http://www.lucisferre.net/image.axd?picture=xmlschool_thumb.jpg" width="184" height="244" /></a>One of the things I get a fair bit of use out of is the fluent nHibernate project and the AutoPersistenceModel.&#160; If you are not very familiar with fluentNH or AutoPersistenceModel then I would suggest checking out their <a href="http://wiki.fluentnhibernate.org/Main_Page">wiki</a>, as what I am about to discuss, while not difficult, is some relatively advanced usage.</p>  <p>The purpose of AutoPersistenceModel is to automatically generate the nHibernate configuration (the HBM files if you are currently used to XML configuration) directly from your model based on Convention over Configuration, <a href="http://www.jameskovacs.com/blog/NETRocks475JamesKovacsOnConventionoverConfiguration.aspx">you can hear James Kovacs discuss this concept on .NET Rocks</a>.&#160; With tools like SchemaExport and SchemaUpdate it is even possible to automatically generate and execute DDL scripts against your database to keep the schema in sync with your model.&#160; This can be a bit rails like in it's use, in fact <a href="http://adventuresinagile.blogspot.com/">Adam Dymitruk</a> is currently working on a utility to extend the SchemaUpdate to allow the creation of versioned database scripts like rails has (ok Adam it's official, now you actually <em>have</em> <em>to </em>finish it!).</p>  <p>The default AutoPersistenceModel conventions are kept quite simple, so often you will need to do a bit of customization.&#160; One way to do this is through overrides which I showed how to use in <a href="http://www.lucisferre.net/post.aspx?id=1734653d-6df8-4aa8-8aef-c264406ced37">this post</a>, were I implemented an override for a self-referencing tree relationship.&#160; However, whenever possible, it is preferable to use fluentNH's conventions to do this.&#160; Conventions can be used define custom behavior in very flexible ways.&#160; Below I am going to show how this can be done to customize database constraints like <em>unique </em>and <em>index</em>. [more]</p>  <p>S#arp Architecture provides a <a href="http://wiki.sharparchitecture.net/Tutorial2DevDomainModel.ashx">[DomainSignature] attribute</a> which you can apply to your entity's properties.&#160;&#160; The attribute is used to denote the set of properties that uniquely define the entity and is similar to the concept of a <em>business key</em> often used in SQL database design.&#160; It is important to point out that the <em>DomainSignature should</em>&#160;<em>not be considered a primary key </em>and that you should <em>always use a surrogate primary key</em> generated either by the database or nHibernate (hilo and guid.comb are the two I prefer).</p>  <p>The domain signature can ensures that entities can be compared using the properties decorated with [DomainSignature].&#160; This is useful if say one object was loaded from the repository using nHibernate but another was constructed and I want to determine if I should treat them as the same entity.&#160; It is also useful to determine if a new entity will violate a uniqueness constraint you want to enforce.</p>  <p>A good example of a useful DomainSignature would be the slug of a blog post.&#160; A post also has an <em>id </em>for it's primary key<em>,</em> in most cases a guid, but the slug also uniquely identifies a post as well and no two posts can have the same slug.&#160; The only problem now is that when I generate my DDL I can see that nHibernate has no notion that it should enforce my uniqueness constraint.</p>  <p>What I want is for nHibernate and hence the database schema should be aware that DomainSignature implies a uniqueness constraint.&#160; Fortunately, fluent nHibernate conventions make this is quite easy.&#160; Fluent nHibernate defines an <em>AttributePropertyConvention&lt;T&gt;</em> base class for exactly this purpose and we can extend it like this:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:5cfc2d16-0a65-4872-b026-c82df251e9a3" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">DomainSignatureConvention</span> : <span style="color:#2b91af">AttributePropertyConvention</span>&lt;<span style="color:#2b91af">DomainSignatureAttribute</span>&gt; {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">protected</span> <span style="color:#0000ff">override</span> <span style="color:#0000ff">void</span> Apply(<span style="color:#2b91af">DomainSignatureAttribute</span> attribute, <span style="color:#2b91af">IPropertyInstance</span> instance) { </li> <li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.UniqueKey(instance.EntityType.Name + <span style="color:#a31515">&quot;DomainSignature&quot;</span>);&#160;&#160;&#160;&#160;</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li> <li>}</li> </ol> </div> </div> </div>  <p>The DomainSignatureConvention tells fluent that all properties that are decorated with [DomainSignature] should form a unique key.&#160; Now if I then define my entity like this:</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d54e305c-c2cc-4f98-a45c-8a3cb5f7b64a" class="wlWriterEditableSmartContent"> <div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt"> <div style="background: #fff; max-height: 300px; overflow: auto"> <ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">Price</span> : <span style="color:#2b91af">Entity</span> {</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;[<span style="color:#2b91af">DomainSignature</span>]</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">Security</span> Security { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;[<span style="color:#2b91af">DomainSignature</span>]</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">DateTime</span> PriceDate { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;[<span style="color:#2b91af">DomainSignature</span>]</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">bool</span> CanadianPrice { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">decimal</span> Bid { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li>&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">decimal</span> Ask { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">decimal</span> Close { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li> <li>}</li> </ol> </div> </div> </div>  <p></p>  <p>then SchemaExport will generate DDL like this:</p>  <div id="codeSnippetWrapper">   <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">     <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">create</span> <span style="color: #0000ff">table</span> Prices (</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    Id <span style="color: #0000ff">INTEGER</span> <span style="color: #0000ff">not</span> <span style="color: #0000ff">null</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   PriceDate DATETIME,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   CanadianPrice <span style="color: #0000ff">INTEGER</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   Bid <span style="color: #0000ff">NUMERIC</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   Ask <span style="color: #0000ff">NUMERIC</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   <span style="color: #0000ff">Close</span> <span style="color: #0000ff">NUMERIC</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   SecurityFk <span style="color: #0000ff">INTEGER</span>,</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">   <span style="color: #0000ff">primary</span> <span style="color: #0000ff">key</span> (Id),</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">  <span style="color: #0000ff">unique</span> (PriceDate, CanadianPrice)</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">)</pre>
<!--CRLF--></div>
</div>

<p>Except we have a small problem here.&#160; The foreign key for the many-to-one relationship on <em>Security</em> was not included in the <em>unique</em> constraint.&#160; To be quite honest I am not exactly sure why but I am guessing that the <em>AttributePropertyConvention </em>does not work with a reference.&#160; Instead I will need to add something to my <em>ReferenceConvention</em> which is provided by default with s#arp architecture.</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:2787227c-6879-4cc5-8c9a-f06d171b4095" class="wlWriterEditableSmartContent">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto">
<ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">ReferenceConvention</span> : <span style="color:#2b91af">IReferenceConvention</span> {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> Apply(FluentNHibernate.Conventions.Instances.<span style="color:#2b91af">IManyToOneInstance</span> instance) {</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.Column(instance.Property.Name + <span style="color:#a31515">&quot;Fk&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">if</span> (<span style="color:#2b91af">Attribute</span>.IsDefined(instance.Property, <span style="color:#0000ff">typeof</span> (<span style="color:#2b91af">DomainSignatureAttribute</span>)))</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.UniqueKey(<span style="color:#a31515">&quot;DomainSignature&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li>
<li>}</li>
</ol>
</div>
</div>
</div>

<p>I don't really like this as I don't think the attribute should be ignored, but it does at least change the above to <em>unique(PriceDate, CanadianPrice, SecurityFk).</em></p>

<p>There are obviously many other types of constraints we could use, you could create an attribute for defining indexing on certain properties like [Indexable("IndexName")] and create a convention like this:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:dc415913-baed-4310-ae51-951f5c4fcec1" class="wlWriterEditableSmartContent">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto">
<ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">IndexableAttribute</span> : <span style="color:#2b91af">Attribute</span> {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">private</span> <span style="color:#0000ff">readonly</span> <span style="color:#0000ff">string</span> _name;</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> IndexableAttribute(<span style="color:#0000ff">string</span> name) { _name = name; }</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">string</span> GetName() { <span style="color:#0000ff">return</span> _name; }</li>
<li>}</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">IndexableConvention</span> : <span style="color:#2b91af">AttributePropertyConvention</span>&lt;<span style="color:#2b91af">IndexableAttribute</span>&gt; {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;<span style="color:#0000ff">protected</span> <span style="color:#0000ff">override</span> <span style="color:#0000ff">void</span> Apply(<span style="color:#2b91af">IndexableAttribute</span> attribute, <span style="color:#2b91af">IPropertyInstance</span> instance) {</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.Index(attribute.GetName());</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;}</li>
<li>}</li>
</ol>
</div>
</div>
</div>

<p>Now I can create indicies by using the [Indexable("Name")] attribute.&#160; Properties with the same "Name" will be part of the same index constraint and indexed together.&#160; </p>

<p>I found it is actually a good idea to always index many-to-one relationships, something I briefly mentioned in a <a href="http://www.lucisferre.net/post.aspx?id=ef779300-206b-4582-a9d0-4275b328c8c9">previous post</a>.&#160; Now that I am using fluent nhibernate however I can't set the index property in the HBM files so I will need a convention for that.&#160; It also makes sense to set this indexing on all many-to-one relationships so there is a better way to do this that does not involve the use of an attribute, instead we implement IRefrenceConvention.&#160; S#arp architecture already includes this convention by default so we can just edit it:</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:0bc6d7e9-4abf-4c45-b26d-85fa8e16fca0" class="wlWriterEditableSmartContent">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto">
<ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">ReferenceConvention</span> : <span style="color:#2b91af">IReferenceConvention</span> {</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> Apply(FluentNHibernate.Conventions.Instances.<span style="color:#2b91af">IManyToOneInstance</span> instance) {</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.Column(instance.Property.Name + <span style="color:#a31515">&quot;Fk&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">if</span> (<span style="color:#2b91af">Attribute</span>.IsDefined(instance.Property, <span style="color:#0000ff">typeof</span> (<span style="color:#2b91af">DomainSignatureAttribute</span>)))</li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.UniqueKey(<span style="color:#a31515">&quot;DomainSignature&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span style="color:#0000ff">else</span> </li>
<li>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;instance.Index(instance.Property.Name + <span style="color:#a31515">&quot;Index&quot;</span>);</li>
<li style="background: #f3f3f3">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}</li>
<li>&#160;&#160;&#160;&#160;}</li>
</ol>
</div>
</div>
</div>

<p>Notice the if.else, if we have already defined <em>UniqueKey</em> defining Index would be redundant as unique key's are already indexed.&#160; When defining indexes you will typically see something like like the following DDL output from SchemaExport:</p>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">create</span> <span style="color: #0000ff">index</span> SecurityIndex <span style="color: #0000ff">on</span> Prices (SecurityFk)</pre>

  <br /></div>

<p>It is pretty easy to customize the behavior of the fluent nhibernate AutoPersistenceModel using conventions and I find it can be very useful to have this type of fine grained control over your database schema generation.</p>]]></content>
      <post-name type="text"><![CDATA[Convention over configuration with fluent nhibernate and AutoPersistenceModel]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="22488829-47f6-4140-bd30-5a9dbe7e89fd" />
      </categories>
      <tags>
        <tag ref="nhibernate" />
        <tag ref="fluentnh" />
        <tag ref="s#arp architecture" />
        <tag ref="coc" />
      </tags>
      <comments>
        <comment id="9df7c29e-1130-4f72-b799-9b3046cd65ee" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-15T09:07:33" date-modified="2010-01-15T09:07:33" approved="true" user-name="Pankaj" user-email="pankajmk@gmail.com" user-ip="99.146.31.10" user-url="http://www.dotnetspark.com/">
          <title type="text"><![CDATA[re: Convention over configuration with fluent nhibernate and AutoPersistenceModel]]></title>
          <content type="text"><![CDATA[Nice post...this is what i was looking for..you made my day...

Thanks
Pankaj]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="8751c02e-e675-41a0-aa8a-87a1a3343840" date-created="2009-12-23T12:55:00" date-modified="2010-02-24T13:44:55" approved="true" post-url="/post/2009/12/23/Mocking-methods-with-lambda-predicates-parameters.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Mocking methods with lambda predicates parameters]]></title>
      <content type="text"><![CDATA[<p>&nbsp;</p>
<p><a href="http://www.lucisferre.net/image.axd?picture=lambdareflection.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; margin-left: 0px; border-top: 0px; margin-right: 0px; border-right: 0px" title="lambdareflection" src="http://www.lucisferre.net/image.axd?picture=lambdareflection_thumb.png" border="0" alt="lambdareflection" width="115" height="115" align="left" /></a> I often work with lambda&rsquo;s, as I&rsquo;ve mentioned before I am a bit of a LINQ junkie.&nbsp; As a result I have started creating methods that takes predicates as parameters, however I was finding methods like this difficult to mock.&nbsp; It took a bit of doing but I finally managed to figure this out. [more]</p>
<p>I have such methods defined in an interface like this:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:9074cbd9-0d00-4a57-8ee0-0af2e5cd2cbb" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">interface</span> <span style="color:#2b91af">ILinqRepository</span>&lt;T&gt;</li>
<li style="background: #f3f3f3">{</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">void</span> Delete(T target);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;T FindOne(<span style="color:#0000ff">int</span> id);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;T FindOne(<span style="color:#2b91af">Expression</span>&lt;<span style="color:#2b91af">Func</span>&lt;T, <span style="color:#0000ff">bool</span>&gt;&gt; predicate);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">IQueryable</span>&lt;T&gt; FindAll();</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">IQueryable</span>&lt;T&gt; FindAll(<span style="color:#2b91af">Expression</span>&lt;<span style="color:#2b91af">Func</span>&lt;T, <span style="color:#0000ff">bool</span>&gt;&gt; predicate);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">void</span> Save(T entity);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">void</span> SaveAndEvict(T entity);</li>
<li style="background: #f3f3f3">}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>Now say I have a test for finding a particular entity from my repository</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:cbc9dc45-7b96-4131-902c-6076bf047a3a" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px; white-space: nowrap">
<li>[<span style="color:#2b91af">Test</span>]</li>
<li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> CanGetSecurityByISMNumber() {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;_securityRepository.Stub(m =&gt; m.FindOne(<span style="color:#0000ff">null</span>)).IgnoreArguments().Return(<span style="color:#2b91af">TestData</span>.Security);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">Assert</span>.That(_tasks.GetSecurityByISMNumber(<span style="color:#2b91af">TestData</span>.Security.IBMSecurityNumber) == <span style="color:#2b91af">TestData</span>.Security);</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>A pretty simple test where I am using some static <em>TestData</em> with the mock.&nbsp; However the problem I have with this test is that this test is not driving the design I want (TDD right), I am not actually testing what I want to test.&nbsp; I could implement <em>GetSecurityByISMNumber</em> to call <em>FindOne</em> with any predicate value and make this pass.</p>
<p>Instead what I can do is use RhinoMocks <em>Callback </em>feature like this:</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6c5d07f7-b3ce-4ca1-a5ed-36b094707145" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px; white-space: nowrap">
<li>[<span style="color:#2b91af">Test</span>]</li>
<li style="background: #f3f3f3"><span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> CanGetSecurityByISMNumber() {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;_securityRepository.Stub(m =&gt; m.FindOne(<span style="color:#0000ff">null</span>))</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.IgnoreArguments()</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Callback&lt;<span style="color:#2b91af">Expression</span>&lt;<span style="color:#2b91af">Func</span>&lt;<span style="color:#2b91af">Security</span>, <span style="color:#0000ff">bool</span>&gt;&gt;&gt;(p =&gt; p.Compile().Invoke(<span style="color:#2b91af">TestData</span>.Security))</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.Return(<span style="color:#2b91af">TestData</span>.Security);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">Assert</span>.That(_tasks.GetSecurityByISMNumber(<span style="color:#2b91af">TestData</span>.Security.IBMSecurityNumber) == <span style="color:#2b91af">TestData</span>.Security);</li>
<li style="background: #f3f3f3">}</li>
</ol></div>
</div>
</div>
<p>Perhaps a tad bit messy but I think it communicates my design intent clearly.&nbsp; I could also factor out the lambda there into it&rsquo;s own function like <em>QueryIsValid</em></p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:25772ef2-4308-41f7-b071-0f9dc5c69a2c" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px; white-space: nowrap">
<li><span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">bool</span> QueryIsValid(<span style="color:#2b91af">Expression</span>&lt;<span style="color:#2b91af">Func</span>&lt;<span style="color:#2b91af">Security</span>,<span style="color:#0000ff">bool</span>&gt;&gt; predicate) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> predicate.Compile().Invoke(<span style="color:#2b91af">TestData</span>.Security);</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>I should also note that if I wasn&rsquo;t using <em>Expression</em> here I could skip the call to <em>Compile</em> which would make it a bit more readable.</p>]]></content>
      <post-name type="text"><![CDATA[Mocking methods with lambda predicates parameters]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="832202cb-b074-4686-8c64-efb0d3a1aa9c" />
      </categories>
      <tags>
        <tag ref="tdd" />
        <tag ref="rhinomocks" />
        <tag ref="csharp" />
      </tags>
      <comments>
        <comment id="5034b50f-2ea5-4d8b-be4a-4db8c61fa7cb" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-12-22T07:38:29" date-modified="2009-12-22T07:38:29" approved="true" user-name="Derick Bailey" user-email="derickbailey@gmail.com" user-ip="24.167.33.86" user-url="http://derickbailey.lostechies.com/">
          <title type="text"><![CDATA[re: Mocking methods with lambda predicates parameters]]></title>
          <content type="text"><![CDATA[Hey Chris,

Are you just trying to test the signature of the Func? i thought you were wanting to test the implementation of the anonymous method to make sure it was filtering on the the right data...

(x =&gt; x.SomeProperty == somevalue)

and you were trying to verify that the code was calling SomeProperty == somevalue as the code that gets executed, to make sure you were filtering on the right property.]]></content>
        </comment>
        <comment id="7dfd7b36-5c77-43a4-bed8-5f92ba9aa331" parentid="5034b50f-2ea5-4d8b-be4a-4db8c61fa7cb" date-created="2009-12-22T18:31:11" date-modified="2009-12-22T18:31:11" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Mocking methods with lambda predicates parameters]]></title>
          <content type="text"><![CDATA[I am simply mocking the ILinqRepository which provides a method that takes Func as a parameter.  

I am trying to ensure that the class under test is using the repository as expected.  I suppose it is a bit of a simplistic test scenario though but if I don't require that the class under test use the repository properly then technically the test isn't really driving the design of the method.

I dunno maybe my approach to TDD is a bit off the mark.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="54396e88-00a2-42b8-aaff-35058abb559e" date-created="2009-12-15T17:44:00" date-modified="2009-12-15T17:45:31" approved="true" post-url="/post/2009/12/15/My-apologies.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[My apologies]]></title>
      <content type="text"><![CDATA[<p>Sorry if anyone has tried to use the "Contact" link at the top menu of the page.&nbsp; I had not set up the e-mail setting correctly and failed to test it properly.&nbsp; It should be set up correctly now.</p>
<p>Chris</p>]]></content>
      <post-name type="text"><![CDATA[My apologies]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="2ea91dd6-3995-4a7f-9a22-426466927d25" date-created="2009-12-15T15:39:00" date-modified="2010-07-02T09:15:07" approved="true" post-url="/post/2009/12/15/Hola-mi-amigos.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Hola mi amigos!]]></title>
      <content type="text"><![CDATA[<div id="scid:8747F07C-CDE8-481f-B0DF-C6CFD074BF67:1aed4f91-bac8-4708-b4ac-ec54d29f8994" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: right; padding-top: 0px"><a title="Az&uacute;car Negra backyard rehersal" rel="thumbnail" href="http://www.lucisferre.net/image.axd?picture=AzucarNegra2-8x6.jpg"><img src="http://www.lucisferre.net/image.axd?picture=AzucarNegra2.png" border="0" alt="" width="358" height="299" /></a></div>
<p>Well&nbsp; my wife and I had an incredible time in Cuba.&nbsp; Our salsa instructor <a href="http://www.vancubansalsa.com/">Julio Monterro</a>, along with his brother Alexis and his family and friends in Cuba, put together a trip to try to show us the very best of Cuba and certainly did not disappoint.&nbsp; It will be hard for me to even attempt to do justice to everything we saw and did in a blog post, but I will try to make the attempt anyways in the next month or so.&nbsp; For anyone who is interested in Salsa lessons or future trips to Cuba that Julio is planning feel free to check out the link above as he has put together a web site with some info and you can contact him there.&nbsp; I&rsquo;d also be happy to answer any questions people might have about how our trip went.</p>
<p>I would definitely recommend to anyone planning on a trip to Cuba, that you brush up on some Spanish before going.&nbsp; While Cubans make every effort possible to communicate with visitors to their country very few people speak more than a smattering of English.&nbsp; So if you can bring at least a smattering of Spanish with you, you will find that you will be able to at least carry on with some level of conversation.&nbsp; I really wish I had spent the time to do some language tapes or something before going.</p>
<p>Cuba truly is an incredible place.&nbsp; Though, I suppose if you are <em>really</em> into things like: cabs with seatbelts, the catalytic convertor, clean washrooms, smoking bans and cold weather Cuba may not be the country for you.&nbsp; If however, you are far more interested in meeting some of the friendliest and kindest people the world has, experiencing real live Afro-Caribbean music and culture, copious consumption of rum-based drinks, eating traditional Cuban food and partying and dancing with the locals every night, then I would highly recommend a trip to Cuba.</p>
<p>Muchos Gracias Julio y Alexis!</p>]]></content>
      <post-name type="text"><![CDATA[Hola mi amigos!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="c9544665-8ae2-41a0-b1b5-93a70ae5525f" />
      </categories>
      <tags>
        <tag ref="travel" />
      </tags>
    </post>
    <post id="5724af08-7272-471f-907c-5b35ef38de7d" date-created="2009-12-05T19:13:00" date-modified="2010-03-21T11:18:22" approved="true" post-url="/post/2009/12/05/Spam-The-battle-is-won-but-the-war-is-never-over.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Spam: The battle is won, but the war is never over]]></title>
      <content type="text"><![CDATA[<p><img style="float: left; margin: 6px;" src="/image.axd?picture=2009%2f12%2fwallofspam.jpg" alt="" width="226" height="300" /></p>
<p>Well I wanted to get one more post out before I go.&nbsp; I've been pretty dedicated to posting regularly since moving and I plan to stick to that commitment.&nbsp; I'm leaving Monday for Cuba which will be awesome and a desperately need a vacation right now.&nbsp; I will not even be taking my laptop!&nbsp; I do have some books though, I might try to get most of the way through <em>Lean Software Development</em> before I get back.</p>
<p>This weekend I thought I would finally tackle a small thorn in my side (actually a thorn in the side of just about anyone who has a blog) the comment spam.&nbsp; BE.NET is a great blog engine but I have noticed it has more spam problems than some.&nbsp; Before I switched I used to use ReCaptcha, but even that was starting to fail as spam technology finally seems to be able to get a decent percentage of the images correct now (edit: Justice tell me that they actually <em>pay</em> people to process the ReCaptcha forms).&nbsp; Actually when you think about it ReCaptcha is a terrible idea since as it's used, it likely is also helping some commercial OCR products learn.&nbsp; Those in turn are probably used in comment spam software to beat the challenge-response, just a theory though.</p>
<p>BE.NET thankfully comes with an Akismet plug-in that guards against spam, great but it doesn't seem to work properly.&nbsp; It also has a StopForumSpam plugin as a backup, so ideally if one fails the second one takes it's turn.&nbsp;</p>
<p>Despite this protection, I've noticed spam getting through on my blog as well as a couple other blogs using BE.NET that I read like <a href="http://graysmatter.codivation.com/">Justice Gray's</a>.&nbsp; Today I looked at the BE.NET code to try to figure out what might be happening.&nbsp; This is what I found:</p>
<p>[more]</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:b5635de1-1e84-4b53-b814-e8cbfdf944c0" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> RunCustomModerators(<span style="color:#2b91af">Comment</span> comment)</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">DataTable</span> dt = _customFilters.GetDataTable();</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dt.DefaultView.Sort = <span style="color:#a31515">"Priority"</span>;</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">foreach</span> (<span style="color:#2b91af">DataRowView</span> row <span style="color:#0000ff">in</span> dt.DefaultView)</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">string</span> fileterName = row[0].ToString();</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">ICustomFilter</span> customFilter = GetCustomFilter(fileterName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">if</span> (customFilter != <span style="color:#0000ff">null</span> &amp;&amp; customFilter.Initialize())</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment.IsApproved = !customFilter.Check(comment);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment.ModeratedBy = fileterName;</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateCustomFilter(fileterName, comment.IsApproved);</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000">// the custom filter tells no further</span></li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#008000">// validation needed. don't call others</span></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">if</span> (!customFilter.FallThrough) <span style="color:#0000ff">break</span>;</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>which is the code run when a comment is posted.&nbsp; Now this snippet is from the Akismet filter (which implements ICustomFilter obviously):</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:ef2b62b5-84f4-4b9d-9c71-6454afa9a8e2" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">bool</span> FallThrough { <span style="color:#0000ff">get</span> { <span style="color:#0000ff">return</span> <span style="color:#0000ff">true</span>; } }</li>
</ol></div>
</div>
</div>
<p>I'll forgive anyone who doesn't see this right away, the code isn't entirely clear about what is happening, but it doesn't take too long to see the problem, here it is step by step:</p>
<ol>
<li>Spam is posted by some asshole</li>
<li>Akismet checks, finds spam and sets IsApproved = false;</li>
<li>If FallThrough = true StopForumSpam takes it's turn, since FallThrough is always true this happens always</li>
<li>StopForumSpam checks, since it isn't all that reliable it doesn't find spam and resets IsApproved = true</li>
<li>Spam is approved</li>
<li>Blog owner /facepalm's</li>
</ol>
<p>So the solution was relatively simple, just make sure the Akismet filter properly sets a FallThrough value to "false" when it find spam.&nbsp; Personally I think this is a design flaw though, the spam filter should <strong>always</strong> stop once <strong>any</strong> of the spam checkers believes it has found spam.&nbsp; It is less work to re-approve false positives than it is to clean-up false negatives given that over 80% of all blog comments are spam (figure taken from the Akismet website).</p>
<p>I've posted the issue and the patch on the <a href="http://blogengine.codeplex.com/WorkItem/View.aspx?WorkItemId=10811">BE.NET codeproject</a> site so I'm sure it will work it's way into the trunk soon.</p>
<p>Anyways, that's it till I get back from Cuba!</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[Spam: The battle is won, but the war is never over]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
    </post>
    <post id="5f7ab6ac-e29b-496d-b409-c830e91dc6f3" date-created="2009-12-01T19:55:00" date-modified="2009-12-06T11:37:51" approved="true" post-url="/post/2009/12/01/How-I-learned-to-stop-using-LINQ2SQL-and-love-nHibernate.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[How I learned to stop using LINQ2SQL and love nHibernate]]></title>
      <content type="text"><![CDATA[<p><img style="float: right;" src="/image.axd?picture=2009%2f12%2fNHLogoSmall.gif" alt="" width="245" height="55" /></p>
<p>Ok I will admit up front that it is entirely possible I have no idea how to use LINQ2SQL correctly, and I will further caveat this post by noting that I&rsquo;m not saying you should never, ever use L2S, what I am saying is <em>if</em> you choose to use L2S in any serious production environment that decision will almost certainly come back and haunt you&hellip; in the middle of your dreams&hellip; physically (and not in a totally awesome, <em>Ray Stanz in ghostbusters,</em> kind of physically).&nbsp; I don&rsquo;t use L2S often, I use nHibernate, and the times I have used it have been when I need a simple and quick query on tables in a legacy database and I want <em>objects</em>.&nbsp; Always query-only mind you, no CRUD of course (for the love of God, never use L2S for CRUD).&nbsp; I will even admit I have a habit of *shudder* just dragging the tables into the designer *lightning cracks outside my window*.</p>
<p>[more]</p>
<p>One of the reasons I use L2S at all is that I am pretty much a LINQ junkie and<em> </em>I love writing LINQ queries, I think they are awesome, maybe not quite generics awesome but pretty damn awesome all the same.&nbsp; I will take any opportunity to query the database in a strongly typed manner because it pretty much &ldquo;whoop&rsquo;s Batman&rsquo;s ass,&rdquo; and this is also the reason why I use LINQ2nHibernate even though it isn&rsquo;t 100% functional.&nbsp; L2nH is more than functional enough for any queries you should need to write and it&rsquo;s LINQ, so basically it wins.</p>
<p>Anyways, today I found out why I only ever use LINQ2SQL to do small tasks in largely throw-away pieces of test code (assuming I bother to use it even for that again).</p>
<p>What I was trying to do, was a simple bulk load of data from an old database into a new web app.&nbsp; We wanted to get some sample data from this database which will eventually be the source for the data this web app shows, but for now we just want to load it.&nbsp; The web app uses nHibernate, in fact, it uses S#arp Architecture which I&rsquo;ve previously mentioned is awesome, but I figured I would just use some throw away L2S mapping to get the data I needed and some LINQ to create the nHibernate entities from it.</p>
<p>This, for the most part worked fine, until I hit a table that had over 1.6 million records, which is a good chunk, but I&rsquo;m not sure I would even call that the high end of &ldquo;a lot&rdquo; in larger databases.&nbsp; No matter what I did or how I batched the loading of data from this table I could not get through all the records in this table without getting a DB timeout error.&nbsp;</p>
<p>I started trying by using a single L2S <em>DataContext</em> and calling something like:</p>
<pre class="csharpcode">db.Transactions.Skip(i * 100000).Take(100000).ToList();</pre>
<p>in a loop until I hit the end of the table.&nbsp; There was a little more to it than that but pretty much that.&nbsp; The memory usage continued climbing and I was trying to figure this out, then after about 700k transactions a <em>CommandTimeout</em> exception was thrown (sorry I don&rsquo;t have the exact exception anymore).&nbsp; I thought that perhaps keeping the same <em>DataContext</em> open for too long could be the problem (though I&rsquo;ve never had a problem with that before) so I started to create a new context in a using block each time, I figured this might also help with the memory problem&hellip; no luck.&nbsp; Amazingly exactly the same result, memory was not clearing and the things still timed out about the same point.</p>
<p>I figured just about anything could be causing it, I was using a local database on my dev machine that might have been to slow, I could have been using L2S incorrectly for this scenario too, in the end I de</p>
<p>cided using L2S in this scenario was bad (bulk loading of SQL should typically be done with ADO.NET but I hate it) so I got out the old <em>SqlDataReader</em>, called .Read() in a loop and voila! Perfection, and quite fast too, all while keeping the memory usage well below 150MB.&nbsp; Impressive, considering the fact that I was just building one giant transaction for for nHibernate during this whole time with all 1.6 million inserts waiting to happen <em>and</em> I was running this code in the R# 4.5 nUnit test runner.</p>
<p>Now I want to point out that I was very, very, wrong to use L2S for a bulk loading scenario, it is not it&rsquo;s intended function, in fact, it is also bad practice to use nHibernate in this type of scenario, something that the nHibernate contributers have stressed every time someone comes in with benchmarks comparing nHibernate&rsquo;s bulk loading capability to &lsquo;X&rsquo;.&nbsp; However, what I want to point out is that nHibernate (using <em>StatelessSession</em>) was able to perform <em>1.6million inserts in 2.3 minutes </em>without batting an eye, but L2S couldn&rsquo;t even handle <em>reading</em> through 1.6 million records, I would shudder to think what would happen if I tried to do inserts.</p>
<p>Well that&rsquo;s it for now, I just wanted to rant a bit after struggling with L2S.&nbsp; While I may still use it for easy simple things, I have learned why I should never use it in any serious development scenario.&nbsp; It is a <strong>bad time</strong> waiting to happen.&nbsp; Also nHibernate StatelessSession is awesome and fast and you should use it&hellip; that is all.</p>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>]]></content>
      <post-name type="text"><![CDATA[How I learned to stop using LINQ2SQL and love nHibernate]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
        <tag ref="linq" />
        <tag ref="linq2sql" />
        <tag ref="ado.net" />
      </tags>
      <comments>
        <comment id="0f95b67a-649f-42b4-b0c3-03f348071663" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-12T11:42:39" date-modified="2010-03-12T11:42:39" approved="true" user-name="Flavio" user-email="flaviotsf@hotmail.com" user-ip="208.73.108.10" user-url="">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[Did you try setting the CommandTimeout property of your DataContext to 0?
]]></content>
        </comment>
        <comment id="ccc1289e-94c2-4dcf-84ae-80e7ad756110" parentid="0f95b67a-649f-42b4-b0c3-03f348071663" date-created="2010-03-19T16:09:40" date-modified="2010-03-19T16:09:40" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.139.204.161" user-url="http://lucisferre.net/">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[I can't recall if I did that or not now.  That could have been part of the issue.  Again this scenario is somewhat atypical so I certainly would not generally recommend what I did here.]]></content>
        </comment>
        <comment id="fd6d9529-6b82-41e3-8ef6-687cffc11bc1" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-05-01T13:08:32" date-modified="2010-05-01T13:08:32" approved="true" user-name="Chris M" user-email="pcdevils@gmail.com" user-ip="94.192.187.203" user-url="">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[There's a fair few admissions of fault there, quickly followed up by a stab at Linq2SQL. It's pretty difficult to work out if there's actually any real content to that article as it reads; I did x using z which was wrong as it wasn't what it was built to do, and surprise it didn't work which was probably my fault for not doing it right, but you should use y rather than x because it managed to perform the same action which again wasn't its intended purpose. Empty Opinion Alert.

Your blog's got some useful articles but sometimes with articles like this... it would of been better to have posted a tutorial on the usage of and benefits of nhibernate :o)

Ta]]></content>
        </comment>
        <comment id="6fdc6309-8fb0-4982-ac88-2743bdc95bd4" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-05-03T09:27:16" date-modified="2010-05-03T09:27:16" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.17.159.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[I think perhaps the concept of a blog is lost on you Chris.  This post was clearly not intended as a tutorial but a review of some work I did as well as some thoughts on the pitfalls of attempting to do ETL using any ORM (though to be fair nHibernate did do the job fine).  I apologize if you feel you didn't get your monies worth... oh wait ;P.

I do also have a few other posts that are basic tutorials on a couple of aspects of nHibernate, I've also cross posted them to nhForge.  While I don't have an introductory tutorial written yet, that is partly because nhForge and other blogs out there already have a few.

Thanks for your comments though, I do realize it can be frustrating to google for some guidance on a subject and not find quite what you were looking for.  I will make an effort to keep my posts more educational :)]]></content>
        </comment>
        <comment id="b5fd35cd-8fcc-431e-b220-be299f278a2b" parentid="6fdc6309-8fb0-4982-ac88-2743bdc95bd4" date-created="2010-05-03T11:53:40" date-modified="2010-05-03T11:53:40" approved="true" user-name="Chris M" user-email="pcdevils@gmail.com" user-ip="94.192.187.203" user-url="">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[I was trying to point out that the blog title post reads like you had sound reason to avoid Linq2SQL, but the content just floats over you trying to do something Linq2SQL wasn't intended for (ala mass import).

Linq2SQL is still a handy bit of technology and the performance cant be that bad (its still used by Stackoverflow). 

Pretty sure I didn't mention beginner or introduction post, there's plenty of those around; I was just poking around the web for decent reasons not to use Linq2SQL and this popped up. 

Deep breaths :)]]></content>
        </comment>
        <comment id="b351d437-988e-462b-a487-6f2efb0a0e81" parentid="b5fd35cd-8fcc-431e-b220-be299f278a2b" date-created="2010-05-10T13:23:57" date-modified="2010-05-10T13:23:57" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.17.159.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[Titles are hard.]]></content>
        </comment>
        <comment id="69c2ee7c-ffea-4d3c-a179-780c78ea57ab" parentid="b351d437-988e-462b-a487-6f2efb0a0e81" date-created="2010-05-11T10:41:16" date-modified="2010-05-11T10:41:16" approved="true" user-name="Chris M" user-email="pcdevils@gmail.com" user-ip="94.192.187.203" user-url="">
          <title type="text"><![CDATA[re: How I learned to stop using LINQ2SQL and love nHibernate]]></title>
          <content type="text"><![CDATA[Hell ye]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="43d6a426-b84e-4fcc-b3df-af9cc977caa1" date-created="2009-11-29T23:28:00" date-modified="2010-02-23T19:28:33" approved="true" post-url="/post/2009/11/29/SimplyRestfulRouting-wasne28099t-so-simple-for-me.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[SimplyRestfulRouting wasn't so simple for me]]></title>
      <content type="text"><![CDATA[<p><img style="float: left; margin: 4px;" src="/image.axd?picture=2009%2f12%2fcomplicated2.jpg" alt="" /></p>
<p>Ok, the title is a bit misleading, the SimplyRestfulRouting available from the MVCContrib package is indeed, very simple to use.&nbsp; Adam Tybor created it and you can read most of what you need to know about it <a href="http://abombss.com/blog/2007/12/10/ms-mvc-simply-restful-routing/">on his blog</a>, I highly recommend you start there and not here if you plan on using this.&nbsp; Unfortunately, that post is a bit old and it also doesn't really specify or document exactly hot to use the class.&nbsp;&nbsp; The sample I managed to find on code project also seems to be quite out of date and I could not get it running for whatever reason, I'll take stab and chalk it up to my own impatience.</p>
<p>Anyways, while working on Graphite (my lame attempt at creating a blog engine) I read about SimplyRestfulRouting and decided I wanted to use RESTful style URLs too (trust me all the cool kids are doing it).&nbsp; The basic concept is that instead of using the standard ASP MVC convention of <em>{controller}/{action}/{resource identifier}, </em>we use <em>{controller}/{resource identifier} /{action}.&nbsp; </em>The idea being that first we get the resource and we support a standard set of actions that one can perform on it, like <em>show, edit, new, delete, etc.&nbsp; </em>As I understand it a lot of this has its roots in Rails style conventions.</p>
<p>[more]</p>
<p>Lets try some examples, take the following two urls:</p>
<p><a href="http://www.myblog.com/post/this-is-my-blog-post-slug-text">http://www.myblog.com/post/this-is-my-blog-post-slug-text</a></p>
<p><a href="http://www.myblog.com/post/show/this-is-my-blog-post-slug-text">http://www.myblog.com/post/show/this-is-my-blog-post-slug-text</a></p>
<p>Sure, it is completely clear that with the second link we want to show that blog post, however it isn't what you typically see on the web is it?&nbsp; In the first example, show is assumed to be the default action for that resource.&nbsp; If we wanted to edit it, we would see this:</p>
<p><a href="http://www.myblog.com/post/this-is-my-blog-post-slug-text/edit">http://www.myblog.com/post/this-is-my-blog-post-slug-text/edit</a></p>
<p>Likewise if we wanted to create a new post we would see this:</p>
<p><a href="http://www.myblog.com/post/new">http://www.myblog.com/post/new</a></p>
<p>Which doesn't refer to a resource and would, in fact, be the same thing we would do with the standard conventions.</p>
<p>SimplyRestfulRouting defines a set of 8 actions that you can perform on a resource.&nbsp; They are (this list is stolen from Adam's blog): <em></em></p>
<ul>
<li>Show : handles a GET request for a displaying a single resource that the controller is representing. </li>
<li>Create : handles a POST request for a creating a new resource. </li>
<li>Update : handles a PUT request for updating an existing resource. </li>
<li>Destroy : handles a DELETE request on a resource. </li>
<li>Index : handles a GET request for a collection of resources. </li>
<li>New : handles a GET request for a blank form for creating a new resource </li>
<li>Edit : handles a GET request for a form with values filled in from the resource for updating. </li>
<li>Delete : handles a GET request a confirmation / form with options for deleting a resource. * This is the extra action. </li>
</ul>
<p>They also correctly use all the fancy form methods like DELETE and PUT and for browsers that don't support DELETE and PUT SimplyRestfulRouting allows you to use a field called<em> _method</em> on forms to provide backwards compatibility in this scenario.&nbsp;</p>
<p>The not-so-simple part for me was that I could not get the routing to work whatsoever.&nbsp; The routes looked fine, but only Index and New worked, anything involving an id was failing.&nbsp; This of course should have been the big red flag directing me to where the problem was but instead it took me the better part of a day to discover what was happening.&nbsp;</p>
<p>The crux of the problem actually stemmed from the SimplyRestfulRouting.BuildRoutes() function I was using.&nbsp; If you do not use the last overloaded method which has the full set of parameters it takes it will default to filtering out all resource id's by assuming they must be integers and I unfortunately chose to use Guids.</p>
<p>When I finally saw the code I /facepalm'd like you wouldn't believe.</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:b37b1408-145e-47b2-8b0f-dad9397ce0d2" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> BuildRoutes(<span style="color:#2b91af">RouteCollection</span> routeCollection, <span style="color:#0000ff">string</span> areaPrefix)</li>
<li style="background: #f3f3f3">{</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;BuildRoutes(routeCollection, FixPath(areaPrefix) + <span style="color:#a31515">"/{controller}"</span>, MatchPositiveInteger, <span style="color:#0000ff">null</span>);</li>
<li style="background: #f3f3f3">}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>I have to vent a bit here, this really should use MatchAll by default.&nbsp; I really don't like the idea of having a default filter anywhere, if I don't write a <em>where</em> clause in a SQL statement I don't expect SQL to choose some default for me.&nbsp; Nonetheless. with that issue out of the way I was able to easily register my RESTful routes for my two MVC areas:</p>
<p>&nbsp;</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:64f27091-9a67-43e6-986f-b875c4393fe7" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; max-height: 300px; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">RouteRegistrar</span> {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">static</span> <span style="color:#0000ff">void</span> RegisterRoutesTo(<span style="color:#2b91af">RouteCollection</span> routes) {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;routes.IgnoreRoute(<span style="color:#a31515">"{resource}.axd/{*pathInfo}"</span>);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;routes.IgnoreRoute(<span style="color:#a31515">"{*favicon}"</span>, <span style="color:#0000ff">new</span> {favicon = <span style="color:#a31515">@"(.*/)?favicon.ico(/.*)?"}</span>);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;routes.CreateArea(<span style="color:#a31515">"Admin"</span>, <span style="color:#a31515">"Graphite.Web.Controllers.Admin"</span>,GetRestfulRoutes(<span style="color:#a31515">"Admin/"</span>));</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;routes.CreateArea(<span style="color:#a31515">"Root"</span>, <span style="color:#a31515">"Graphite.Web.Controllers"</span>,GetRestfulRoutes(<span style="color:#a31515">""</span>));</li>
<li>&nbsp;&nbsp;}</li>
<li style="background: #f3f3f3">&nbsp;</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#2b91af">Route</span>[] GetRestfulRoutes(<span style="color:#0000ff">string</span> areaPrefix) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">var</span> routes = <span style="color:#0000ff">new</span> <span style="color:#2b91af">RouteCollection</span>();</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#2b91af">SimplyRestfulRouteHandler</span>.BuildRoutes(routes, areaPrefix + <span style="color:#a31515">"{controller}"</span>, <span style="color:#0000ff">null</span>, <span style="color:#0000ff">null</span>);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;routes.Add(GetDefaultRoute(areaPrefix));</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> routes.Cast&lt;<span style="color:#2b91af">Route</span>&gt;().ToArray();</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;}</li>
<li>&nbsp;</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">private</span> <span style="color:#0000ff">static</span> <span style="color:#2b91af">Route</span> GetDefaultRoute(<span style="color:#0000ff">string</span> areaPrefix) {</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">return</span> <span style="color:#0000ff">new</span> <span style="color:#2b91af">Route</span>(areaPrefix + <span style="color:#a31515">"{controller}/{action}"</span>,</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#0000ff">new</span> <span style="color:#2b91af">RouteValueDictionary</span>(<span style="color:#0000ff">new</span> {controller = <span style="color:#a31515">"Home"</span>, action = <span style="color:#a31515">"Index"}</span>), <span style="color:#0000ff">new</span> <span style="color:#2b91af">MvcRouteHandler</span>());</li>
<li>&nbsp;&nbsp;}</li>
<li style="background: #f3f3f3">}</li>
</ol></div>
</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>The <em>GetDefaultRoute()</em> method is there to enable selecting a default home controller.&nbsp;</p>
<p>Well, pretty simple isn't it? And it only took me all day.</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[SimplyRestfulRouting wasn't so simple for me]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="Graphite" />
        <tag ref="ASP.NET MVC" />
        <tag ref="Sharp Architecture" />
      </tags>
    </post>
    <post id="1734653d-6df8-4aa8-8aef-c264406ced37" date-created="2009-11-24T08:37:00" date-modified="2010-03-22T08:34:33" approved="true" post-url="/post/2009/11/24/Fluent-nHibernate-cane28099t-quite-see-the-forest-for-the-trees.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Fluent nHibernate can't quite see the forest for the trees]]></title>
      <content type="text"><![CDATA[<p><img style="float: right; margin: 6px;" src="/image.axd?picture=2009%2f12%2fforestandtree.jpg" alt="" width="237" height="158" /></p>
<p>One of the first issues I&rsquo;ve run into building my blog engine, which I&rsquo;m calling Graphite for now, was an issue mapping nested comments using fluent NH.&nbsp; By default S#arp Architecture uses the fluent auto persistence model to auto map your entities to the database.&nbsp; This has many advantages, the primary one being that you don&rsquo;t need to write any mapping code or XML.&nbsp;</p>
<p>For those unfamiliar with either fluentNH or the auto persistence model you can read more on the <a href="http://wiki.fluentnhibernate.org/Auto_mapping">wiki</a>.&nbsp; It is extremely well documented.&nbsp; One of the few problems with the auto mapping though, is the fact that it cannot map self-referencing parent-child relationships, such as you would find it a typical tree or hierarchical structure.&nbsp; This would include the nested comments I want for my blog.&nbsp; The error you get is something like this:</p>
<p><em>NHibernate.MappingException: Repeated column in mapping for collection: Graphite.Core.Comment.Children column: CommentFk</em></p>
<p>The mapping for such a structure is very simple, and I figured it could be done easily using <a href="http://wiki.fluentnhibernate.org/Auto_mapping#Conventions">conventions</a> (a way of telling the auto persistence model how to map things) but alas I have so far been unsuccessful.&nbsp; Fortunately, fluentNH has <a href="http://wiki.fluentnhibernate.org/Auto_mapping#Altering_entities">overrides</a> which allow you to write a little bit of code to handle simple overrides.&nbsp; Here is my override for my nested comments:[more]</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:6e6f40ca-cbd6-4fc7-b9fe-e1bf53b5bf9e" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">CommentMap</span> : <span style="color:#2b91af">IAutoMappingOverride</span>&lt;<span style="color:#2b91af">Comment</span>&gt;</li>
<li style="background: #f3f3f3">{</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">void</span> Override(<span style="color:#2b91af">AutoMapping</span>&lt;<span style="color:#2b91af">Comment</span>&gt; mapping) {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;&nbsp;&nbsp;mapping.References&lt;<span style="color:#2b91af">Comment</span>&gt;(x =&gt; x.Parent).Column(<span style="color:#a31515">"ParentFk"</span>);</li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;mapping.HasMany&lt;<span style="color:#2b91af">Comment</span>&gt;(x =&gt; x.Children).Inverse().KeyColumn(<span style="color:#a31515">"ParentFk"</span>);</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;}</li>
<li>}</li>
</ol></div>
</div>
</div>
<p>My comments entity looks like this:</p>
<div id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:a18ec86e-68a2-45c2-9513-02bb8b6f72ce" class="wlWriterEditableSmartContent" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
<div style="border: #000080 1px solid; color: #000; font-family: 'Courier New', Courier, Monospace; font-size: 10pt">
<div style="background: #fff; overflow: auto"><ol style="background: #ffffff; margin: 0; padding: 0 0 0 5px;">
<li><span style="color:#0000ff">public</span> <span style="color:#0000ff">class</span> <span style="color:#2b91af">Comment</span> : <span style="color:#2b91af">EntityWithTypedId</span>&lt;<span style="color:#2b91af">Guid</span>&gt; {</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">string</span> Author { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">string</span> EmailAddress { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">string</span> WebAddress { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#0000ff">string</span> Content { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">DateTime</span> DatePosted { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">Post</span> Post { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li style="background: #f3f3f3">&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">Comment</span> Parent { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li>&nbsp;&nbsp;<span style="color:#0000ff">public</span> <span style="color:#0000ff">virtual</span> <span style="color:#2b91af">IList</span>&lt;<span style="color:#2b91af">Comment</span>&gt; Children { <span style="color:#0000ff">get</span>; <span style="color:#0000ff">set</span>; }</li>
<li style="background: #f3f3f3">}</li>
</ol></div>
</div>
</div>
<p>It would be nice if fluent NH understood this convention, i.e., if the property names are <em>Parent</em> and <em>Children </em>and they reference the entity class and a collection of that class respectively.&nbsp; I am hoping to either find a solution to this using conventions or a patch to fluent that can address this seemingly simple requirement.&nbsp; I do know from googling this problem that the fluent NH guys are aware of this limitation and I believe they are working on it, but it would be nice if I could lend a hand.</p>
<p>UPDATE: Turns out this is actually a problem with the way fluent understand this type of entity, it sees the collection on the child of the same type as the parent and assumes you are performing a many-to-many mapping.&nbsp; Since this was many-to-one the override is necessary, but I have posted a question to the fluentNH google group to see if anyone has another way.</p>]]></content>
      <post-name type="text"><![CDATA[Fluent nHibernate can't quite see the forest for the trees]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
        <tag ref="FluentNH" />
        <tag ref="Graphite" />
      </tags>
      <comments>
        <comment id="a81407cb-112b-444b-a0f5-3794deb0da11" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-09T16:19:44" date-modified="2010-01-09T16:19:44" approved="true" user-name="Ingo" user-email="ingo_77@hotmail.com" user-ip="213.100.153.180" user-url="">
          <title type="text"><![CDATA[re: Fluent nHibernate can't quite see the forest for the trees]]></title>
          <content type="text"><![CDATA[Thanks a million! This was exactly what I needed. You are my hero!

/Ingo]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="1b47b038-bff9-4385-a2b8-a69b59ddba4e" date-created="2009-11-22T13:55:00" date-modified="2010-07-04T17:03:45" approved="true" post-url="/post/2009/11/22/ASPNET-MVC-Blog-Engine-Part-1-of-X.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[ASP.NET MVC Blog Engine: Part 1 of X]]></title>
      <content type="text"><![CDATA[<p><img style="margin: 6px; float: left;" src="/image.axd?picture=2009%2f12%2fMVC8x6_209DEC49.png" alt="" width="262" height="251" /></p>
<p>This will hopefully be my first post of many on ASP.NET MVC using <a href="http://www.sharparchitecture.net/">S#arp Architecture</a> (which I am going to abbreviate #A from this point on) and the <a href="http://sparkviewengine.com">Spark</a> view engine.&nbsp; I really wanted to start getting into MVC and #A provides a very quick and easy to use framework to build your site.&nbsp; It also combines tools I would choose to use anyways like nHibernate and Windsor IoC.&nbsp; If you have yet to look into #A and you are planning on doing any .NET MVC work in the future I would recommend giving it at least a first look.</p>
<p>For my part, I've decided to pick the most cliche programming task there is, I am building a blogging engine.&nbsp; Now, I'm not necessarily planning on doing this so I don't have to use BlogEngine.NET, in fact I like BE.NET for the most part.&nbsp; I chose a blog engine for learning MVC for the same reason everyone likes using blog engines in examples, they have a very simple and well understood domain model and clearly defined functionality.&nbsp; This leaves me free to focus on learning the archnitecture instead of on designing the software.</p>
<p>If anyone is interested in following along interactively, I have <a href="http://github.com/lucisferre/Graphite">put my code up on GitHub</a>, so you can check it out, fork it, and generally do whatever you want.&nbsp; So far I've managed the following:</p>
<ul>
<li>Setup the S#arp Architecture project</li>
<li>Changed the view engine to Spark</li>
<li>Created the first domain entity: <strong>Post</strong></li>
<li>Created the basic views to: <br /> 
<ul>
<li>List posts</li>
<li>Create/Edit posts 
<ul>
</ul>
</li>
</ul>
</li>
<li>Created two #A "areas" one root and one for admin (creating/editing posts)</li>
<li>Organized my views using the "three-pass" logic of Spark</li>
<li>Added a jquery calendar component for editing dates</li>
<li>Added CKEditor for editing the HTML content of posts</li>
</ul>
<p>Once you have checked out the code you simply need to create a local SQLExpress database called "Graphite", nHibernate will do the rest when you run the web project.</p>]]></content>
      <post-name type="text"><![CDATA[ASP.NET MVC Blog Engine: Part 1 of X]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5c2b051b-f6df-4b41-baa8-63eb610e5201" />
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
        <tag ref="ASP.NET MVC" />
        <tag ref="Spark" />
        <tag ref="Sharp Architecture" />
        <tag ref="Graphite" />
      </tags>
    </post>
    <post id="15bbd7a4-cba3-4d9a-9e3d-92853f302d11" date-created="2009-11-18T08:42:00" date-modified="2010-03-10T08:39:20" approved="true" post-url="/post/2009/11/18/Automating-Deployment-with-TeamCity-and-psake.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Automating Deployment with TeamCity and psake]]></title>
      <content type="text"><![CDATA[<p><img style="float: right; margin: 6px;" src="/image.axd?picture=2009%2f12%2fspace_sake.jpg" alt="" width="199" height="237" /></p>
<p>Recently, my projects have gotten to the point where simply building, testing and publishing in Visual Studio will no longer cut it.&nbsp; There are many reasons to use an independent build server, the main one being the advantages of continuous integration.&nbsp; However, out of the box a build server like TeamCity does little more than checkout, build and test your application and report and track the results.&nbsp; What we really want is to integrate that into a deployment process.</p>
<p>This is where build automation tools can be handy.&nbsp; There are many, many options here: <a href="http://nant.sourceforge.net/" target="_blank">nant</a> is a popular one for XML lovers, so is <a href="http://rake.rubyforge.org/" target="_blank">rake</a><strong>,</strong> a ruby based option.&nbsp; <a href="http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx" target="_blank">MSBuild</a> can also be used, which is essentially what VS is using behind the scenes.&nbsp; However both rake and custom msbuild files require to much angle bracket evilness.&nbsp; Rake seems like it could be decent but I'm not working with ruby and I don't want to force everyone I work with to setup ruby either.&nbsp; Fortunately, James Kovacs has created a powershell based build tool which finally offers a good non-XML option to those working in an MS world.</p>
<p>[more]</p>
<p>You can get psake <a href="http://code.google.com/p/psake/">here</a> and the download includes some usage examples, though they don't really show you how to use it to build visual studio projects.&nbsp; Ayende has a relatively sophisticated example for his own projects <a href="http://ayende.com/Blog/archive/2009/08/30/on-psake.aspx">here</a> as well.&nbsp;</p>
<p>I am going to split this into a couple of parts.&nbsp; In the this part I just want to introduce psake and show to to create simple build tasks for compiling, testing and packaging.&nbsp; In the next 1-2 parts I am going to I want to walk through how to use psake with TeamCity to automate deployment for both ASP.NET and .NET projects.&nbsp;</p>
<p>I will start by mentioning that I am using psake 2.01 and powershell 2.0.&nbsp; If you are using XP you will need to install SP3 in order to use powershell 2.0, you can get PS2.0 from <a href="http://support.microsoft.com/kb/968929" target="_blank">here</a>.</p>
<h2>Part 1: Using psake to perform standard build tasks</h2>
<p>Psake defines functions called "tasks" to help order the build process.&nbsp; I should note there are a number of interesting things you can do with tasks that are new to psake 2.01.&nbsp; For example, you can specify pre and post conditions and pre and post actions for a task for example.&nbsp;</p>
<p>For the moment we will keep it simple and just use the -depends switch.&nbsp; In this scenario a task is simply something you can command your build script to execute and each task can depend on other tasks to be completed before it in a hierarchical manner.&nbsp; For example, <strong>compile</strong> may depend on <strong>clean</strong> and <strong>test</strong> may depend on <strong>compile</strong>.</p>
<p>Here is a basic psake script for building a simple ASP.NET web application:</p>
<div id="codeSnippetWrapper" style="border: 1px solid silver; margin: 20px 0px 10px; padding: 4px; overflow: auto; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 97.5%; font-family: 'Courier New',courier,monospace; direction: ltr; max-height: 200px; font-size: 8pt; cursor: text;">
<div id="codeSnippet" style="border-style: none; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">properties { </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $solution_name =        <span style="color: #006080">"MyWebsite"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $website_folder =&nbsp;&nbsp; <span style="color: #006080">"MyWebsite"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $base_directory  =      resolve-path .</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $tools_directory =      <span style="color: #006080">"$base_directory\tools"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $build_directory =      <span style="color: #006080">"$base_directory\build"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $publish_directory =    <span style="color: #006080">"\\MyWebServer\website"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $publish_user =         <span style="color: #006080">"deployment"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $publish_pass =         <span style="color: #006080">"password"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $local_test_runner =    <span style="color: #006080">"C:\Program Files\NUnit 2.5.1\bin\net-2.0\nunit-console.exe"</span>    </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    $unittest_project =     <span style="color: #006080">"$build_directory\UnitTests.dll"</span></pre>
<!--CRLF--><!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">} </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task <span style="color: #0000ff">default</span> -depends Test, Package</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task Init -depends Clean { </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    <span style="color: #0000ff">new</span>-item $build_directory -itemType directory | Out-Null</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task Clean { </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    remove-item -force -recurse $build_directory -ErrorAction SilentlyContinue | Out-Null</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task Package  {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    <span style="color: #0000ff">try</span> {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        &amp;$tools_directory\7z.exe a -tzip <span style="color: #006080">"$build_directory/$solution_name.zip"</span> <span style="color: #006080">"$build_directory/_PublishedWebsites/*"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    } <span style="color: #0000ff">catch</span> {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        &amp;echo <span style="color: #006080">"Error packaging artifacts"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        <span style="color: #0000ff">Exit</span> 1;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task Compile -depends Init { </pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    <span style="color: #0000ff">try</span> {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        &amp;msbuild /verbosity:minimal /p:<span style="color: #006080">"Configuration=Release;Platform=Any CPU;OutDir=$build_directory\\"</span> $solution_file</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    } <span style="color: #0000ff">catch</span> {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        &amp;echo <span style="color: #006080">"Error compiling"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        <span style="color: #0000ff">Exit</span> 1;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">task Test -depends Compile {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    <span style="color: #0000ff">try</span> { &amp;$local_test_runner $unittest_project }</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    <span style="color: #0000ff">catch</span> {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        &amp;echo <span style="color: #006080">"Error starting test runner"</span></pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">        <span style="color: #0000ff">Exit</span> 1;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    }</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF--></div>
</div>
<p>The psake script is composed of two main sections.&nbsp; The first is properties, where you set some global variables to be used throughout your script.&nbsp; These can be used to make it easy to adapt your script to different projects, tools, etc.&nbsp; The second are the tasks.&nbsp; In this example I've created Init: creates a build folder, Clean: removes anything from a previous build, Compile: uses msbuild to build from the solution file, Test: runs the nunit test runner against my test project output and finally package, which uses 7zip to compress my build output.</p>
<p>To run this build script I will need to do the following in powershell, or in another powershell script:</p>
<pre class="csharpcode">Import-Module <span class="str">'.\psake.psm1'</span>
Invoke-psake <span class="str">'.\psakebuild.ps1'</span> -framework 3.5
Remove-Module psake<!--
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }
--></pre>
<p>If that seems a bit verbose, keep in mind you can place the psake.psm1 module in one of the powershell modul module <a href="http://tfl09.blogspot.com/2009/01/modules-in-powershell-v2.html">folders</a> which will make sure powershell always imports it.&nbsp; For me, I just add that to a script called runbuild.ps1 and I'm good.</p>
<p>In the Invoke-psake command we pass the script above.&nbsp; By specifying -framework 3.5 psake adds <em>Windows/MICROSOFT.NET/Framework/v3.5/</em> to the path.&nbsp; You can specify any framework version you need 2.0, 3.0, etc., it is an optional parameter.&nbsp; You can also specify a task to execute, if not it will execute the <strong>default</strong> task.&nbsp; The general syntax looks like this:<!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">Invoke-psake &lt;psake script file&gt; &lt;Task Name&gt; -framework &lt;version&gt;</pre>
</div>
<p>You may have noticed the try.catch blocks as well.&nbsp; These are not necessary, but they provide a way for me to ensure errors are communicated to TeamCity.&nbsp; TeamCity responds to non-zero exit codes by reporting a failed build which is what I want to see.</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[Automating Deployment with TeamCity and psake]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="psake" />
        <tag ref="teamcity" />
        <tag ref="powershell" />
      </tags>
      <comments>
        <comment id="2b1a3611-8825-44d9-b07d-0d9859227056" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-14T01:36:24" date-modified="2010-01-14T01:36:24" approved="true" user-name="Mikael Lundin" user-email="mikael.lundin@litemedia.se" user-ip="83.253.29.156" user-url="http://mint.litemedia.se/">
          <title type="text"><![CDATA[re: Automating Deployment with TeamCity and psake]]></title>
          <content type="text"><![CDATA[Thanks for this post. It helped me out quite a bit. I'm working on a .NET 4 project and found it really easy to just modify the psake module a little to support it. Very nice indeed.
Mikael]]></content>
        </comment>
        <comment id="7f03eed0-f293-48a8-acd4-2f0540948337" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-14T11:03:42" date-modified="2010-01-14T11:03:42" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Automating Deployment with TeamCity and psake]]></title>
          <content type="text"><![CDATA[ Thanks, I definitely need to get on the follow ups to this as there is lots more you can do with psake.]]></content>
        </comment>
        <comment id="3eb47550-92e2-4bf8-b4c2-8a9db9defe22" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-24T05:26:44" date-modified="2010-01-24T05:26:44" approved="true" user-name="Joshua" user-email="joshua@zduck.com" user-ip="69.7.176.150" user-url="http://www.zduck.com/">
          <title type="text"><![CDATA[re: Automating Deployment with TeamCity and psake]]></title>
          <content type="text"><![CDATA[Just adding my request for another post in this series :)

I'm especially interested in finding out how you retrieved the Build Number (and other parameters) that TeamCity passes the build script since I haven't figured out how to get those parameters into my Psake tasks yet.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="1bd6f203-2a34-48c2-85b1-34e3ba2861f4" date-created="2009-11-15T00:04:00" date-modified="2009-12-02T13:09:38" approved="true" post-url="/post/2009/11/15/What-have-I-been-up-to-lately.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[What have I been up to lately?]]></title>
      <content type="text"><![CDATA[<p>It has been quite a while since I have had much time to even think about writing a blog post and there are a series of reasons for that.&nbsp; Typically, I try not to avoid writing those "posting about why I haven't been posting" posts that seem all to common amongst lazy bloggers like myself, but in this case I feel reasons are sufficiently interestin to go into detail.</p>
<p>To begin with, my wife and I bought a house in September and moved in late October.&nbsp; While we did often go and look at houses we were not really planning on actually buying one, but a couple months ago we stumbled upon the perfect 102 year old character home, with a rental suite and a veranda porch on the front.&nbsp; My first student house in Kingston had one of these porches and I loved sitting on it, having a beer with my friend.&nbsp; We even managed to get it without any bidding war, something that is highly uncommon in Vancouver.</p>
<p>It's near pretty much everything, blocks from Commercial Drive, right near downtown, around the corner from a great Japanese grocery and sushi take-out place in the city.&nbsp; The place is "practically perfect in every way" well. almost.&nbsp; The kitchen is in a horrendous state, the drawers and cabinets look like a poorly trained monkey with one arm and one leg put them together.&nbsp; The sink pretty much bathes you in water if you try to do dishes in it, the electrical work around the cabinets is, well. questionable.&nbsp; On the upside it has new appliances which are really nice, including my personal favorite and Kitchen-Aid gas range which is awesome.</p>
<p>As it turns out, buying and now owning a home creates all sorts of chores and tasks that&nbsp; preoccupy a significant amount of free time, for example trying to find out what all the light switches which appear to have no purpose do.&nbsp; To make things even crazier during the last month than they already are, pretty much everyone I know, including myself, has their birthday either in October or early November so lots of celebrating, sometimes to save time we celebrate a couple birthday's at a time ;-).&nbsp; <em>Finally,</em> nearing the ned of all this chaos, was the <a href="http://agilevancouver.ca/">Agile Vancouver</a> (n.b.: if you live in Vancouver and you are a developer it would be worth your while to join this group) conference, which was where I was going with this whole post.</p>
<p>This conference was incredible.&nbsp; Eric Evans, Martin Fowler, Michael Feathers, Mary and Tom Poppendeick were just some of the speakers.&nbsp; I have recently been introduced to many of them through several books, articles and blog posts I've been reading while trying to educate myself on various topics related to agile, SOLID, DDD and TDD.&nbsp; Being able to attend a conference with them was an incredible experience and a bit of serendipitous timing for my education as a developer.&nbsp; Short story, it was great.</p>
<p>There was also a discount book sale at the conference, so I went a bit nuts.&nbsp; I picked up my own copy of <a href="http://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1258269328&amp;sr=1-1">DDD</a> by Eric Evans (until now I was borrowing Adam's copy), <a href="http://www.amazon.com/Lean-Software-Development-Agile-Toolkit/dp/0321150783/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1258269290&amp;sr=1-1">Lean Software Development</a>, <a href="http://www.amazon.com/Behind-Closed-Doors-Management-Programmers/dp/0976694026/ref=sr_1_1?ie=UTF8&amp;s=books&amp;qid=1258269265&amp;sr=1-1">Behind Closed Doors</a> and <a href="http://www.amazon.com/Business-Agility-Sustainable-Relentlessly-Competitive/dp/047041345X/ref=ntt_at_ep_dpi_4">Business Agility</a>.&nbsp; With some luck I'll actually find time to read them and maybe even get a post or two out of it.&nbsp; A man can dream can't he?</p>
<p>I do think I should be able to find some time now to put fingers to keys and write a bit about some of the things I took away from the conference.&nbsp; Hopefully. I'm not going to promise anything.</p>]]></content>
      <post-name type="text"><![CDATA[What have I been up to lately?]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <tags>
        <tag ref="agile" />
        <tag ref="alt.net" />
      </tags>
    </post>
    <post id="42f59116-0313-4a31-87f9-4efff12b5257" date-created="2009-11-13T19:16:00" date-modified="2010-03-22T23:07:24" approved="true" post-url="/post/2009/11/13/An-nHibernate-lazy-loading-gotcha.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[An nHibernate lazy loading gotcha]]></title>
      <content type="text"><![CDATA[<p>I'm sure something about this has almost definitely been written about before, in fact I vaguely recall reading about it, but I feel the same way about blog posts as Homer Simpson does about car horns "When you're angry you can never find one," so I figure one more can't hurt.&nbsp; Besides I haven't blogged about anything in weeks and I'm not prepared to write about anything more complicated than this at the moment.</p>
<p>If you've worked with nHibernate for a while you probably already know the common patter of having your entities inherit from an abstract base class that provides a standard "Id" property and any other properties common to your entities.&nbsp; In various examples across the web you will typically also find that Equals() has been overridden, you may have not given it a second thought, but I am here to tell you there is a very good reason for this and it is lazy loading.</p>
<p>One of the things you get "out-of-the-box" with nHibernate is lazy loading.&nbsp; This means if I have two entities like <strong>Blog</strong> that is related to <strong>Post</strong>, I can load a Blog without loading it's posts right away.&nbsp; Then when I access Blog.Posts say by calling Blog.Posts.Count(), nHibernate will load them for me at that time (that is assuming I have not already closed my session, in which case it will throw an exception, but that is another post).&nbsp; Conversely, if I have queried for a Post, I will get it's blog only if I access Post.Blog.</p>
<p>You can of course turn off lazy loading if this behavior isn't desired, but I highly recommend learning to love it, it will lead you to much better and smarter ORM design.&nbsp; Now on to the "gotcha". [more]</p>
<p>This lazy loading is not achieved by manipulating the force, but through the use of a dynamic proxy.&nbsp; Without getting into detail on dynamic proxies (since I'm sure I would start to show my ignorance on the subject pretty quickly) lets just say it provides a wrapper that dynamically inherits from your entity class while providing additional functionality at run-time, such as the ability to load itself from the database when a property is accessed.</p>
<p>One of the things that is preferable is to ensure that when two objects refer to the same entity in the database that calling Equals() will confirm this.&nbsp; ReSharper provides a convenient facility to generate some default Equality members that return true when specific properties are equals and if we use the "Id" property the result is this:</p>
<div id="codeSnippetWrapper">
<div id="codeSnippet" style="border-style: none; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> Equals(Entity other) {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">null</span>, other)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">this</span>, other)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">return</span> other.Id == Id;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">bool</span> Equals(<span style="color: #0000ff">object</span> obj) {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">null</span>, obj)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">this</span>, obj)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (obj.GetType() != <span style="color: #0000ff">typeof</span> (Entity)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">return</span> Equals((Entity) obj);</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">int</span> GetHashCode() {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">return</span> Id;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF--></div>
</div>
<p>You can even generate operators for == and != if needed, yet another reason why it is such a good idea to have ReSharper. The problem is this will fail if you ever compare an entity to a proxy returned by the nHibernate lazy loading. This right here is the reason:</p>
<div id="codeSnippetWrapper">
<pre id="codeSnippet" style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">if</span> (obj.GetType() != <span style="color: #0000ff">typeof</span> (Entity)) <span style="color: #0000ff">return</span> false</pre>
<br /></div>
<p class="csharpcode">This is easily fixed though, doing a simple safe cast before checking makes this code both more readable and deals with the equality issue when using lazy loading:</p>
<div id="codeSnippetWrapper">
<div id="codeSnippet" style="border-style: none; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> Equals(Entity other) {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">null</span>, other)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">if</span> (ReferenceEquals(<span style="color: #0000ff">this</span>, other)) <span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span>;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">return</span> other.Id == Id;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">&nbsp;</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">bool</span> Equals(<span style="color: #0000ff">object</span> obj) {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  <span style="color: #0000ff">return</span> Equals(obj <span style="color: #0000ff">as</span> Entity);</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF--></div>
</div>
<p>I think that is much better, I would almost consider recommending this be changed in ReSharper, perhaps there is still time before ReSharper 5.0 is finished.</p>
<p><!-- .csharpcode, .csharpcode pre { 	font-size: small; 	color: black; 	font-family: consolas, "Courier New", courier, monospace; 	background-color: #ffffff; 	/*white-space: pre;*/ } .csharpcode pre { margin: 0em; } .csharpcode .rem { color: #008000; } .csharpcode .kwrd { color: #0000ff; } .csharpcode .str { color: #006080; } .csharpcode .op { color: #0000c0; } .csharpcode .preproc { color: #cc6633; } .csharpcode .asp { background-color: #ffff00; } .csharpcode .html { color: #800000; } .csharpcode .attr { color: #ff0000; } .csharpcode .alt  { 	background-color: #f4f4f4; 	width: 100%; 	margin: 0em; } .csharpcode .lnum { color: #606060; } --></p>]]></content>
      <post-name type="text"><![CDATA[An nHibernate lazy loading gotcha]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
        <tag ref="ReSharper" />
      </tags>
      <comments>
        <comment id="dd40704f-b3f4-489e-9df0-8eb1d096f593" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-11-11T12:34:39" date-modified="2009-11-11T12:34:39" approved="true" user-name="Ilya Ryzhenkov" user-email="orangy@jetbrains.com" user-ip="195.5.138.42" user-url="">
          <title type="text"><![CDATA[re: An nHibernate lazy loading gotcha]]></title>
          <content type="text"><![CDATA[No, we won't make this change for ReSharper. Because, generally, generic Figure is not equals to Circle or Rectangle.]]></content>
        </comment>
        <comment id="d0038ba7-a70f-4b4c-98f3-1ac70a472ba5" parentid="dd40704f-b3f4-489e-9df0-8eb1d096f593" date-created="2009-11-11T23:45:13" date-modified="2009-11-11T23:45:13" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: An nHibernate lazy loading gotcha]]></title>
          <content type="text"><![CDATA[That is true, I can see how this would not be correct in every situation.  However, more often than not I suspect I will be overriding equals on objects that are not as generic as Figure.

For example, for a Square class which inherits from a Rectangle class we would probably override Equals on Rectangle like this:

public bool Equals(Rectangle other) {
  if (ReferenceEquals(null, other)) return false;
  if (ReferenceEquals(this, other)) return true;
  return (other.Length == Length &amp;&amp; other.Width == Width);
} 

public override bool Equals(object obj) {
  return Equals(obj as Entity);
}

Nonetheless, I can see how it might not be a prudent change.  Thanks Ilya.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="da70c461-2992-4f03-bc58-fd1fd5effcfb" date-created="2009-10-16T18:59:00" date-modified="2009-10-20T12:58:55" approved="true" post-url="/post/2009/10/16/Integration-Testing-with-a-Service-Bus.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Integration Testing with a Service Bus]]></title>
      <content type="text"><![CDATA[<p>Using a service bus and messaging architecture allows for all sorts of good things with service oriented architectures, but one use I found for them recently was integration testing by using mocking framework with my messaging architecture.&nbsp; I was able to do this by simply by getting a mock of the IConsumer&lt;T&gt; and subscribing it to the bus.&nbsp;</p>
<p>You can see an example of such a test here:</p>
<div id="codeSnippetWrapper" style="border: 1px solid silver; margin: 20px 0px 10px; padding: 4px; overflow: auto; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 97.5%; font-family: 'Courier New',courier,monospace; direction: ltr; max-height: 200px; font-size: 8pt; cursor: text;">
<div id="codeSnippet" style="border-style: none; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">[Test]</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanLoadCashTransactionsFromISMFileAndSaveToDatabase() {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var transactionCounter = MockRepository.GenerateMock&lt;IConsumer&lt;TransactionSuccessful&gt;&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  transactionCounter.Expect(m =&gt; m.Consume(Arg&lt;TransactionSuccessful&gt;.Is.Anything)).IgnoreArguments().Repeat.Times(6);</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var sink = IoC.Resolve&lt;ITransactionService&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var source = IoC.Resolve&lt;ITransactionDataReader&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  IoC.Resolve&lt;IMessageBroker&gt;()</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    .Subscribe(Subscription.For(sink).Sync())</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    .Subscribe(Subscription.For(transactionCounter).Sync());</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  source.ProcessDataFromStream(GetTransactionData());</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  transactionCounter.VerifyAllExpectations();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF--></div>
</div>
<p>I am using Rhino Mocks here along with the AAA syntax for this test.&nbsp;</p>
<p>I have a transaction source service sending TransactionMessage which are received by a transaction sink service which processes the transactions.&nbsp; The sink sends a TransactionSuccessful message if the transaction is processed correctly.&nbsp; A mock IConsumer&lt;TransactionSuccessful&gt; can be subscribed to the service bus to verify any expectations I have of the result messages.&nbsp; I can also create other mocks if I expect other results:</p>
<div id="codeSnippetWrapper" style="border: 1px solid silver; margin: 20px 0px 10px; padding: 4px; overflow: auto; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 97.5%; font-family: 'Courier New',courier,monospace; direction: ltr; max-height: 200px; font-size: 8pt; cursor: text;">
<div id="codeSnippet" style="border-style: none; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">[Test]</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> CanOnlyAddTransactionsOneTime() {</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var transactionCounter = MockRepository.GenerateMock&lt;IConsumer&lt;TransactionSuccessful&gt;&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  transactionCounter.Expect(m =&gt; m.Consume(Arg&lt;TransactionSuccessful&gt;.Is.Anything)).IgnoreArguments().Repeat.Times(6);</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var duplicateCounter = MockRepository.GenerateMock&lt;IConsumer&lt;TransactionExists&gt;&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  duplicateCounter.Expect(m =&gt; m.Consume(Arg&lt;TransactionExists&gt;.Is.Anything)).IgnoreArguments().Repeat.Times(6);</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var sink = IoC.Resolve&lt;TransactionService&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  var source = IoC.Resolve&lt;IISMTransactionService&gt;();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  IoC.Resolve&lt;IMessageBroker&gt;()</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    .Subscribe(Subscription.For(sink).Sync())</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    .Subscribe(Subscription.For(transactionCounter).Sync())</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">    .Subscribe(Subscription.For(duplicateCounter).Sync());</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  source.ProcessDataFromStream(GetTransactionData());</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  source.ProcessDataFromStream(GetTransactionData());</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  transactionCounter.VerifyAllExpectations();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: #f4f4f4; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">  duplicateCounter.VerifyAllExpectations();</pre>
<!--CRLF-->
<pre style="border-style: none; margin: 0em; padding: 0px; overflow: visible; text-align: left; line-height: 12pt; background-color: white; width: 100%; font-family: 'Courier New',courier,monospace; direction: ltr; color: black; font-size: 8pt;">}</pre>
<!--CRLF--></div>
</div>
<p>Here I am expecting that when duplicate transactions are received that a TransactionExists result message is sent along the bus and I can verify this using a second mock.</p>
<p>Monitoring the messages on the bus seems to be a very simple and clean way to verify expectations along the integration points between services.</p>
<p>Note: I should point out that currently Rhino Mocks does not check if something happens more than <strong>Times(int number) </strong>only that it isn't called fewer times.&nbsp; Perhaps something like <strong>.Exactly.Times(int number)</strong> will be added to Rhino in the future</p>]]></content>
      <post-name type="text"><![CDATA[Integration Testing with a Service Bus]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="832202cb-b074-4686-8c64-efb0d3a1aa9c" />
      </categories>
      <tags>
        <tag ref="TDD" />
        <tag ref="service bus" />
        <tag ref="SOA" />
      </tags>
    </post>
    <post id="6353408e-7f71-4b9e-b939-0a6d47ae8481" date-created="2009-10-15T09:55:36" date-modified="2009-10-15T09:55:36" approved="true" post-url="/post/2009/10/15/ab-e28098usinge28099-statements.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[ab-'using' statements]]></title>
      <content type="text"><![CDATA[<p>I was trying to squash a frustrating bug the other day that I just couldn't pin down despite the fact that it was right in front of my face the whole time.</p>  <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; height: 310px; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">   <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">     <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">private</span> ISession _session;</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">&#160;</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> Consume(TransactionMessage msg) {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">  <span style="color: #0000ff">using</span> (_session = _sessionFactory.OpenSession())</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">  <span style="color: #0000ff">using</span> (ITransaction tx = _session.BeginTransaction())</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">  {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    IMessage result = <span style="color: #0000ff">null</span>;</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">try</span> {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">      result = ProcessTransaction(msg, _session);</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">      tx.Commit();</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    } <span style="color: #0000ff">catch</span> (Exception ex) {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">      result = <span style="color: #0000ff">new</span> TransactionError(msg) {ErrorMessage = ex.Message};</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">      tx.Rollback();</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    } <span style="color: #0000ff">finally</span> {</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">      _bus.Consume(result);</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">    }</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: white; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">  }</pre>
<!--CRLF-->

    <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px">}</pre>
<!--CRLF--></div>
</div>

<p></p>

<p>I am sure csharp veterans will see this novice error right away, but in case you didn't, I have combined a using statement with a field.&#160; The problem here is that while I intended for the using statement to automatically dispose of my session variable it can't because the instance still holds a reference to it via the field.&#160; I don't know why it took me so long to see it, it is obvious once you know what the problem is.</p>

<p>Long story short, don't combine <font face="System">using</font> with fields or properties or anything that is going to hold a reference to what you intended the using statement to dispose of, it wasn't meant for that.</p>]]></content>
      <post-name type="text"><![CDATA[ab-'using' statements]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="coding" />
        <tag ref="bugs" />
      </tags>
    </post>
    <post id="83a26a2a-e88b-4e31-ab51-86e3745c5575" date-created="2009-10-06T08:22:00" date-modified="2010-02-23T19:28:23" approved="true" post-url="/post/2009/10/06/The-7-habits-of-highly-effective-agile-teams.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[The 7 habits of highly effective agile teams]]></title>
      <content type="text"><![CDATA[<p style="text-align: justify;">In my <a href="http://www.lucisferre.net/post.aspx?id=73b64741-80eb-4d58-bbce-931fb5698fd8">earlier post</a> about duct tape and technical debt I mentioned how managing technical debt affects the long term progress of software development.&nbsp; I want to elaborate a bit more on that using something a presentation given by <a href="http://pkruchten.wordpress.com/talks/">Phillipe Kruchten</a> for the local Agile community group.&nbsp; While I missed it,&nbsp; Adam went and started to use these ideas for our own backlog.&nbsp; I have found it a very useful way to think about the backlog and measuring productivity.</p>
<p style="text-align: justify;">One of the reasons for using a backlog is to to measure the progress of software projects, however, not all work in the backlog constitues real progress towards the project goals.&nbsp; Phillipe divdes the backlog into four categories: Features, Defects, Architecture and Technical Debt.&nbsp; I have illustrated this below:</p>
<p style="text-align: center;"><img src="/image.axd?picture=2009%2f10%2fColored_Backlog.png" alt="" width="440" height="340" /></p>
<p style="text-align: justify;">The four sections represent visibility towards the left and value towards the top.&nbsp; Implementing features and fixing defects are things that are visibile to the customer/user, while handling technical debit and building architecture and infrastructure are not.&nbsp; Features and architecture add value while defects and technical debt do not.&nbsp; This illustration reminded me of the time management quadrents from Stephen Covey's "7-habits" book.&nbsp; Whatever you may think of the cheezy management speak sprinkled throughout the 7-habits book, or of people who abusively use terms from it like "paradigm" and "win-win", the book still had some useful (if somewhat obvious) ways of understanding time management.&nbsp; The time management quadrants divided time usage into urgent vs. not-urgent and important vs. not-important.</p>
<p style="text-align: justify;"><img style="float: right; margin: 8px;" src="/image.axd?picture=2009%2f10%2fColoredVelocity.png" alt="" width="338" height="561" /></p>
<p style="text-align: justify;">I sort of see the colors approach to the backlog as a similar in concept.&nbsp; You are want to focus your time on work that adds value, while minimizing the time spent on work that doesn't.&nbsp; However, that doesn't mean you can ignore defects and technical debt, it just encourages working in a way that will minimize it.&nbsp; Features come first of course (or as Stephen Covey put it "first things first") and in an effort to deliver features early and often technical debt must be incurred.&nbsp;</p>
<p style="text-align: justify;">Adam broke down the causes of technical debt into two things: 1. a lack of knowledge which is typical early on in a project and 2. "Tactical shortcuts" knowingly incurring technical debt to meet deadline or if a "duct tape" solution will be sufficient for the situation.&nbsp; Over the life of the project however these types of decisions will begin lead to defects and a the defects will cut into productive work on the project.&nbsp; The idea is that time spent managing this technical debt can help to cut down on the defects later on.</p>
<p style="text-align: justify;">In the diagram on the right we see potential phases of an agile project.&nbsp; Early on there is no technical debt or defects but a lot of time must be spent building architecture and infrastructure to support feature development.&nbsp; Aftwards with less architecture to build early feature development takes off but we begin to see defects eating into time spent on features.&nbsp; Next we see the result of neglecting  technical debt and architecture as the defect rate increases.&nbsp; Finally, as technical debt is managed and time is spent building and improving architecture we can manage the defect rate, but this also cuts into feature development</p>
<p style="text-align: justify;">Obviously these are just crude examples, your actual mileage may vary.&nbsp; The point is to be aware of the long term negative effect not managing defects and technical debt has on productivity.&nbsp; Of course, it certainly seems obvious, but when you read posts like the <a href="http://www.joelonsoftware.com/items/2009/09/23.html">duct tape programmer</a>, it is clear there are still people who don't realize just how much  "tactical shortcuts" can cost you over the lifetime of a software project.</p>
<p style="text-align: justify;">I have made a small hack to Eric Davis' Kanban plugin for Redmine that allows us to have colored items in our backlog just like here.&nbsp; I am hoping to develop it out a bit more but for now you can look at my <a href="https://projects.littlestreamsoftware.com/issues/3118">feature request</a> for a patch that hardcodes the colors to the tracker names "bug", "feature", "architecture" and "technical debt".&nbsp; Here is a <a href="https://projects.littlestreamsoftware.com/attachments/590/redmine_kanban_colors.jpg">screenshot</a> of it in action.</p>]]></content>
      <post-name type="text"><![CDATA[The 7 habits of highly effective agile teams]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1091489b-35f0-473f-8e03-c2b8aa031f8c" />
      </categories>
      <tags>
        <tag ref="agile" />
        <tag ref="redmine" />
      </tags>
    </post>
    <post id="168607d5-7ca7-4ddc-9c10-298161d9ec6b" date-created="2009-10-05T07:54:00" date-modified="2010-03-16T10:54:41" approved="true" post-url="/post/2009/10/05/Bold-new-look!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[A Bold New Look!]]></title>
      <content type="text"><![CDATA[<p>I used some free time this weekend (actually almost all my free time) to create a custom theme for BlogEngine.NET.&nbsp;&nbsp; I wasn't entirely satisifed with the themes available, though some are nice, most are a bit bland, also they tend to be a bit out of date and don't support the new sidebar widgets.</p>
<p>My first attempt began with the Implied CSS template from from <a href="http://www.freecsstemplates.org">freecsstemplates.org</a> and began adapting it as a brand new blogengine.net theme.&nbsp; This was harder than I thought it would, editing CSS can be tricky, but I was successful in the end and managed to create <a href="/?theme=Implied">this masterpiece</a> (I am hoping that preview link works).&nbsp; It is pretty awesome, but it is also very dark.&nbsp; High-contrast templates like that can be a strain on the eyes and after a few hours working on it I was painfully aware of this fact.&nbsp; I decided to try another look even after spending hours making it.&nbsp; I will post the teme to the blogengine.net themes page and provide it back to the community so hopefully my work won't be a total waste.</p>
<p>I decided to try something simple instead.&nbsp; I used the default and very simple blogengine <a href="/?theme=Standard">standard theme</a> and began to make small adjustments and improvements.&nbsp; I added one of my own photos, and with a little editing in GIMP to made it into what I think is an awesome site banner.&nbsp; I next added a colored menu and sidebar header  background which I took from another  CSS template design.&nbsp; Finally I changed the fonts and colors until I was satisfied.&nbsp; I am very pleased with the results but I would love to get people's feedback on the two templates I did.</p>
<p>I also finally moved my site from GoDaddy to WebHost4Life.&nbsp; I found WebHost's control panel easier to deal with (though it still isn't amazing), they offer a better deal which includes a static IP address and much more responsive adding of IIS sites and databases (I once waited 4 hours just to add another database with GoDaddy...).&nbsp; Overall I cannot recommend GoDaddy for anything.&nbsp; I also am now using <a href="http://www.lucisferre.net">www.lucisferre.net</a> which I registered recently.&nbsp; I am thinking of dropping the .org domain as I am not really much of an 'org'.</p>
<p>Chris</p>
<p>Update: I noticed the Implied theme isn't looking right.&nbsp; It doesn't fit the longer tagline I have and shifts the menu down.&nbsp; It is something I will fix before I upload the theme to the site.</p>]]></content>
      <post-name type="text"><![CDATA[A Bold New Look!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="69991539-4bfc-4cb9-a66d-09f836c0b344" />
      </categories>
      <tags>
        <tag ref="CSS" />
        <tag ref="blogging" />
      </tags>
    </post>
    <post id="73b64741-80eb-4d58-bbce-931fb5698fd8" date-created="2009-09-28T09:15:00" date-modified="2010-02-23T19:28:22" approved="true" post-url="/post/2009/09/28/the-technical-debt-of-red-green.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[The Technical Debt of Red Green]]></title>
      <content type="text"><![CDATA[<p>Recently, I have been seeing a lot of tweets and a couple of blog posts responding to <a href="http://www.joelonsoftware.com/items/2009/09/23.html" target="_blank">this post by Joel Spolsky</a> on &ldquo;The Duct Tape Programmer&rdquo;.&nbsp; In it, Joel implies that agilists just don&rsquo;t get the importance of having a &ldquo;get &lsquo;er <a href="http://www.lucisferre.org/image.axd?picture=images.jpg"><img style="border-bottom: 0px; border-left: 0px; margin: 8px; display: inline; border-top: 0px; border-right: 0px" title="images" src="http://www.lucisferre.org/image.axd?picture=images_thumb.jpg" border="0" alt="images" width="122" height="156" align="right" /></a> done&rdquo; attitude that the so-called &ldquo;duct tape programmer&rdquo; has.&nbsp; Apparently, the &ldquo;Red Green School of Software Development&rdquo; has much to teach all these ivory tower agilists about how to wield &ldquo;the handyman&rsquo;s secret weapon.&rdquo;</p>
<p>This, of course has met with a fairly poor response in the agile community.&nbsp; A couple of the blogged responses can be seen <a href="http://jeffreypalermo.com/blog/debunking-the-duct-tape-programmer/" target="_blank">here</a> from Jeffery Palermo and <a href="http://blog.objectmentor.com/articles/2009/09/24/the-duct-tape-programmer" target="_blank">here</a> from &ldquo;Uncle&rdquo; Bob Martin.</p>
<p>Uncle Bob is actually pretty fair with Joel.&nbsp; He agrees that the &ldquo;spirit&rdquo; of Joel&rsquo;s post is right on the money if perhaps the &ldquo;specifics&rdquo; are a bit hazy.&nbsp; Uncle Bob&rsquo;s, post is excellent,&nbsp; however I'm not sure I agree that by ignoring the specifics of Joel's post make it a "really good post."</p>
<p>For me, ignoring the <em>specifics</em> of Joel&rsquo;s post would be a bit like ignoring the <em>specifics</em> of a software implementation as long as it gets the job done, which is exactly what Joel is suggesting we can do.</p>
<p>Joel says, tests can wait, if they are even needed at all, because mostly they just waste time.&nbsp; He suggests that clean code and proper use of patterns and good practices are equivalent to &ldquo;using complex coding techniques&rdquo; that will &ldquo;doom your project&rdquo;.&nbsp; Finally, he implies that getting the job done despite what to me sounds like lack of understanding of how to use said patterns or the value of unit tests shows great talent&hellip;&nbsp; You see, Joel isn&rsquo;t just suggesting we use a little duct tape, which is what Uncle Bob says (and rightfully so) is ok, he is suggesting we use it liberally if it will get the product out the door.&nbsp;</p>
<p>This, I have a problem with, because for most companies and situations <strong>the goal of software development should not be to simply produce a product but to provide a service</strong>.<em>&nbsp; </em>By this, I mean, the software we design should be able to be constantly improved over time.&nbsp; Each new version should provide increasing value to clients, otherwise, why are they still paying you?&nbsp; I certainly hope they aren&rsquo;t paying for you to fix all the places where you used duct tape.</p>
<p>Duct Tape solutions, may offer you a &ldquo;tactical shortcut&rdquo; but this inevitably incurs the cost of technical debt in the long run.&nbsp; <a href="http://adventuresinagile.blogspot.com/">Adam</a> and I have recently been discussing how our backlog works and the need to separate technical debt and bug fixing from features and architecture.&nbsp; As Adam explains, work done dealing with technical debt and bug fixing <em>does not count towards your velocity.</em>&nbsp; This is important because it means it is not productive work.&nbsp; By using duct tape you reduce your future productivity, duct tape programming has diminishing returns the moment you use it.&nbsp; Proper architecture, clean code and <em>test-first</em> <em>design</em> have steady increasing returns.</p>
<p>Being Canadian, I happen to know a thing or two about duct tape and it seems pretty clear, by Joel&rsquo;s choice of analogy, that he has never seen the Red Green show.&nbsp; Anyone who has, knows that Red has never once built anything that worked with his liberal use of &ldquo;the handyman&rsquo;s secret weapon,&rdquo; duct tape.&nbsp; In general, if you use duct tape instead of careful design to build complex things someone (usually Red) is gonna get hurt.</p>]]></content>
      <post-name type="text"><![CDATA[The Technical Debt of Red Green]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1091489b-35f0-473f-8e03-c2b8aa031f8c" />
        <category ref="2c07e59a-ca1c-4daa-8218-0cb00efde8b7" />
      </categories>
      <tags>
        <tag ref="agile" />
      </tags>
    </post>
    <post id="4374e114-d77d-4c3a-878c-7f1834606a55" date-created="2009-09-22T21:54:00" date-modified="2010-03-05T08:06:53" approved="true" post-url="/post/2009/09/22/Please-stand-by.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Please stand by...]]></title>
      <content type="text"><![CDATA[<p>I'm sure someone said once, "if something is worth doing, it's worth doing right".&nbsp; I am firmly of the opinion this asshole had a lot of free time on his hands.&nbsp; Nonetheless, once I start on something I tend to obsess till I either tire myself out or I am satisfied.&nbsp; This has definitely been true of my decision to change blog software to a .NET blog (and as a prerequisite select a new hosting provider).&nbsp; I have spent a bit more time than I probably should have to evaluate my options: Subtext, <span class="misspell">dasBlog</span> and <span class="misspell">BlogEngine</span>.Net.&nbsp; I've installed them, skimmed the code, attempted to compile them from the trunk, broken them, failed to install them, tried out the skins, features, imported my blog posts, etc.&nbsp; After all of it was said and done I came back to my first choice <span class="misspell">BlogEngine</span>.Net.&nbsp;</p>
<p>I even went so far as to get a second hosting provider and registered <span class="misspell">lucisferre</span>.net to start testing these engines.&nbsp; Entirely unnecessary I realize, I could have tested them here of course, actually to be honest the fact that I discovered very quickly that <span class="misspell">GoDaddy</span> sucks balls probably motivated that change.&nbsp; I've also decided I'm not sure I'm really an "org", but that's semantics really.</p>
<p>Unfortunately, all of this time spent has meant no actual blogging has been done.&nbsp; Evaluating blog engines seems to be counter productive to the actual blogging process itself.&nbsp; Even more unfortunately (at least for anyone now reading this) it also means I am going to do a post <strong><em>about</em></strong> my evaluation of said blogging engines.</p>
<p>Disclaimer:&nbsp; I have in no way spent enough time with any of these packages to be considered an expert on any of them.&nbsp; I don't want my criticism to be taken as any more than my initial impressions of each of them and why I came to my final decision.&nbsp; I am not claiming I could do better, or than any of them "suck".&nbsp; All that out of the way here were my impressions:</p>
<p><strong>Subtext:</strong></p>
<p>This is probably the package I spent the most time with.&nbsp; It is a very popular blogging engine and has a good history and a good number of popular .NET related blogs use it.&nbsp; It uses ASP.NET <span class="misspell">MVC</span> framework, it uses <span class="misspell">IoC</span> and has a lot of code behind it (and I mean that, too much perhaps).&nbsp; It has some fairly decent looking skins, though I was a bit disappointed at the lack of "widgets" that could be quickly added or removed, this was a feature I really liked in b2evolution.&nbsp; Subtext does now have a <span class="misspell">plugin</span> framework, but it distinctly lacks actual <span class="misspell">plugins</span>.</p>
<p>I was able to install it on my provider fairly easily.&nbsp; Setup requires a bit of XML web.<span class="misspell">config</span> editing, unless you have direct access to your server via <span class="misspell">RDP</span> or something else, if you have shared hosting.&nbsp; I have always found the web.<span class="misspell">config</span> file a pain and when compared to configuration in <span class="misspell">PHP</span> or Rails it comes up short.&nbsp; I then I had to import my old blog data.&nbsp; My first attempt to import via <span class="misspell">RSS</span> to <span class="misspell">BlogEngine</span>.NET left all the comments behind.&nbsp; I downloaded the <a href="http://blogml.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=171"><span class="misspell">RSS</span>2<span class="misspell">BlogML</span></a> code and added my own provider for b2evolution (it works great and I will make the code available asap).&nbsp;</p>
<p>I noticed my first <a href="http://groups.google.com/group/subtext/browse_thread/thread/76103e706484b575">bug </a>immediately after importing.&nbsp; It's fixed in the trunk though, I just needed to get new stored <span class="misspell">proc's</span>... wait... stored <span class="misspell">proc's</span>?&nbsp; So the first ding against subtext for me was that it uses stored <span class="misspell">proc's</span> to interact with a database.&nbsp; I then checked out the trunk and started to look at the code.&nbsp; At least it seems to have a nice repository pattern going, wouldn't be to hard to write an <span class="misspell">nhibernate</span> based provider really, so that's a plus.&nbsp; I did notice almost every class was hundreds of lines long though and very hard to follow.&nbsp; Hard to believe <span class="misspell">SRP</span> is being followed here, but who am I to judge, you should see some of my code!!!</p>
<p>I played around with skins too, but that didn't work out any <a href="http://groups.google.com/group/subtext/browse_thread/thread/fba7437ee59432f7">better</a>.&nbsp; Restarting the application to updated configuration is one of my biggest beefs with .NET based web applications.&nbsp; There are ways around it though and here is a perfect place for a feature request: "want to be able to add a new skin without restarting my web app".&nbsp; I never got that skin to work.</p>
<p>Finally, I decided to try out the trunk, I figured maybe most of this is fixed in the trunk.&nbsp; It took a while to get it working though, you can't actually "build" from the trunk easily,&nbsp; they suggest you  grab whatever is the latest successful build from they <span class="misspell">CCNET</span> build server, which I did.&nbsp; Trying to use the trunk  was a poor choice though, the trunk seemed to have far more bugs than the latest release and was completely unusable for me.&nbsp; Now a lot of you might be saying, "well duh, it's development stupid, only release is stable", and that tells me you don't fully understand what "continuous integration" implies.&nbsp; Regardless as I had already discovered the release had enough bugs to turn me off using it I decided to finally dismiss it as my blog of choice despite coming very close.</p>
<p>Now I don't mean to be entirely negative about subtext, it's just that, well, my personal experience was definitely sub-par.&nbsp; Clearly, it is a good product for most, Oren uses it and it has an excellent team of developers behind it.&nbsp; I see many, many people with excellent subtext blogs out there.</p>
<p><strong><span class="misspell">dasBlog</span>:</strong>&nbsp;</p>
<p>I am not going to lie here, dB was probably the engine I spent the least time with.&nbsp; I believe it is also an ASP.NET <span class="misspell">MVC</span> web app, but I didn't spend enough time going through the code to be entirely certain.&nbsp; It did seem to me the code was even more daunting than Subtext's, which was already pretty beefy.&nbsp; I didn't have any problems installing it though, but I shouldn't really, it just uses XML files to store it's posts so that saves you having to set up a database.&nbsp; To be honest this is probably a good thing, a <span class="misspell">SQL</span> database is of questionable value when a blog engine is just a glorified XML generator anyways ;-).</p>
<p>I was again able to successfully import my <span class="misspell">BlogML</span> backup so that made me happy, however I was not terribly happy with the configuration or admin interface.&nbsp; I also couldn't settle on a skin I quite liked either.&nbsp; Still <span class="misspell">dasBlog</span> seemed to do the job, but having already setup <span class="misspell">BlogEngine</span>.Net I was at a loss to define with either <span class="misspell">dasBlog</span> or Subtext were doing that wasn't already working for me in <span class="misspell">BlogEngine</span>.</p>
<p><strong><span class="misspell">BlogEngine</span>.NET:</strong></p>
<p>As I mentioned in my previous posts there are definitely warning bells for me when I look at <span class="misspell">BlogEngine</span>.<span class="misspell">NET's</span> code.&nbsp; No unit tests, <span class="misspell">SQL</span> queries in the code, a <span class="misspell">WebForms</span> <span class="misspell">UI</span>, <em>too many notes...</em> no wait, that's why I don't like Mozart.&nbsp; Anyways, all of these things eat away at me as I sleep at night, but you know what, it just works.&nbsp; Seriously, all this agile crap can get stuffed, if it doesn't work.&nbsp; <span class="misspell">BlogEngine</span> has all of the features (at least as far as I can tell) of any of any other .NET blog engine but it works quite smoothly.&nbsp; Even despite its master page based <span class="misspell">WebForm</span> interface the code seems clean and readable.&nbsp;</p>
<p>That isn't to say BE.<span class="misspell">NEt</span> is <span class="misspell">beter</span> than Subtext or <span class="misspell">dasBlog</span>, but I am saying after careful evaluation, I decided it was simpler and more comfortable for me personally to use.</p>
<p>Well, that's that,&nbsp; I hope no one has any hurt feeling over what may have come off as a bit of a rant.&nbsp; Personally, I feel the .NET blog engines have some distance to cover to catch up to the likes of <span class="misspell">Wordpress</span> but they seem to be gaining speed.&nbsp; Adam is still telling me to build my own blog engine, but I think that's because he wants to move away from blogger and he is hoping I'll do the heavy lifting ;-).&nbsp; I do feel I would like to see a Monorail/<span class="misspell">Activerecord</span>/Windsor based blog engine, so who knows?&nbsp; For the short term I think I should try to keep my <span class="misspell">bloging</span> time focused on actually writing blog posts and not so much on writing <em>or</em> testing blog software.</p>
<p>As a result of all this, I now have a bit of a backlog of blog topics now in my head.&nbsp; A few upcoming post ideas I have on the way:</p>
<ul>
<li>Continuous Deployment: Using <span class="misspell">psake</span> to automate click-once deployment via <span class="misspell">TeamCity's</span> continuous integration server</li>
<li>Creating fluent interfaces for the heck of it, or "all the cool kids are doing it"</li>
<li>Creating and using a simple message bus to separate service dependencies</li>
</ul>]]></content>
      <post-name type="text"><![CDATA[Please stand by...]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="69991539-4bfc-4cb9-a66d-09f836c0b344" />
      </categories>
      <tags>
        <tag ref="blogging" />
        <tag ref=".net" />
      </tags>
    </post>
    <post id="e68e911a-b4a4-4d8e-a184-02b9ddeb33c0" date-created="2009-09-08T20:43:00" date-modified="2010-03-17T22:19:58" approved="true" post-url="/post/2009/09/08/Changing-over-to-BlogengineNET-for-now.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Changing over to Blogengine.NET... for now]]></title>
      <content type="text"><![CDATA[<p>Well I finally got fed up with a few things in b2evolution, specificially the following:</p>
<ul>
<li>To many options to configure, way to much work just for a simple blog</li>
<li>Everything required plugins, including code syntax highlighting and almost none of the plugins worked as expected.&nbsp; I eventually ended up rolling my own plugins</li>
<li>Having to write code in PHP and notepad++ to do anything</li>
<li>I changed my mind about the merits of seperating topics into multiple blogs using the multiblog feature</li>
<li>No export to XML or BlogML or anything for that matter, which worried me.&nbsp; The longer I stayed with b2evolution the more it would hurt to move away from it.</li>
</ul>
<p>There are definitely other issues with it, but overall it isn't a bad blog engine, but I wanted to start exploring my options in .NET as it is something I understand and use a whole lot more than PHP.</p>
<p>I picked blogengine.net for now because it seemed the simplest design but to be fair I really havn't taken the time to evaluate dasBlog and Subtext.&nbsp; It has an importer tool which was able to import my posts from b2evo via RSS (it isn't perfect but it did the trick and it is good enough).&nbsp; BlogEngine.NET can also export the blogs in BlogML so I won't be stuck with it if I decide to change again later.</p>
<p>Adam suggested I "roll my own".&nbsp; I think that is probably a bit more time than I really want to commit to my blog at this point, but it would be a good way to get some more experience  with .NET web development.&nbsp; Already I can see some chinks the armor for BE.NET.&nbsp; It is extremely simple, but at the same time almost too simple.&nbsp; The first thing that jumps out at me the total lack of unit tests in the downloaded source code, it makes me cringe in fear.&nbsp;</p>
<p>The author made an effort to avoid any dependancies on third party libraries.&nbsp; Unfortunately, this also means they have avoided using powerful tools like nHibernate, Castle Windsor (or other IoC containers), Monorail, etc. which can help make coding both cleaner and easier, but at the cost of learning how to work with these frameworks and understanding concepts like ORM, IoC and MVC... mmmm... TLAs ;-).&nbsp; I suppose one could argue that a blog engine should be simple enough that it doesn't need those kinds of things, but I still think it would benefit greatly from them.</p>
<p>Anyways, maybe down the road I will roll my own, for now I am happy to be able to spend some time working with a blog engine that is coded in a language I understand well and can perhaps learn a bit from.&nbsp; Then when I am ready I will consider perhaps either extending/contributing to the Blogengine.net project or writing my own from scratch.</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[Changing over to Blogengine.NET... for now]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="coding" />
        <tag ref="blogging" />
      </tags>
    </post>
    <post id="a13c329f-4298-4e28-af1e-b92dc087f84a" date-created="2009-09-07T03:33:00" date-modified="2009-12-29T00:12:52" approved="true" post-url="/post/2009/09/07/Sunday-Dinner-Pizza-Rustica.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Sunday Dinner: Pizza Rustica]]></title>
      <content type="text"><![CDATA[<p>Tonight I made one of Tea's favorites and something I haven't made in quite a while.&nbsp; It's called 'Pizza Rustica', though it is more of an Italian version of quiche than a pizza.&nbsp; You are going to want a deep pie pan, a 8" x 1 1/2" pan if you have one.&nbsp; If not you will probably need to adjust the recipie for the size of your pan.</p>
<p>Pastry:</p>
<ul>
<li>1 3/4 cups of white flour (I actually used half spelt half white flour)</li>
<li>7 tbls of butter (ideally chilled) in small cubes</li>
<li>1 egg yolk</li>
<li>Pinch of salt</li>
<li>1/4 cup of whole milk or light cream (I pity the fool who uses skim milk <img class="middle" src="http://www.lucisferre.org/rsc/smilies/graydead.gif" alt="XX(" />)</li>
</ul>
<p>Basically add the butter to the flower and salt and mix it with your hands (actually I use the dough blades on my food processor) until it resembles something like bread crumbs.&nbsp; Then add the egg yolk and whole milk and knead it into a ball of dough.&nbsp; Stick it in the fridge covered with saran wrap until you need it.</p>
<p>Filling:</p>
<ul>
<li>2 cups of Ricotta cheese</li>
<li>1 cup of mozzerella (I used bocconcini if I have it)</li>
<li>2/3 cup of pecorini romano, or parmigiano</li>
<li>3 eggs</li>
<li>Some fillings - I used Bresola which is air dried beef, you can use ham, procuitto, spinach, etc. you get the idea, it's just like a quiche so use what you want in the filling</li>
<li>Herbs for flavor (optional)</li>
</ul>
<p>This is pretty simple, just mix it all together.&nbsp; Now you should start your oven at this point and pre-heat it to 400F.</p>
<p>Take 2/3rds of the dough and roll it out so you can line the pan, cut off any excess and add the filling.&nbsp; Now roll out enough to top the pie and cut off any excess again.</p>
<p>Cook for 20 minutes at 400F and then for 20 minutes more at 350F.</p>
<div class="image_block"><a href="/media/blogs/general/pizzarustica.jpg"><img src="/media/blogs/general/pizzarustica.jpg" alt="" width="320" height="241" /></a></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/09/06/sunday-dinner-pizza-rustica?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Sunday Dinner: Pizza Rustica]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="60961e3d-020b-4362-8aad-91d6b33f1261" />
        <category ref="fd020249-be87-49a8-bc2b-2a5ddbb8ffaa" />
      </categories>
      <tags>
        <tag ref="food" />
        <tag ref="recipies" />
      </tags>
    </post>
    <post id="b9837a18-8c66-415f-9823-770e970124ba" date-created="2009-08-21T02:15:00" date-modified="2010-03-28T19:48:46" approved="true" post-url="/post/2009/08/21/Redmine-2b-IMAP-2b-Gmail-3d-Easy-ticket-submission-via-e-mail.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Redmine + IMAP + Gmail = Easy ticket submission via e-mail]]></title>
      <content type="text"><![CDATA[<p><img style="margin: 8;float: right;" src="/media/blogs/coding/speeding-ticket.jpg" alt="" width="180" height="125" /></p>
<p>This is a short  continuation of my <a href="/coding/index.php/2009/08/19/issue-feature-tracking-with-git-and-redmine-under-windows">earlier post </a>on getting Redmine setup under Windows.  This post will be about getting the incoming e-mail functionality enabled so that users can send and even update tickets via e-mail.&nbsp; In-fact, this is quite a powerful feature, "<strong>how powerful is it!?" </strong>you ask... just a second I'll get to that in a moment.</p>
<p>First, if you are following along from before then I can assume you are using Redmine under Windows and possibly even have it installed using the Bitnami stack.&nbsp; I can also assume you probably use Exchange for your e-mail system and more than likely it does not have a Ruby environment on it, nor does it have IMAP enabled.&nbsp; Finally, I am going to assume that the IT guys would get agitated if you even glanced in the direction of the server room.&nbsp; How am I doing so far?&nbsp; Alright, no worries, you should know better than to be playing with the production servers anyways.&nbsp; We are going to get this incoming e-mail thing working for you in not time, just stay with me.</p>
<p>For outgoing notifications Redmine uses SMTP, which should be no problem to get working in just about any environment.&nbsp; If all else seems lost just set up a Gmail account an use that for SMTP forwarding.&nbsp; I will assume there are no problems, just follow the instructions on the <a href="http://www.redmine.org/wiki/1/Email_Configuration">Redmine Wiki </a>for setting this up.</p>
<p>Incomming e-mail can be a bit more tricky.&nbsp; There are <a href="http://www.redmine.org/wiki/1/RedmineReceivingEmails">a few options</a> but most of them don't really work well in a Windows environment.&nbsp; Forwarding e-mails from the mail server requires running a ruby script and is suited to Postfix, Sendmail environments (to be honest you may have your Exchange server behind one of those so you may be able to do this, but hey, I said leave the production systems alone dammit!).&nbsp; Reading e-mails for the standard input is also not the greatest option since it is a) slow and b) still not all that suitable for a Windows environment.</p>
<p>Fortunately the IMAP option is perfect for us (and imho the best of any of them anyways) so we are going to go with that.&nbsp; Setting up Imap using a Gmail account is easy.&nbsp; I just created the account and enabled Imap in the settings.&nbsp; The harder part is configuring your Redmine server to check it's e-mails.</p>
<p>The wiki says to create a pycron job to run the mail checking script:</p>
<blockquote><code>*/30 * * * * redmineuser rake -f /path/to/redmine/appdir/Rakefile redmine:email:receive_imap RAILS_ENV="production" host=imap.foo.bar username=redmine@somenet.foo password=xxx</code></blockquote>
<p>Close... but I have to take the Windows environment into consideration.&nbsp; For starters we need to setup the rails environment variables before we run that.&nbsp; Here is what I did.</p>
<ul>
<li>First <a href="http://www.kalab.com/freeware/pycron/pycron.htm">download </a>and install the graphical version of pycron.&nbsp; It will as to set up a service, say <strong>yes</strong>. </li>
<li>Next, I added a batch file called <code>imapjob.bat</code> that in the apps/redmine/scripts folder.&nbsp; This is where Bitnami has all it's service scripts set up and it seemed like a good place for this.&nbsp; The batch commands are as follows:</li>
</ul>
<blockquote><code>CALL C:\BITNAM~1\scripts\setenv.bat <br />cd C:\BitNami Redmine Stack/apps/redmine <br />CALL rake redmine:email:receive_imap RAILS_ENV="production" host=imap.gmail.com port=993 ssl=SSL username=myfakebugzemail@gmail.com password=I8URBugz project=unsorted tracker=bug allow_override=project,tracker,priority</code></blockquote>
<ul>
<li>Obviously you want to replace the relevant paths depending on your installation</li>
<li>You may also want to customize the parameters of the script.&nbsp; The Wiki explains the options you have available.&nbsp; My setup is like this (this is where you can see the power of this feature):             
<ul>
<li>project=unsorted - <em>Adds incomming e-mail tickets to the "unsorted" project by default</em></li>
<li>tracker=bug <em>- Sets new e-mail tickts to "bug" by default</em></li>
<li> allow_override=project,tracker,priority - <em>Allows the user to override (set) the project, tracker and priority values in the body of the e-mail</em></li>
</ul>
</li>
<li>Now you open up pycron and add a job to your crontab, I like it to run every minute so just set all Schedule options to '*' and then set the command to:<br />
<pre>C:\BitNami Redmine Stack\apps\redmine\scripts\imapjob.bat</pre>
</li>
<li> Start your pycron service and set it to Automatic if you want it to start automatically if the server is reset</li>
</ul>
<p>That should do it.&nbsp; Make sure you set up your "unsorted" project or whatever you decided to call it and send a test e-mail to that Gmail account.&nbsp; Try out the overrides too, they are half the power of this feature.&nbsp; You can e-mail tickets that go to a specific project and have specific options set.&nbsp; You can also send a new e-mail to an existing ticket, just include the number in the subject, e.g., "Subject: I have fixed #13" if you wanted to update ticket 13.</p>
<p>But wait, there's more!&nbsp; It even takes attachments (apparently, I haven't had time to test all of the features as I am sitting here writing up this blog instead) so users can attach files, screen-shots, etc when they send an new ticket by e-mail.&nbsp; Honestly, I can't think of anything here they didn't think of here.</p>
<p>One more thing, if you want to use an internal e-mail account for this instead of the Gmail account, just have IT forward the e-mails to your Gmail account.&nbsp; They should have no problems with that, as long as you keep your gaze averted from the server room at all times. <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_cool.gif" alt="B)" /></p>
<p>Chris</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/08/20/redmine-imap-gmail-easy-ticket-submission-via-e-mail">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Redmine + IMAP + Gmail = Easy ticket submission via e-mail]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="redmine" />
        <tag ref="agile" />
      </tags>
      <comments>
        <comment id="afec4388-e83f-4057-a6a1-16127354f65e" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-01T21:56:48" date-modified="2010-01-01T21:56:48" approved="true" user-name="Hani" user-email="hani133@hotmail.com" user-ip="121.120.96.10" user-url="">
          <title type="text"><![CDATA[re: Redmine + IMAP + Gmail = Easy ticket submission via e-mail]]></title>
          <content type="text"><![CDATA[HI Chris,

I have tried so many times to get my outgoing notifications to work using the Gmail account but all have failed. Not sure what i've done wrong. Everytimes i click on the &quot;Send a test email&quot; the application keep on showing the &quot;(530 5.7.0 Must issue a STARTTLS command first. 21sm7691604yxe.19 )&quot; error. I've installed the Redmine application on Windows using the BitNami Redmine Stack version 0.8.7 (the latest). Can you help me please. I've been trying to get the notification to work for 2 days now. Sigh....
]]></content>
        </comment>
        <comment id="d39541f9-a73e-483b-a286-2d9a89158fd4" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-01-02T10:26:13" date-modified="2010-01-02T10:26:13" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.org/">
          <title type="text"><![CDATA[re: Redmine + IMAP + Gmail = Easy ticket submission via e-mail]]></title>
          <content type="text"><![CDATA[Ah these instructions are for incoming e-mails.  You need to setup TLS to [i]send[/i] email with Gmail as it is a secure SMTP server.  You can find instructions for that here:

http://redmineblog.com/articles/setup-redmine-to-send-email-using-gmail/

Good luck!]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="40df0507-380b-4544-85d7-c161f27090b4" date-created="2009-08-20T02:50:00" date-modified="2010-03-24T17:13:50" approved="true" post-url="/post/2009/08/20/Issuefeature-tracking-with-Git-and-Redmine-under-Windows.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Issue/feature tracking with Git and Redmine under Windows]]></title>
      <content type="text"><![CDATA[<div class="image_block"><img style="margin: 6px; float: right;" src="/media/blogs/coding/ladybug1VG_lg.jpg" alt="" width="134" height="134" /></div>
<p>Over the last couple weeks, we've been trying to pick out a solid combination of tools for a Windows based dev environment.&nbsp; The key components are: source control (SCM), continuous integration (CI) and issue/bug tracking.&nbsp; <em>Our choices</em>: <em>Git</em> for SCM, <em>TeamCity</em> for CI and <em>Redmine</em> for issue/feature tracking.</p>
<p>We originally tried out Fogbugz, but it's integration with SCM solutions, particularly Git is somewhat limited.&nbsp; Even for SVN it relies on external web interfaces such as WebSVN.&nbsp; Still, it does look like a great issue/bug tracker and I hope they can resolve their SCM integration issues soon.&nbsp; Up next, Redmine.</p>
<p>&nbsp;</p>
<p>Redmine has excellent built in SCM integration for a wide range of systems including SVN, Git, Hg and more.&nbsp; It has it's own repository browser built-in and thus is not dependant on any other components to make it work.&nbsp; Even more, it comes with a host of community supported plugins.&nbsp; Two that caught my eye were a  charting plugin to provide burndown and other charts and a code review plugin.</p>
<p>Setting up Redmine is fairly easy, even for Windows.&nbsp; You can <a href="http://bitnami.org/stack/wampstack">download </a>a Redmine WAMP stack from Bitnami (or a LAMP stack for Linux), which will get you setup and running with Redmine, MySql, Ruby and Apache in minutes (it also includes a Subversion server which you can use if you really prefer SVN<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_wth.gif" alt="|-|" />).&nbsp; Unfortunately, while the 0.8.4 version included by Bitnami supports Git repositories it is missing support for Git branches.&nbsp; That feature was added to the trunk after 0.8.4.</p>
<p>I decided I wanted to have that feature and I also wanted to have the ability to update my Redmine installation from the trunk whever I wanted.&nbsp; I spent some time reading through their Wiki documentation on <a href="http://www.redmine.org/wiki/redmine/RedmineUpgrade">upgrading</a> and it definitely seemed doable.&nbsp; Sadly, though it was a breeze to get Bitnami's stack installed, it was not as straightforward to get it working with the trunk version of Redmine.&nbsp; Below, I outline for posterity the steps I took which finally got it working for me.&nbsp; I hope this will save others the pain and suffering (and a days worth of my time) that I spent fiddling around.</p>
<blockquote>Before starting I recommend reading the Wiki pages on <a href="http://www.redmine.org/wiki/redmine/RedmineInstall">installing </a>and <a href="http://www.redmine.org/wiki/redmine/RedmineUpgrade">upgrading </a>Redmine.&nbsp; We will be performing several of the steps descibed there and the Wiki can be a good reference if you get stuck.</blockquote>
<p>Updating Bitnami Redmine from 0.8.4 -&gt; trunk</p>
<ul>
<li>First install the bitnami stack.&nbsp; I will leave this part to you, it is pretty simple</li>
<li>Stop all the Bitnami services except for MySQL, we will need this to migrate the database and test</li>
<li>Start the Bitnami command environment (this sets up environment variables so you can use ruby from the command line)</li>
<li><a href="http://www.redmine.org/wiki/redmine/CheckingoutRedmine">Check-out the trunk </a>of Redmine into a second folder in the bitnami apps folder, I called mine /redmine-trunk</li>
<li>If you are upgrading a working version make sure to backup your database and files as outlined <a href="http://www.redmine.org/wiki/redmine/RedmineUpgrade">here</a></li>
<li>Copy the database.yml and email.yml file from /redmine/config to /redmine-trunk/config</li>
<li>Run:
<pre>rake db:migrate RAILS_ENV="production"</pre>
</li>
<li>If you have plugins to update run:
<pre>rake db:migrate:upgrade_plugin_migrations RAILS_ENV="production" 
rake db:migrate_plugins RAILS_ENV="production"</pre>
</li>
<li>You must also run:<br />
<pre>rake config/initializers/session_store.rb</pre>
</li>
<li>Bitnami comes with rail 2.3.2 but Redmine expects 2.2.2 (the included Redmine has 2.1.2 frozen to it, but the trunk needs 2.2.2 minimum).&nbsp; For my purposes I just downgraded rails but I believe you can also set Set this:<br />
<pre>RAILS_GEM_VERSION = '2.3.2'</pre>
in environment.rb.&nbsp; To downgrade you can run the following:<br />
<pre>gem install rails -v=2.2.2
gem uninstall rails -v=2.3.2</pre>
</li>
<li>Finally you need install the mysql gem as the<br />
<pre>gem install mysql
</pre>
you will get an error message about documentation, just ignore it.</li>
<li>Now here is where I got stuck for quite a while (though it wasn't the only sticking point).&nbsp; It seems Ruby has a small issue with MySQL.&nbsp; I found the solution <a href="http://forums.aptana.com/viewtopic.php?f=20&amp;t=7563">here</a>.&nbsp; Copy the dll they suggest in the Bitnami ruby/bin/ folder.</li>
<li>Ok lets test it go to the /redmine-trunk folder and run
<pre>ruby script/server -e production
</pre>
you should be able to access http://localhost:3000/ and everything should be working.&nbsp; Ctrl-C out of that we have some more work to do still.</li>
<li>Copy over the following folders from /redmine to /redmine-trunk     
<ul>
<li>/conf (has the apache conf file)</li>
<li>/scripts (has the service scripts used by bitnami)</li>
<li>/lang (probably not needed but lets get it anyways)</li>
</ul>
</li>
<li>Finally rename the folders.&nbsp; I called /redmine -&gt; /redmine-old and /redmine-trunk -&gt; /redmine.</li>
<li>Now start up the two mongrel services and then the apache service.&nbsp; If everything went as planned you should be able to access Redmine at the port you originally setup during the Bitnami install.</li>
</ul>
<p>Wow, it seems a lot easier after all written out, but believe me this took all day to get working (and then some).&nbsp;&nbsp; Please let me know if this doesn't work for you (because I am thinking I may have forgot something...).&nbsp; While I prefer to set up software like this under Linux, we all know that isn't always an option.&nbsp; Those of us chained to Windows environments shouldn't have to suffer alone <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_wink.gif" alt=";)" />.</p>
<p>Just from initial testing and playing around I can see that Redmine is going to be a great product.</p>
<p>-Chris</p>
<div class="image_block">&nbsp;</div>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/08/19/issue-feature-tracking-with-git-and-redmine-under-windows">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Issue/feature tracking with Git and Redmine under Windows]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="git" />
        <tag ref="git" />
        <tag ref="redmine" />
        <tag ref="redmine" />
        <tag ref="agile" />
        <tag ref="agile" />
      </tags>
      <comments>
        <comment id="e383064c-3350-4ff0-8ab7-85bd1c965cb3" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-16T12:59:21" date-modified="2009-08-16T12:59:21" approved="true" user-name="adam d [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Issue/feature tracking with Git and Redmine under Windows]]></title>
          <content type="text"><![CDATA[<br />
Great job documenting this, Chris!]]></content>
        </comment>
        <comment id="c45f82cc-c79e-4b84-92e6-fc5cd53cc792" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-09-02T19:45:37" date-modified="2009-09-02T19:45:37" approved="true" user-name="Cailin Nelson [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Issue/feature tracking with Git and Redmine under Windows]]></title>
          <content type="text"><![CDATA[Could you provide some info about which charting plugin you chose for burndown charts, how you installed it, and how it's worked out for you?]]></content>
        </comment>
        <comment id="fbac1c06-31ee-450d-b198-a70427c5ee52" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-09-03T01:42:11" date-modified="2009-09-03T01:42:11" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Issue/feature tracking with Git and Redmine under Windows]]></title>
          <content type="text"><![CDATA[It is the charts plugin.  We have just started using Redmine so we don't have enough backlog in it yet to really get use out of the burndown chart yet.<br />
<br />
<a href="http://www.redmine.org/wiki/redmine/Plugin_List#Charts-plugin" rel="nofollow">http://www.redmine.org/wiki/redmine/Plugin_List#Charts-plugin</a>]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="d2a19a10-fbd9-4bbd-be85-4de2c07504e5" date-created="2009-08-16T01:36:00" date-modified="2009-10-05T09:38:42" approved="true" post-url="/post/2009/08/16/Petitions-for-(and-against)-a-24-hours-Skytrain.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Petitions for (and against) a 24 hours Skytrain]]></title>
      <content type="text"><![CDATA[<p>A while ago I signed up for the Facebook group <a href="http://www.facebook.com/group.php?gid=6666586191">the petition to keep the Skytrain open 24-hours </a>(personally I find these thing to be kind of weak but whatever, it's easy right?).  It has always bugged me that a system designed to run nearly automatically is shut down for a measly 4 hours right as bars and clubs are closing.&nbsp; In fact, it seems particularly unfair to those who work in Vancouver's night clubs and bars.  Generally, it seems to me that anything that could help get this city better transit is a good thing.</p>
<p>Today I was just checking on where the petition was going and if it was getting any media traction when I ran into <a href="http://www.dabbler.ca/news/petition-for-and-against-24-hour-skytrain-service-20080109/trackback/">this post</a>.&nbsp; As it mentions there is also a counter petition Facebook group, <a href="http://www.facebook.com/group.php?gid=6855379854">the petition against the petition to keep the Skytrain open 24 hours</a>.&nbsp; So far (and it's been months) it's really kind of a joke.&nbsp; I mean, the actual petition has over 30,000 members, while they have a measly... err, I mean <em>empowered</em>... 30.</p>
<p>What I found even funnier than this was the content of actual blog article.&nbsp; The author confidently refers to the petitioners as a "fringe group", yeah, and I suppose the 30 people against are "the silent majority",&nbsp; what a joke.&nbsp; He then goes on to deride the Facebook petition while at the same time espousing the Facebook anti-petition.&nbsp; Slick...</p>
<p>&nbsp;</p>
<p>Even worse than the poor math skills and mild hypocrisy were the arguments put forth by the anti-petitioners against keeping the trains running:</p>
<p><strong>*</strong> It would require hiring more security<br /> <strong>*</strong> It would require hiring more staff to run the SkyTrain (they don&rsquo;t run by themselves you know)<br /> <strong>*</strong> Crime around these areas would go up<br /> <strong>*</strong> It only helps people living around the SkyTrain<br /> <strong>*</strong> The noise from SkyTrains running at late hours would not excite those who live along the route<br /> <strong>*</strong> What next? 24 hour buses? 24 hour SeaBus?<br /> <strong>*</strong> If the Trains are running 24 hours, when will engineers do repairs?</p>
<p>The blog article suggests these are, <em>"All valid points ignored by the first petition." </em>That got an eyebrow raise from me. Valid? hmmm... sigh, <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" /> ok lets begin then.</p>
<p>These arguments seem to all boil down to 4 things: it would cost the city a whole lot more (than running 20 hours), it would create more crime, it would be noisy and it would be impossible to maintain.&nbsp; I will ignore "it would only help people living around the SkyTrain" because that's just stupid.&nbsp; I will also ignore the statement about the 24 hours buses because apparently they haven't taken one of the cities night buses yet (I'm betting they've never taken transit at all).</p>
<p>First, it is clearly going to cost pretty much the same for 4 more hours as it does for any four hours of the previous 24-hours.&nbsp; This is kind of obvious, well obvious to those who can apply basic common sense.&nbsp; The Skytrain is designed to run with minimal staff, it is operated remotely and doesn't need drivers, it requires only a few operators and as for security, well, <a href="http://www.britishcolumbia.name/news/no-help-for-man-beaten-on-camera/">Skytrain security is largely a joke</a> anyways.</p>
<p>The crime argument is an easy one to make.&nbsp; The fact that crime occurs on the Skytrains at all is all the proof someone needs to put this fallacy together.&nbsp; I mean, it's true too, I just linked an example in the last paragraph, didn't I?&nbsp; The problem is, if this made sense then by extension it must make sense to just shut it down altogether.&nbsp; I mean it would prevent these crime right?&nbsp; Obviously not, the truth is crime happens in cities and it isn't limited to the Skytrain trains and stations.&nbsp; Better security, surveillance and enforcement is the obvious solution here no matter how many hours it runs.</p>
<p>The noise aspect does confuse me a bit,&nbsp; I certainly don't live right beside the trains, but  do these people sleep for four hours a night?&nbsp; I bet not a single one of the 30 angry men and women lives near a Skytrain line either -- well their fourth point kinda gives that away doesn't it? Which one is it? It will <em>only help people who live near the Skytrain </em>or it will <em>only annoy them</em>, both I guess.&nbsp; The Skytrain is probably one of the quietest mass transit systems I have ever seen and it actually slows down through sections as it passes by people apartments downtown.</p>
<p>The last one is the best one of course, <em>"if the Trains are running 24 hours, when will engineers do repairs?" </em> This appears to be the same excuse <a href="http://www.canada.com/theprovince/news/story.html?id=ceb3e3c2-ab02-4955-b9fa-d86fc0860eaf&amp;k=94836">Translink is going with</a><em>. </em>Lame... NY manages to run 24 hour mass transit.&nbsp; The London Tube gets by with 1 hour of downtime, which seems reasonable enough to me.</p>
<p>Perhaps the anti-petitioners are right when they say, <em>&ldquo;Experienced rail cities like London and Tokyo start and stop trains around the same time as Vancouver,"&nbsp; w</em>ell, execpt the "same time" part.&nbsp; I think we can agree here though, an hour of downtime would be an agreeable compromise.&nbsp; If instead it was, <span style="text-decoration: underline;"><em>the petition to keep the Skytrain running 23 hours a day</em></span>, maybe all sides of this argument would be satisfied.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/08/15/petitions-for-and-against-a-24-hours-skytrain?blog=5">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Petitions for (and against) a 24 hours Skytrain]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="ac3232d9-d92c-492b-ba4a-12bd53e6a9d1" />
      </categories>
      <tags>
        <tag ref="Opinion" />
        <tag ref="Vancouver" />
      </tags>
    </post>
    <post id="f169f929-c257-4ce0-bcf9-173f7123d3db" date-created="2009-08-15T22:43:00" date-modified="2009-10-05T09:38:28" approved="true" post-url="/post/2009/08/15/Get-VisualSVN-to-play-nice-with-WebSVN-and-more.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Get VisualSVN to play nice with WebSVN and more]]></title>
      <content type="text"><![CDATA[<p>VisualSVN is a easy and free way to have a Subversion repository running under Windows in no time flat.&nbsp; That said it still leaves a lot to be desired.&nbsp; It has no built in bug/feature tracking, as I <a href="/coding/index.php/2009/05/08/svn-trac-and-windows-oh-my">posted </a>about before even getting Trac setup with it can be a pain (though if you read the comments you will see that they have remedied that with an update).&nbsp; Here I am going to talk about adding WebSVN and even svn:// protocol support to your VisualSVN with relative ease.</p>
<p>I've recently been working with <a href="http://adventuresinagile.blogspot.com/">Adam Dymitruk</a> who has been brought into the team I am working with as our Agile coach.&nbsp; This has involved getting a few other things up and running along side source code versioning such as continuous integration with TeamCity and feature/bug tracking with FogBugz.&nbsp; Getting TeamCity up and running with VisualSVN is definitely easy enough, however FogBugz - SVN integration is somewhat dependent on having a working WebSVN installation.</p>
<p>VisualSVN comes with a decent, but somewhat limited web interface (in fact it is the only interface it comes with as it doesn't even support svn:// protocol out of the box).&nbsp; In order to provide a bit more functionality and get it working with Fogbugz I had to get WebSVN installed.&nbsp; This is actually fairly simple.</p>
<h3>Part 1: Setting up WebSVN</h3>
<ul>
<li>First you need to install PHP5 on the server and tell it to install the Apache mod in the <code>C:\Program Files\VisualSVN Server </code>folder (or wherever you installed VisualSVN to).&nbsp; You may need to tell it where the \bin\ folder is I can't remember.</li>
<li>Next download an up-to-date version of WebSVN from http://websvn.tigris.org/ and extract the files to <code>C:\Program Files\VisualSVN Server\htdocs\websvn </code></li>
<li>Edit the <code>httpd-custom.conf</code> file and add the following to it</li>
</ul>
<pre>&lt;Location /websvn/&gt;<br />   Options FollowSymLinks<br />   SVNListParentPath on<br />   SVNParentPath "C:/Repositories/"<br />   AuthName "Subversion Repositories"<br />   AuthType Basic<br />   AuthBasicProvider visualsvn<br />   AuthzVisualSVNAccessFile "C:/Repositories/authz-windows"<br />   AuthnVisualSVNUPN Off<br />   Require valid-user<br />&lt;/Location&gt;<br /></pre>
<ul>
<li>This assumes your repo's are in <code>C:/Repositories/</code> change this as needed.&nbsp; Note that the <code>AuthzVisualSVNAccessFile </code>like is setup for the Windows authentication option in VisualSVN.&nbsp; If you are using normal subversion authentication it should probably just be <code>C:/Repositories/authz</code> </li>
<li>You can also edit httpd.conf and move the section that starts <code>#BEGINPHP INTSALLER EDITS</code> to httpd-custom.conf (this way VisualSVN will not overwrite the PHP settings when you upgrade.</li>
<li>Now you need to install <a href="http://www.cygwin.com/">Cygwin </a>so you have all the utilities WebSVN needs to function property.&nbsp; Be sure to select the following packages when you install      
<ul>
<li>Diff, Sed, Enscript (for syntax coloring), Tar, Gzip and Zip</li>
<li>Not all of those are required but you will lose some functionality if you don't have them.&nbsp; At the very least you should have Diff, Tar and Gzip.</li>
</ul>
</li>
<li>Finally go to <code>VisualSVN Server\htdocs\websvn\include</code> and edit the<code> distconfig.php</code>.&nbsp; You can pretty much follow along and set all the options as instructed at a minimum you should do the following:      
<ul>
<li>Point it to your cygwin tools and SVN binaries:&nbsp;      
<ul>
<li><code>$config-&gt;setSVNCommandPath('C:/Program Files/VisualSVN Server/bin');</code></li>
<li><code>$config-&gt;setDiffPath('C:/cygwin/bin');</code></li>
<li><code>$config-&gt;setEnscriptPath('C:/cygwin/bin');</code></li>
<li><code>$config-&gt;setSedPath('C:/cygwin/bin');</code></li>
<li><code>$config-&gt;setTarPath('C:/cygwin/bin');</code></li>
<li><code>$config-&gt;setGZipPath('C:/cygwin/bin');</code></li>
<li><code>$config-&gt;setZipPath('C:/cygwin/bin');</code></li>
</ul>
</li>
<li>Setup your repository config: <code>$config-&gt;parentPath('C:\\Repositories');</code></li>
<li>Setup your authentication: <code>$config-&gt;useAuthenticationFile('C:/Repositories/authz');</code></li>
<li>Go through the configuration and set any other options you would like to use.</li>
</ul>
</li>
<li>Finally save <code>distconfig.php</code> as <code>config.php</code></li>
</ul>
<p>That should be it.  Hopefully I have not forgotten anything.  Restart the VisualSVN service so that it will restart apache.  Now instead of going to http://localhost/svn go to http://localhost/websvn (of course, use https:// if that is how you have it configured).</p>
<h3>Part 2: Setting up svn://</h3>
<p>I really don't know why but for some reason VisualSVN does not come with svn protocol enabled by default.&nbsp; It seems pretty silly since it is easy to do and it is a bit faster than access through http:// or https://.&nbsp; Nonetheless, it does come with a full SVN install and therefore it has svnserve, so just open a command prompt and we will create a service neat and quick:</p>
<p>&nbsp;</p>
<p><code>sc create SVNService binpath= "c:\Program Files\VisualSVN Server\bin\svnserve.exe --service --root C:\Repositories\" displayname= "Subversion Service" depend= Tcpip</code></p>
<p>&nbsp;</p>
<p>You can, of course remove the service with</p>
<pre>sv delete SVNService</pre>
<p>&nbsp;</p>
<p>I hope this has been helpful, to be honest while I was glad I was able to get all this done, Adam shortly thereafter decided to show me Git and, well, I'm a Git convert now I guess<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" />.  Let me leave you with a warning though, webgit is <em>not nearly as easy to set up under Windows </em>(I'm not sure you even can) as WebSVN is, so it looks like it will be time to switch to a Linux box (thank God...).&nbsp; Honestly, I am still a firm believer that if you want to use either SVN or Git you should setup a Linux box to host your repositories and to provide Apache and any web interfaces that depend on Apache.  Windows was never meant to run this stuff (and screw NT authentication!)</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/08/15/get-visualsvn-to-play-nice-with-websvn-and-more">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Get VisualSVN to play nice with WebSVN and more]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="SVN" />
      </tags>
      <comments>
        <comment id="ba40e725-7069-42c2-8d29-95a97df5c546" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-04-01T12:06:28" date-modified="2010-04-01T12:06:28" approved="true" user-name="DavidNL" user-email="david@staron.nl" user-ip="213.51.114.210" user-url="">
          <title type="text"><![CDATA[re: Get VisualSVN to play nice with WebSVN and more]]></title>
          <content type="text"><![CDATA[Hi there,

thanks for the article. Helped me to get it up and running...
This is what i ended up putting in the httpd-custom.config file to get it to work:

###################################################
LoadModule php5_module php/php5apache2_2.dll

&lt;IfModule dir_module&gt;
    DirectoryIndex index.php index.php3 index.html index.htm
&lt;/IfModule&gt;

&lt;IfModule mime_module&gt;
	AddType application/x-httpd-php .php
    AddType application/x-httpd-php .php3
&lt;/IfModule&gt;

&lt;Location /websvn/&gt;
   Options FollowSymLinks
   SVNListParentPath on
   SVNParentPath &quot;C:/Repositories/&quot;
   AuthName &quot;Subversion Repositories&quot;
   AuthType Basic   
   #AuthBasicProvider visualsvn
   #AuthzVisualSVNAccessFile &quot;C:/Repositories/authz&quot;
   #AuthnVisualSVNUPN Off
   AuthBasicProvider file
   AuthUserFile &quot;C:/Repositories/htpasswd&quot;
   AuthzSVNAccessFile &quot;C:/Repositories/authz&quot;
   Require valid-user
&lt;/Location&gt;
###################################################

Also the &quot;SC create&quot; command didn't work for me. So i used this:

sc create SVNService binpath= &quot;c:\Program Files\VisualSVN Server\bin\svnserve.exe&quot; displayname= &quot;Subversion Service&quot; depend= Tcpip

and then i added the parameters by using regedit to HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SVNService -&gt; then edit &quot;ImagePath&quot; to:
&quot;c:\Program Files\VisualSVN Server\bin\svnserve.exe&quot; --service --root C:\Repositories\

Thanks again,
regards David.]]></content>
        </comment>
        <comment id="e35ee28a-d0c2-41a1-875f-1c7fcc75b034" parentid="ba40e725-7069-42c2-8d29-95a97df5c546" date-created="2010-04-01T18:54:04" date-modified="2010-04-01T18:54:04" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Get VisualSVN to play nice with WebSVN and more]]></title>
          <content type="text"><![CDATA[Thanks for that David, sorry if my guide is a bit out of date, it has been a while since I've used VisualSVN as I'm a big Git user now.  I'm working on a new post about how to use Git to work with an SVN repository.  Maybe it will be of interested to you.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="eece2479-0ad3-45a0-8762-4ae1dbef0247" date-created="2009-08-15T21:49:00" date-modified="2009-10-05T09:37:51" approved="true" post-url="/post/2009/08/15/Generate-Custom-DDL-for-your-Custom-Id-Generator-with-nHibernate.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Generate Custom DDL for your Custom Id Generator with nHibernate]]></title>
      <content type="text"><![CDATA[<p>A while ago I <a href="/coding/index.php/2009/07/13/implementing-a-custom-id-generator-for-nhibernate-1">posted </a> about writing a custom id generator using nHibernate and extending one of the existing Generator classes nHibernate provides.&nbsp; This was done to support working with a legacy database which uses a custom id generation strategy.&nbsp; One thing I like to do with all my apps is write some basic CRUD tests to make sure my mappings and queries are all working properly.</p>
<p>To do this I use Oren's approach of <a href="http://ayende.com/Blog/archive/2009/04/28/nhibernate-unit-testing.aspx">creating a temporary in-memory database </a>using SQLite to work with.&nbsp; This involves using the&nbsp; <code>SchemaExport </code>tool in nHibernate to generate the DDL to create the database.&nbsp; If you are using a table generator strategy it also needs to create the table and columns for the custom id generator.&nbsp; In some cases you may need to customize the DDL for your Id table.</p>
<p>&nbsp;</p>
<p>As I discovered the code to generate the table for a custom id is only run once per class (and then only on the base class if you are inheriting).&nbsp; For my id generator there is a separate column used for each table in the database.&nbsp; So, for example the <em>Price </em>table has a column in the <em>Counter </em>table called <em>Price </em>to store it's counter and the <em>Holding </em>table has a column called <em>Holding</em>.</p>
<p>The TableGenerator class supports two parameters which are set in the HBM files (or using fluent) <em>tablename </em>and <em>columnname </em>which set the table and column names used for the id counter.&nbsp; If you have a copy of the nHibernate source code you will see that the TableGenerator class calls<code> SqlCreateStrings()</code>and <code>SqlDropString()</code> to create and drop the table for the id generator.&nbsp; Unfortunately, as I mentioned above this is only called once, and so it only creates one table with one column for whichever mapping is handled first.</p>
<p>In order to fix this I had to copy the <code>TableGenerator </code>class (yes, yes, I know copy-paste is bad form) and modify those functions.&nbsp; I also added a third parameter <em>allcolumnnames</em> in which I can provide a comma separated list of all the columns the table needs to have (one per table in my database).&nbsp; The <code>SqlCreateStrings()</code>is simple changed to:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">string</span>[] SqlCreateStrings(<span style="color: #2b91af;">Dialect</span> dialect) {</p>
<p style="margin: 0px; padding: 0px;">&nbsp; <span style="color: blue;">string</span> create = <span style="color: #a31515;">"create table "</span> + tableName + <span style="color: #a31515;">" ("</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; <span style="color: blue;">string</span> insert = <span style="color: #a31515;">"insert into "</span> + tableName + <span style="color: #a31515;">" values ("</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; <span style="color: blue;">foreach</span> (<span style="color: blue;">string</span> s <span style="color: blue;">in</span> allcolumns.Split(<span style="color: #a31515;">','</span>)) {</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; create += <span style="color: #a31515;">" "</span> + s + <span style="color: #a31515;">" "</span> + dialect.GetTypeName(columnSqlType) + <span style="color: #a31515;">","</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; insert += <span style="color: #a31515;">" 1,"</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp; create = create.Trim(<span style="color: #a31515;">','</span>) + <span style="color: #a31515;">" )"</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; insert = insert.Trim(<span style="color: #a31515;">','</span>) + <span style="color: #a31515;">" )"</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">new</span>[] {create, insert};</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>(Yes, yes, I know I should have learned from my <a href="/coding/index.php/2009/08/04/strings-are-immutable-stupid">last post </a>and used a <code>StringBuilder </code>here as I pointed out in my last post, but seriously, this method will only ever be called once)</p>
<p>Now when it is called it will create the correct table with all the columns I need.  A couple of example mappings for the database in FluentNH are shown below:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> InvestSpecMap() {</p>
<p style="margin: 0px; padding: 0px;">&nbsp; WithTable(<span style="color: #a31515;">"InvestSpec"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp; Id(x =&gt; x.Id).ColumnName(<span style="color: #a31515;">"InvestSpecID"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .SetGeneratorClass(<span style="color: blue;">typeof</span> (<span style="color: #2b91af;">FdpSequenceGen</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"allcolumns"</span>, <span style="color: #a31515;">"InvestSpec, InvestPrice"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"table"</span>, <span style="color: #a31515;">"zSysCounters"</span>) <span style="color: green;">//ID counter table name</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"column"</span>, <span style="color: #a31515;">"InvestSpec"</span>); <span style="color: green;">//ID counter column name</span></p>
</div>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> PriceMap() {</p>
<p style="margin: 0px; padding: 0px;">&nbsp; WithTable(<span style="color: #a31515;">"InvestPrice"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp; Id(x =&gt; x.Id).ColumnName(<span style="color: #a31515;">"InvestPriceID"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .SetGeneratorClass(<span style="color: blue;">typeof</span> (<span style="color: #2b91af;">FdpSequenceGen</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"allcolumns"</span>, <span style="color: #a31515;">"InvestSpec, InvestPrice"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"table"</span>, <span style="color: #a31515;">"zSysCounters"</span>) <span style="color: green;">//ID counter table name</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"column"</span>, <span style="color: #a31515;">"InvestPrice"</span>); <span style="color: green;">//ID counter column name</span></p>
</div>
<p>To be completely "clean code" and avoid repeating myself I should probably factor out the <code>Id() </code>code into a method in an inhereted base class so I can call it from each mapping class like this:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">protected</span> <span style="color: blue;">void</span> SetIdGenerator(<span style="color: blue;">string</span> tablename) {</p>
<p style="margin: 0px; padding: 0px;">&nbsp; Id(x =&gt; x.Id).ColumnName(TableName + <span style="color: #a31515;">"Id"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .SetGeneratorClass(<span style="color: blue;">typeof</span>(<span style="color: #2b91af;">FdpSequenceGen</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"allcolumns"</span>, AllColumns)</p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"table"</span>, <span style="color: #a31515;">"zSysCounters"</span>) <span style="color: green;">//ID counter table name</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp; &nbsp; .AddGeneratorParam(<span style="color: #a31515;">"column"</span>, TableName); <span style="color: green;">//ID counter column name</span></p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>Now I can unit test using a temporary in-memory SQLite database and all my tests are passing.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/08/15/generate-custom-ddl-for-your-custom-id-generator-with-nhibernate">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Generate Custom DDL for your Custom Id Generator with nHibernate]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
      </tags>
    </post>
    <post id="e869c639-4ba5-4369-86db-d69933c1ba8d" date-created="2009-08-08T19:47:00" date-modified="2010-03-15T08:39:46" approved="true" post-url="/post/2009/08/08/Wax-Mannequin-Pats-Pub.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Wax Mannequin @ Pat's Pub]]></title>
      <content type="text"><![CDATA[<p>It was years ago during my undergrad days in Kingston that a good friend of ours asked us to come watch her sister play at the Scherzo pub. Her sister, Krista Muir, plays her own style of synth-pop music while also playing in character as <a href="http://www.youtube.com/watch?v=21hEIgRPQSk">Leiderhosen Lucil</a>. Armed only with an impressive command of every key on her mighty Yamaha synthesiser and a pair of homemade Leiderhosen (I've heard she has quite a collection), she comes prepared to rock you! If you've never heard of her, which is probably a good bet if your not from Ontario or Quebec, you should do yourself a favour and click that link right now.&nbsp; Unfortunately for you LL is no more <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_sad.gif" alt=":(" /> but I believe she still plays under her real name now.</p>
<p class="western" lang="en-GB">I digress though, this blog isn't about Lucil, it's about Wax Mannequin. That night, many years ago, playing right before (or perhaps after, memories of my undergrad are a little hazy) was the legendary Wax Mannequin. Wax had his own extravagant rock style and character.&nbsp; He combined a single guitar, a drum machine, a set of effects pedals with his intense <em>rock and roll hero</em> persona into a show that is not easily forgotten  <img src="/plugins/tinymce_plugin/tiny_mce/plugins/more/img/trans.gif" border="0" alt="" width="1" height="1" align="BOTTOM" /></p>
<p class="western" lang="en-GB">I saw both Lucil and Wax a few more times during my extended stay in Kingston, but being back in Vancouver I had accepted that I would probably never see either again. That was until I noticed yesterday that Mark Bignell (of <a href="http://www.bandcouver.com/">Radio Bandcouver</a>) posted on his Facebook that he would be attending a Wax Mannequin concert <em>that very night</em>!&nbsp; (thanks Mark)</p>
<p class="western" lang="en-GB">Ok on to the concert.&nbsp; Tea and I made our way down to <a href="http://www.patspub.ca/">Pat's Pub</a>, an usual little brew pub right in the heart of skid row (literally two blocks from scenic Main and Hastings <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_wink.gif" alt=";)" />).&nbsp; They actually have a decent brew they make right there, you can see the brewery inside.&nbsp; Their brew is only $3.75 a pint and $12.75 a pitcher (and 3 dollars Sunday - Wednesday!).&nbsp; It was actually cheaper than Canadian (and tastes a hell of a lot better <img class="middle" src="http://www.lucisferre.org/rsc/smilies/grayyes.gif" alt=":yes:" />).</p>
<p class="western" lang="en-GB">Oh right, I said on to the concert a paragraph ago... ok second try, so we got there midway through the first band which will remain nameless (in that I can't remember the name now and if I could I would forget the entire experience).&nbsp; It was basically just one guy making screechy sounds from his guitar and muffled noises into a microphone, which I can only assume were lyrics but I am unable to confirm that theory.&nbsp; The Facebook event described his style as political punk-folk music... ok&nbsp; if you say so.&nbsp; Perhaps the punk-folk guy didn't show up and the guy we saw was a last minute substitution.&nbsp; I tried to ignore the noise emanating from the stage and went up to say hi to Wax and buy all of his CDs (I never got them when I was in Kingston) including his new one.</p>
<p class="western" lang="en-GB">The second band to follow was billed as "<em>heavy metal, that is all</em>".&nbsp; Well it was definitely heavy, and loud, and noise, but as a long time fan of the genre it was not "metal" it fell more into the much wider musical categorization of <em>garbage</em> (no not garage, <strong>garbage</strong>).&nbsp; Anyway, two painful experiences out of the way it was finally time for our hero to take the stage.&nbsp; The Wax Mannequin fans were certainly out in force, a group largely made up of Vancouver's community of Ontarian refugees.&nbsp; Like myself they were extremely excited to see Wax play again.</p>
<p class="western" lang="en-GB">Wax certainly didn't disappoint&nbsp; While the years appear to have matured him a bit and he's toned down his some of his rock and roll antics (though the pain of enduring the opening acts might have done that)&nbsp; the overall package is still there.&nbsp; He played a number of crowd favourites like <em>Tell The Doctor, The Price and Animals Dance</em>.&nbsp; As well as some from his new album which I enjoyed thoroughly&nbsp; I have to express some mild disappointed he didn't play <em>Chance to Dance</em>.&nbsp; That song is a classic for Wax fans, as he likes to work up the audience into a dancing frenzy for that one.&nbsp; I can only assume he was saving it for the encore, which he didn't get since the show was going late and like many <em>sad sack NoFunCouver</em> venues Pat's Pub wanted to close up at 1:30AM...<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" /></p>
<p class="western" lang="en-GB">After the show we had just enough time to congratulate Wax on a great show and have him sign the CD we bought.&nbsp; He wrote: "My Face is Hurting" which was most likely a reference to his cover pic, where he has managed to insert his head between the strings and fretboard of his classical cutaway acoustic guitar (which I can only assume was <em>not</em> fully tuned).</p>
<p class="western" lang="en-GB">This morning was a bit rout though, my right leg rudely awoke me with sharp, dehydration related cramping (something that only happens when I drink <em>waaay</em> <em>too much</em>).&nbsp; There is probably a reason I don't go to places where the beer is that cheap any more,&nbsp; I am no longer an undergrad and it hurts like hell whenever I drink like one now (nothing a glass of Emergen-C and my morning cappuccino can't fix though).</p>
<p class="western" lang="en-GB">Thanks for coming to Vancouver, Wax and enjoy the rest of your tour.&nbsp; I can promise you the bars in Berlin won't kick you off the stage during your encore at 1:30 <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_razz.gif" alt=":p" />.</p>
<p class="western" lang="en-GB">&nbsp;</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/08/08/wax-mannequin-pat-s-pub?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Wax Mannequin @ Pat's Pub]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="f464751e-12eb-4fe0-98d4-ba9abc8703c8" />
        <category ref="38f5fc4d-2f6a-4f4d-9015-9d44ae6d607b" />
      </categories>
      <tags>
        <tag ref="music" />
      </tags>
    </post>
    <post id="a7effc05-c602-4588-92aa-2032d0f0f390" date-created="2009-08-05T05:49:00" date-modified="2010-04-06T14:39:28" approved="true" post-url="/post/2009/08/05/Strings-are-immutable-stupid!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Strings are immutable stupid!]]></title>
      <content type="text"><![CDATA[<p>Last night, I was reading through the MCTS cram guide for Application Developer (and drinking beers) and enjoying a bit of a laugh as I learned groundbreaking concepts like "value types" and "creating class" (it's not <em>all </em>that bad) when I came across this "Strings are immutable in the .NET Framework". <img class="middle" src="http://www.lucisferre.org/rsc/smilies/graybigeek.gif" alt="88|" /></p>
<p>I'm sure most people reading this (which, of course, assumes <em>anyone </em>is reading this) are either saying, "who cares, even in java strings are immutable, everyone knows this you idiot", or alternatively asking "what's an immutable?".&nbsp; To the first of you I say "fuck off,&nbsp; I skipped most of my compsci classes", to the rest of you I say "<a href="http://lmgtfy.com/?q=immutable">let me google that for you...</a>".</p>
<p>After reading that strings are immutable,  I immediately thought of some code I am working on that reads a giant ASCII CSV file about 700k lines long.&nbsp; As part of the process it reads and re-builds a CSV line character by character using nothing but "+=" assignments.&nbsp; I was horrified, as I realized that I was literally creating and assigning millions of string objects unecessarily <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_crazy.gif" alt=":crazy:" />.</p>
<p>I had done a horrible thing, but I knew how to fix it, use a StringBuilder class instead.&nbsp; Now, my morbid curiousity drove me to fire up my code in dotTrace just to see how horrible.&nbsp; Here are the results for the original method:</p>
<blockquote>18.99 % FixCSVStringQuotes - 142869 ms - 757810 calls - ISMDataAdapter.Data.ISMDataReader&lt;T&gt;.FixCSVStringQuotes(String)<br /> 17.58 % Concat - 132204 ms - 152390966 calls - System.String.Concat(Object, Object)<br /> 0.01 % ToString - 109 ms - 757810 calls - System.Char.ToString()<br /> 0.00 % Concat - 0 ms - 64 calls - System.String.Concat(String, String)<br /></blockquote>
<p>Results for StringBuilder version:</p>
<blockquote>
<p>10.00 % FixCSVStringQuotes2 - 29408 ms - 757810 calls - ISMDataAdapter.Data.ISMDataReader&lt;T&gt;.FixCSVStringQuotes2(String)<br /> 7.00 % Append - 20574 ms - 153148776 calls - System.Text.StringBuilder.Append(Char)<br /> 0.07 % StringBuilder..ctor - 194 ms - 757810 calls - System.Text.StringBuilder..ctor()<br /> 0.03 % ToString - 101 ms - 757810 calls - System.Text.StringBuilder.ToString()<br /> 0.00 % Append - 0 ms - 64 calls - System.Text.StringBuilder.Append(String)</p>
</blockquote>
<p>Total time went from 143 seconds to 29 seconds.&nbsp; Pretty significant really.&nbsp; So now I know, "strings are immutable stupid!"&nbsp; Thanks MCTS!</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/08/04/strings-are-immutable-stupid">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Strings are immutable stupid!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="csharp" />
      </tags>
    </post>
    <post id="a49a0181-95ef-4954-808c-27fad86aa3a3" date-created="2009-07-29T04:42:00" date-modified="2009-12-05T10:20:32" approved="true" post-url="/post/2009/07/29/iPhone-3GS-released-on-appeal.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[iPhone 3GS, released on appeal]]></title>
      <content type="text"><![CDATA[<p>Well I jailbroke my 3GS.  Turns out I grossly misunderstood the jailbreaking process.  The unlock I thought was a jailbreak was in fact just an unlock so that non-AT&amp;T customers could use their iPhones with other carriers.  Dev Team was waiting until the 3.1 firmware release to put out their jailbreak so they could see what Apple would do.</p>
<p>George Hotz, apparently the original iPhone hacker, came out of retirement to tell them he wasn't having any of that.  He has released a 3GS jailbreak for 3.0 firmware called <a href="http://www.purplera1n.net/">purplera1n</a>.  Please note, this is only for the 3GS as far as I know.&nbsp; Keep reading for my simple instructions on jailbreaking.</p>
<p>Anyways it is dead simple to do so rather than link you to another site for instructions here they are:</p>
<ul>
<li>Plug your iPhone into your computer</li>
<li>Download and run purlera1n from the link above</li>
<li>Click the <em>button </em>(there is only one button so <em>don't ask me which one</em>)</li>
<li>Your iPhone will reset and show a picture of some dude having a romantic walk in the rain with a giant iPhone (apparently it's Hotz)</li>
<li>After restart, start the new app you have called "<strong>freeze</strong>" it will give you again, one button to "<strong>install Cydia</strong>"</li>
<li>At this point I unplugged it from my P.C., for some reason first go round Cydia's download hung on me, anyways no big deal you can start from step one again without any trouble.</li>
<li>Once Cydia is downloaded you can start getting jailbroken apps from Cydia.&nbsp; Not all of them work on the 3GS yet so keep that in mind.</li>
</ul>
<p>This is not for everyone, if you are having some troubles with it I'd be happy to try to help you if you post a comment here, but a good place to ask is www.iphoneincanada.ca in their forums.&nbsp; They also have an entire forum dedicated to jailbreaking and the Cydia apps.</p>
<p>Good luck ;-)</p>
<p>Update: So far so good on all fronts.  I had a moment where my 3G was connected but not working, a quick restart and it was fixed.  I have VoipOver3G installed now and I can confirm it works as advertised, it is possible to make Skype calls over the 3G network (take that Rogers!).    For anyone wondering if jailbreaking is worth the hassle I have two things to say: First, it isn't much of a hassle, second, Cydia provides more apps then probably even the app store has and many which provide functionality not available on any app store app (themes for your phone would be a good example).  So, if you don't care for the hassle of 5 minutes spent jailbreaking and you are happy being limited to what Apple says you can install, then no, it isn't worth it.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/07/28/iphone-3gs-released-on-appeal?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[iPhone 3GS, released on appeal]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
      <comments>
        <comment id="c624bf81-ea04-43e4-8246-456d1360bdf3" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-25T08:02:15" date-modified="2009-07-25T08:02:15" approved="true" user-name="3GS [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: iPhone 3GS, released on appeal]]></title>
          <content type="text"><![CDATA[You went purplera1n.   Have you got an opinion on the jailbreak by iphone-dev-team?  http://blog.iphone-dev.org/<br />
<br />
I'm on Rogers and want 3G streaming like YouTube HD, Skype, and >10Mb app downloads directly<br />
<br />
Anyway - the iphone-dev one looks more complicated, but they imply its more solid than the purplera1n.<br />
<br />
Also - did you buy the Voip3G option flipper or did you locate a free one.<br />
<br />
Thanks - Another Rogers user ...]]></content>
        </comment>
        <comment id="a68614dc-4568-4c59-a3c3-208d6a771245" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-25T15:34:15" date-modified="2009-07-25T15:34:15" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: iPhone 3GS, released on appeal]]></title>
          <content type="text"><![CDATA[My understanding is that when Dev Team said they would wait for 3.1 to release a JB app, that prompted Hotz to write his own.  Shortly after that Dev Team released redsn0w for 3GS.  <br />
<br />
I've heard both are just fine, but I havn't tried redsn0w.  purplera1n initially had issues but all of them are fixed afaik. I doubt anyone would notice a difference, but Dev Team is still considered the standard.  Once it's jailbroken it is all the same.<br />
<br />
As for Voip I used VoipOver3G which is free.  Some sites claim this doesn't work with the 3GS, but that is no longer true.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="f8672f7b-7045-4a7d-aca9-275414f8ba60" date-created="2009-07-29T04:19:00" date-modified="2009-12-02T13:06:38" approved="true" post-url="/post/2009/07/29/Enterprise-Library-Validation-!3d-0.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Enterprise Library Validation != 0]]></title>
      <content type="text"><![CDATA[<p>There has to be a better way to tell Microsoft's Enterprise Library's Validators that zero is invalid...</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;">[<span style="color: #2b91af;">PropertyComparisonValidator</span>(<span style="color: #a31515;">"Zero"</span>, <span style="color: #2b91af;">ComparisonOperator</span>.NotEqual, MessageTemplate = <span style="color: #a31515;">"Entry amount should not be zero"</span>, Ruleset = <span style="color: #a31515;">"Standard"</span>)]</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">decimal</span> Amount</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span> { <span style="color: blue;">return</span> _entry.Amount; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">set</span> { <span style="color: blue;">if</span> (IsSelected &amp;&amp; <span style="color: blue;">value</span> != _entry.Amount) { _entry.Amount = <span style="color: blue;">value</span>; NotifyPropertyChanged(<span style="color: #a31515;">"Amount"</span>); } }</p>
<p style="margin: 0px; padding: 0px;">}</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">decimal</span> Zero { <span style="color: blue;">get</span> { <span style="color: blue;">return</span> 0.0M;} }</p>
</div>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/07/28/enterprise-library-validation">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Enterprise Library Validation != 0]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="csharp" />
      </tags>
    </post>
    <post id="5c695717-8e4d-40b9-bb12-5fa456276a54" date-created="2009-07-28T16:59:00" date-modified="2010-02-24T13:44:55" approved="true" post-url="/post/2009/07/28/Bungling-bundling-with-Rogers-Wireless.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Bungling bundling with Rogers Wireless]]></title>
      <content type="text"><![CDATA[<p><img style="float: left; margin: 4px;" src="/media/blogs/general/rogers_devolution_small.jpg" alt="" width="250" height="149" />Whenever possible, I avoid dealing with Rogers employees directly.  I find that, whenever I do, I have to wade through some complex sales packaging or bundling bullshit and end up with more problems than I had before I called (and usually paying them more money).</p>
<p>When I purchased my iPhone I didn't do so directly through Rogers but through a third-party contact my friend Richard uses.  He did a great job, even getting several iPhones for people I work with on the release date.</p>
<p>He was also kind enough to look over my account and noticed my wife and I were going way over our couples plan's shared minutes (read: my wife was going way over our packaged minutes) and we were getting screwed for it.  He helped me select a better plan which would cost more monthly but should cost less overall by keeping us from going over on our included minutes.  As a sort of bonus (every package has to have a <em>bonus</em>) it also included 1500 shared text messages bundled with it.</p>
<p>Now, one of the features of the iPhone that I liked is visual voice-mail (VVM).  It saves the hassle of phoning up your voice-mail and typing in a password by instead downloading the messages directly to the phone as audio files.  I really wanted this even though it was going to cost me another $8 over my minimal $12 voicemail, caller-id, etc. <em>bundle</em>.</p>
<p>Surprisingly though, when he called Rogers he was informed that I couldn't have the VVM <em>bundle </em>because the unlimited minutes in the VVM <em>bundle </em>conflict with the 1500 shared minutes <em>bundled </em>in my new couples plan.  I figured this was just due to the typical impotence of your average rogers sales person.  Nothing that a ranting, raving customer couldn't work past after making them to break down and cry and finally pass you on to someone with some power to do something sensible, so I called myself.</p>
<p>I was wrong.  After having two people explain the same obtuse concept I can only define as a <em>bundling conflict</em> I was speechless, well no I wasn't, I ranted at them.  The best option they could give me was to give up the 1500 shared messages in my <em>bundle</em> so that I could have my VVM with unlimited <em>unshared</em> messages.</p>
<p>Truthfully, I could probably resolve this by adding another $3 worth of text messages to my wife's phone.  However it feels like such a scam to me.  I told him I wasn't going to accept their "solution" to the problem.  I can live without the VVM for now.  In the meantime I am going to send at least one or two harassing e-mail or letter to Rogers.  Hopefully it will make me feel better, at least enough for me to swallow that extra $3/mo on top of everything else extra I'm paying, because, lets face it, I'm not going to change Rogers Wireless illustrious history of putting the customer last.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/07/28/bungling-bundling-with-rogers-wireless?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Bungling bundling with Rogers Wireless]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
        <category ref="2c07e59a-ca1c-4daa-8218-0cb00efde8b7" />
      </categories>
      <tags>
        <tag ref="Opinion" />
        <tag ref="iPhone" />
      </tags>
    </post>
    <post id="a9ddda11-522c-46aa-860a-38ad94d12825" date-created="2009-07-25T20:16:00" date-modified="2010-02-23T19:28:23" approved="true" post-url="/post/2009/07/25/Can-Rogers-really-prevent-VOIP-over-3G.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Can Rogers really prevent VOIP over 3G?]]></title>
      <content type="text"><![CDATA[<p>This was certainly news to me, though it isn't terribly surprising.  It turns out Rogers is blocking apps like Skype from providing VOIP (voice over IP) services over their 3G network.  Rogers already blocks the Skype app for the iPhone from being made available in the app store (though they failed to notice the other VOIP apps freely available like truphone and fring).  Nonetheless, it is a relatively <a href="http://www.iphoneincanada.ca/iphone-news/how-to-set-up-a-us-itunes-account-in-canada-round-2/">simple process</a> to get a U.S. app store account.</p>
<p>However, it turns out <a href="http://www.iphoneincanada.ca/tips-tricks/how-to-use-skype-over-3g-on-your-iphone/">you can enable Skype and other VOIP apps</a> <em>if you have a jailbroken phone</em>.</p>
<p>Recently, my friend Richard asked if I could get it to work over 3G.  I said I assumed I could but immediately got a message fro Skype telling me their service was not available over 3G do to licensing restrictions, or some such crap.</p>
<p>Honestly, I don't see this as a big loss.  I think people would be surprised at how poor the quality of VOIP is over 3G.  Even in Canada where the Rogers 3G network is significantly faster than that of AT&amp;T in the U.S. the reliability of 3G is still pretty poor compared to most wifi.  3G, while fast is a long distance wireless TCP/IP network and wireless networks are inherently bursty.  Your phone calls are carefully coded and prioritized for voice QoS (quality of service) on the network, but your 3G is not, it is just TCP packets prioritized for data.</p>
<p>Still I am curious to know how bad VOIP would be over 3G, so I guess this is another reason to go through the somewhat <a href="http://blog.iphone-dev.org/">complex process of jailbreaking my iPhone</a>.  Maybe this week I'll give it a shot</p>
<p>Update: Turns out jailbreaking is not a complex process, I was confusing it with carrier unlocking.  Check out my more recent post on the jb process.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/07/25/can-rogers-really-prevent-voip-over-3g?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Can Rogers really prevent VOIP over 3G?]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
      <comments>
        <comment id="78dd9ce9-47e9-4219-824d-3146575d42c3" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-22T12:28:50" date-modified="2009-07-22T12:28:50" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[Yes, I've already tried it out, works great.  Actually the link in this post was supposed to go to an article on VoipOver3g but something was going wrong with the blog editor that day.]]></content>
        </comment>
        <comment id="57a2c2ca-cbd9-4f96-90fc-ebda0ce44f80" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-22T15:25:00" date-modified="2009-07-22T15:25:00" approved="true" user-name="slvnkn [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[Hey,<br />
<br />
Just wanted to let you know that you can use Skype over 3G.  Since it seems that you have jailbroken your phone, look for an app on Cydia called "VoIPover3G"  and make sure you have the lastest mobileSubstrate installed.   <br />
<br />
I currently have Skype over 3G working on my iPhone on the Rogers network.]]></content>
        </comment>
        <comment id="1ff313e2-5510-40fc-8c19-54039ccec321" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-02-26T07:31:41" date-modified="2010-02-26T07:31:41" approved="true" user-name="4r4nd0mninj4" user-email="warren.sheele@gmail.com" user-ip="24.108.136.141" user-url="http://www.4r4nd0mninj4.ca/">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[I just tested VoIP using a freephoneline.ca account on my laptop while tethered to my HTC Magic. Now this was under ideal conditions (line of sight to the tower) but the voice quality was surprisingly better than a cellular call! No echo, lag, or distortion what so ever. I am going to get the SIP settings from the company and try to get it working on sipdroid today. I'll post an update on my website when I get things worked out.]]></content>
        </comment>
        <comment id="307b640c-70d2-400d-bbe2-7d9eb9ffbac8" parentid="1ff313e2-5510-40fc-8c19-54039ccec321" date-created="2010-03-12T21:24:39" date-modified="2010-03-12T21:24:39" approved="true" user-name="Kevin G" user-email="sfcomputers@gmail.com" user-ip="69.171.129.110" user-url="">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[any news on getting freephone to work with your htc?  in same boat here and trying to set up. I have my sip setting and an htc dream ]]></content>
        </comment>
        <comment id="03404cc5-a55d-4ea3-b1ca-63ddb1e71f51" parentid="307b640c-70d2-400d-bbe2-7d9eb9ffbac8" date-created="2010-03-12T21:47:52" date-modified="2010-03-12T21:47:52" approved="true" user-name="4r4nd0mninj4" user-email="warren.sheele@gmail.com" user-ip="96.50.82.155" user-url="http://www.4r4nd0mninj4.ca/">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[I tested Freephoneline.ca and found that because freephoneline uses an access number in order to call not-in-plan long distance numbers, I am not inclined to keep the service as I would have to program in all non-in-plan numbers with that access number and a pause first. I have been working with Acanac.ca and they give me a local number and cross Canada calling for as low as $10 a month. You can find this under my Projects link on my website. As far as setting up sipdroid, I had to make an account with pbxes.org and then enter the sip settings there. I'm going to try to make a &quot;how to&quot; for that latter, but as I'm just starting exam week it may take me a while to get around to it. Shoot me an email from my site and I'll try to answer your questions there.]]></content>
        </comment>
        <comment id="7b2a2e93-1666-4918-9bbc-5f0b6ecf11d2" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-29T11:50:37" date-modified="2010-03-29T11:50:37" approved="true" user-name="Ryan" user-email="rc@weal.ca" user-ip="24.85.32.165" user-url="">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[In my experience the 3G / HSPA Rogers network it not suitable for VOIP calls.  I configured my Symbian (Nokia E71) to use my account with Inphonex and the quality is poor due to the &quot;bursting&quot; of packets - no steady stream for the calls unfortunately.  I'm in Vancouver.  Post-olympics I can stay logged in on the voip network (it was too busy during the games) but it is not usable.]]></content>
        </comment>
        <comment id="5be1b32e-3a8e-4d94-a4a1-f30e2d6254f5" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-29T12:01:03" date-modified="2010-03-29T12:01:03" approved="true" user-name="4r4nd0mninj4" user-email="warren.sheele@gmail.com" user-ip="24.108.136.141" user-url="http://www.4r4nd0mninj4.ca/">
          <title type="text"><![CDATA[re: Can Rogers really prevent VOIP over 3G?]]></title>
          <content type="text"><![CDATA[Hey Ryan,
I'm in Victoria, and it seems to be working okay for me here. I do need a good strong signal though for clear calling. As long as I have full or nearly full bars I have had good calls. Are you useing TCP or UDP for your calling?]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="a11c01f0-963d-4bd8-a500-da9afc5a9002" date-created="2009-07-24T21:48:00" date-modified="2009-10-05T09:35:51" approved="true" post-url="/post/2009/07/24/Yielding-to-enumeration-in-csharp.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Yielding to enumeration in csharp]]></title>
      <content type="text"><![CDATA[<p>I just discovered the <code>yield </code>keyword and I can't believe I hadn't found it sooner.  I became a huge fan of using LINQ from the moment I started using it and I am in the habit of passing and returning IEnumerable whenever possible.</p>
<p>Recently I had a problem where I was reading the lines of a CSV file using this code:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">var</span> csvdata = <span style="color: #2b91af;">File</span>.ReadAllLines(filename);</p>
</div>
<p>That seemed to work fine, but for some mysterious reason (that I still am uncertain of) it had problems reading the CSV file cleanly from a networked drive for some users.  I have no idea why but I wanted to use something a bit more transparent.</p>
<p>A bit of googling turned up a <a href="http://stackoverflow.com/questions/286533/filestream-streamreader-problem-in-c">solution </a>that used a keyword I had never seen before:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: #2b91af;">IEnumerable</span>&lt;<span style="color: blue;">string</span>&gt; ReadLines(<span style="color: blue;">string</span> path)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">using</span> (<span style="color: #2b91af;">StreamReader</span> reader = <span style="color: blue;">new</span> <span style="color: #2b91af;">StreamReader</span>(<span style="color: blue;">new</span> <span style="color: #2b91af;">FileStream</span>(path, <span style="color: #2b91af;">FileMode</span>.Open)))</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> line;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">while</span> ((line = reader.ReadLine()) != <span style="color: blue;">null</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">yield</span> <span style="color: blue;">return</span> line;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>I marveled at this <code>yield </code>keyword, it allows a method to return a result as <code>IEnumerable</code>, with delayed evaluation (each item in the result set is only returned when it is asked for) without having to implement a new <code>IEnumerable </code>class.</p>
<p>Anyways, nothing groundbreaking, but a pretty handy tool nonetheless.  Its been a while since I posted anything and I figured this was as good as anything else I've been thinking of posting, but nice and simple.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/07/24/yielding-to-enumeration-in-csharp">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Yielding to enumeration in csharp]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <tags>
        <tag ref="csharp" />
      </tags>
    </post>
    <post id="1080156f-9d28-4ae5-9201-4d61a8dbdacf" date-created="2009-07-14T02:58:00" date-modified="2009-10-05T09:35:38" approved="true" post-url="/post/2009/07/14/Implementing-a-custom-ID-generator-for-nHibernate.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Implementing a custom ID generator for nHibernate]]></title>
      <content type="text"><![CDATA[<p>Currently I am doing some work developing a utility that imports securities data into a fairly old legacy database.  It is still SQL but the database and software havn't been updated in about 15 years (maybe more) and never will be again.</p>
<p>The original application for this database uses a primitive hilo-style ID generator mechanism.  Tt simply queries an integer value from a table in the database and increments it,  then it adds a fixed value to it and uses that as the next unique ID.  It doesn't seem very optimal, but that's how it works and there's no changing it.</p>
<p>It isn't complex, but it also isn't one of the identity strategies available in nHibernate and I fully intend to use nHibernate.</p>
<p>So what to do?  One option would be to set <code>generator="assigned"</code> and do it all myself, assigning the ID using <code>ADO.Net </code>directly or something similar... but what fun would that be?  No, I've decided to take a peak at the nHibernate code and learn to extend it.  Read on to find out how to create a custom class that inherits from <code>IIdentifierGenerator </code>to implement your own custom ID generator strategy for nHibernate.</p>
<p>One of the beautiful things about nHibernate the ability to extend it.  You can extend its functionality without ever touching their source code.</p>
<p>It was very easy to locate the classes responsible for ID generation in the <code>NHibernate.ID </code>namespace.  It was also clear immediately that most classes inherited from <code>IIdentifierGenerator</code>.  I also knew that my strategy was similar to the procedure that hilo implements so I started with <code>TableHiLoGenerator </code>which inherts from <code>TableGenerator</code>.</p>
<p>After playing around with this for a while and trying different things, it was clear that <code>TableGenerator</code>, basically takes a <code>tablename </code>and <code>columnname </code>from the configuration, reads a value, increments it and passes it on as an ID.  Voila!  That was almost exactly what I needed to do with little else to change.  I was quickly able to create my own class inheriting from TableGenerator</p>
<div style="margin: 5px; padding: 5px; background: white none repeat scroll 0% 0%; font-family: Courier New; font-size: 8pt; color: black; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">FDPSequence</span> : <span style="color: #2b91af;">TableGenerator</span></p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">const</span> <span style="color: #2b91af;">Int32</span> SeedValue = 1048576;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">readonly</span> <span style="color: #2b91af;">ILog</span> Log = <span style="color: #2b91af;">LogManager</span>.GetLogger(<span style="color: blue;">typeof</span>(<span style="color: #2b91af;">FDPSequence</span>));</p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: blue;">override</span> <span style="color: blue;">object</span> Generate(<span style="color: #2b91af;">ISessionImplementor</span> session, <span style="color: blue;">object</span> obj)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> counter = <span style="color: #2b91af;">Convert</span>.ToInt32(<span style="color: blue;">base</span>.Generate(session, obj));</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> counter + SeedValue + 1;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>Not much to that is there?  Now that is a fairly simple case, but even getting more complex isn't much harder than that.  You can implement <code>IIdentifierGenerator </code>directly and create something far more customized.  TableGenerator actually implements <code>IPersistentIdentifierGenerator </code>which is an interface for identifiers which need to write and updated value to the database.  However, since nHibernate provides so many versatile and inheritable base class generators that you will likely get by with inheriting one of those and extending it as I did.</p>
<p>In order to use this custom generator class I setup my configuration to use it.  Using Fluent I wrote a mapping like this:</p>
<div style="margin: 5px; padding: 5px; background: white none repeat scroll 0% 0%; font-family: Courier New; font-size: 8pt; color: black; -moz-background-clip: border; -moz-background-origin: padding; -moz-background-inline-policy: continuous;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> <span style="color: #2b91af;">InvestSpecMap</span> : <span style="color: #2b91af;">FDPEntityBaseMap</span>&lt;<span style="color: #2b91af;">InvestSpec</span>&gt;</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> InvestSpecMap()</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; WithTable(<span style="color: #a31515;">"InvestSpec"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Id(x =&gt; x.Id).ColumnName(tablename + <span style="color: #a31515;">"ID"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .SetGeneratorClass(<span style="color: blue;">typeof</span>(FDPGenerator.<span style="color: #2b91af;">FDPSequence</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .AddGeneratorParam(<span style="color: #a31515;">"table"</span>, <span style="color: #a31515;">"zSysCounters"</span>) <span style="color: green;">//Name of the ID counter table</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .AddGeneratorParam(<span style="color: #a31515;">"column"</span>, <span style="color: #a31515;">"InvestSpec"</span>); <span style="color: green;">//ID counter column for this table</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.AnnualDividend).ColumnName(<span style="color: #a31515;">"AnnlzdDiv"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.AssetClass);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.CurrencyType);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.CusipNumber).ColumnName(<span style="color: #a31515;">"CusipNum"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.DividendFreq).ColumnName(<span style="color: #a31515;">&amp;quot<img class="middle" src="http://www.lucisferre.org/rsc/smilies/graysmilewinkgrin.gif" alt=";D" />ivFrequency"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.FullName);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.MaturityDate).ColumnName(<span style="color: #a31515;">"MaturityDt"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.PriceAsOf).ColumnName(<span style="color: #a31515;">"PriceAsOfDt"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.ShortName).ColumnName(<span style="color: #a31515;">"AbbrName"</span>);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.TaxTreatment);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.TickerSymbol);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.Type);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Map(x =&gt; x.UnitPrice);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>You can do the same with XML mappings just declare the assembly and class as you usually would in XML.  This is actually the first time I've used FluentNH.</p>
<p>What is great about this is that even when testing my mappings with SQLLite, <code>SchemaExport </code>is actually able to create the identity table based on the tablename and columnname properties in the nHibernate configuration.  The main benefit here however is that identity generation remains transparent to the rest of my application.  Also doing something cool with nHibernate, that's priceless of course</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/07/13/implementing-a-custom-id-generator-for-nhibernate-1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Implementing a custom ID generator for nHibernate]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
      </tags>
    </post>
    <post id="51959c07-e9e7-4bdc-bad7-7e3e0118839a" date-created="2009-07-06T19:55:00" date-modified="2009-10-05T09:35:20" approved="true" post-url="/post/2009/07/06/iPhone-3GS-jailbreak-available.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[iPhone 3GS jailbreak available]]></title>
      <content type="text"><![CDATA[<p><a href="http://blog.iphone-dev.org/">http://blog.iphone-dev.org/</a></p>
<p>I know I said I would post as soon as this was available, but I have a) been really busy and b) the jailbreak seems a bit involved and I wanted to try it before I blogged about it.  As it stands, I still have not tried it out.</p>
<p>I do know it involves first getting some hardware data from your iPhone by performing a little backup/restore hack and grabbing some temporary files it creates.  This data is critical to being able to jailbreak your iPhone in the future.  Apple will likely close this loophole by changing this data in an update, having the original data will allow you to avoid getting screwed.  The Dev-Team guys say that if you ever want to be able to jailbreak the 3GS you need this data before you update to 3.1.</p>
<p>However, it is likely they will figure out a new hack no matter what Apple does, it is just that some iPhone owners in the U.S. rely on jailbreaks to use their phone at all because they use it with carriers other than AT&amp;T.  If they get screwed they get no phone service.</p>
<p>Anyways I am going to try to get a look at it this weekend but for those brave enough the instructions are linked in the <a href="http://blog.iphone-dev.org/">dev-team blog</a> so you can try it yourself.  However if all you want is Skype or other apps only available in the U.S. <a href="http://tungchingkai.blogspot.com/2008/12/create-us-itunes-account-without-credit.html">there are easier ways</a> (n.b., you may have to wait as long as 24-hours for the confirmation e-mail, just be patient).</p>
<p>Update: As I have noted in my more recent blog on jailbreaking I am incorrect here.&nbsp; This is for the carrier unlock, <em>not the jailbreak. </em>Sorry if anyone was misled :-(</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/07/06/iphone-3gs-jailbreak-available?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[iPhone 3GS jailbreak available]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
    </post>
    <post id="0de8e009-e89f-482c-a7fa-615336f89ff3" date-created="2009-07-06T19:42:00" date-modified="2009-12-02T13:07:04" approved="true" post-url="/post/2009/07/06/Dont-repeat-yourself.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Don't repeat yourself]]></title>
      <content type="text"><![CDATA[<p>As one of the many things on my list of "stuff to read" from DevTeach is <a href="http://www.amazon.ca/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code</a> by Robert C. Martin.  It is an outstanding book that really nails the concept of writing clean, effective and efficient code.&nbsp; While it is in Java the principles apply to just about any language, particularly C# because the syntax, like Java, is very C/C++-like.</p>
<p>I am finding it invaluable so far, however today I read one example today that just looked awkward to me.&nbsp; Martin starts by factoring some really ugly code into something much more elegant which you see below:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> delete(Page page)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; deletePage(page);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; registry.deleteReference(page.name);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; configKeys.deleteKey(page.name.makeKey());</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">catch</span> (<span style="color: #2b91af;">Exception</span> ex)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; logger.log(ex.Message);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>That looks pretty good to me, in fact I have many functions that look like that.  Then he goes on to say that try/catch blocks are actually ugly so we should extract the bodies into functions of their own.  The result looks like this:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> delete(Page page)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; deletePageAndAllReferences(page);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">catch</span> (<span style="color: #2b91af;">Exception</span> ex)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; logError(ex);</p>
<p style="margin: 0px; padding: 0px;">}</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> deletePageAndAllReferences(Page page)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; deletePage(page);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; registry.deleteReference(page.name);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; configKeys.deleteKey(page.name.makeKey());</p>
<p style="margin: 0px; padding: 0px;">}</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">public</span> <span style="color: blue;">void</span> logError(<span style="color: #2b91af;">Exception</span> ex)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; logger.log(ex.Message)</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>I will admit that it does probably make sense to factor out the try block here and it looks fine to me, but the function logError(e) seems like redundancy to me.  It seems to violate the principle espoused on the very next page of the book <em>"Don't Repeat Yourself"</em>.</p>
<p>"Don't repeat yourself", as he defines it there, really refers to repeating code, but I have heard many developers use it as a reason to avoid other things, such as redundant comments (if your code clearly explains what it is doing, which it should, why do you have a comment explaining it again?).  To me this is a redundant method.&nbsp; logger.log(ex.Message) says exactly the same thing to me as logError(ex).</p>
<p>I am probably nit-picking though.&nbsp; Realistically, the author probably expects you will have more complex error handling than just logError(ex), so you will have a class that provides error handling methods including logging and it will likely include a logError() function, or perhaps a notifyUserAndLogError() which notifies the user through the UI and logs it.&nbsp; Regardless, taken as-written the refactoring of logger.log() feels unneeded to me.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/07/06/don-t-repeat-yourself">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Don't repeat yourself]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="agile" />
        <tag ref="SOLID" />
      </tags>
    </post>
    <post id="ef779300-206b-4582-a9d0-4275b328c8c9" date-created="2009-07-01T00:50:00" date-modified="2010-02-24T13:44:55" approved="true" post-url="/post/2009/07/01/Add-an-index-to-many-to-one-relationships-in-nHibernate.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Add an index to many-to-one relationships in nHibernate]]></title>
      <content type="text"><![CDATA[<p>I spent some time today creating some de-normalized views of my database for reporting.  It isn't a big project so I've chosen to use SQL Views and SSRS reports for some of the reporting that is required.  The main entities I am querying form a three level hierarchy and when I query the leaf nodes I often want to filter on data at the root node.</p>
<p>Well, for some reason, these views were unbelievably slow to run.  It turns out that the only index I had on any table was on the surrogate primary keys.  In essence, the table was indexed by a column I did't really care much about, what I do care about is the foreign key relationship between the parent and child.  The quick fix for this is to put an index on the foreign key column.  I could easily add that directly to the database, but I wanted to make sure I could keep using SchemaExport for updating my database scheme when my mapping files change.</p>
<p>In your nHibernate mapping files you can set a non-clustered index on any property by using nHibernate's index option.  For the many-to-one side of my relationships I added:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">&lt;</span><span style="color: #a31515;">many-to-one</span><span style="color: blue;"> </span><span style="color: red;">name</span><span style="color: blue;">=</span>"<span style="color: blue;">Entry</span>"<span style="color: blue;"> </span><span style="color: red;">index</span><span style="color: blue;">=</span>"<span style="color: blue;">entry_index</span>"...<span style="color: blue;"> </span></p>
</div>
<p>You can give the index any name you wish.  Performance of my views shot up considerably after adding this.  Parent-child queries within nHibernate will also benefit.  A clustered index would probably make sense here, however that is not an option I am aware of in the nHibernate mapping files.  I would have to set that directly on the database which means I can't use tools like SchemaExport.</p>]]></content>
      <post-name type="text"><![CDATA[Add an index to many-to-one relationships in nHibernate]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
      </tags>
    </post>
    <post id="014de17f-f375-4746-8bd9-34b28a6d6bdd" date-created="2009-06-26T16:18:00" date-modified="2009-10-05T09:34:49" approved="true" post-url="/post/2009/06/26/iPhone-3GS-jailbreak-is-coming-soon.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[iPhone 3GS jailbreak is coming soon]]></title>
      <content type="text"><![CDATA[<p><a href="http://blog.iphone-dev.org/">http://blog.iphone-dev.org/</a></p>
<p>The "<a href="http://blog.iphone-dev.org/">Dev Team</a>", the <em>shady group of techies</em> who have made a hobby out of cracking whatever Apple comes out with to protect the iPhone, have announced they have discovered the hardware exploit needed to create a working jailbreak app for the 3GS phones. &nbsp;I should say re-discovered as apparently it is the same exploit that works for the iPod Touch 2G.</p>
<p>Anyways there still isn't anything available to jailbreak the phone yet, but it should be <em>very soon.</em></p>
<p>I took a quick look at their "<a href="http://iphwn.org/24kpwnliveson.txt">notes</a>" reminds me a little bit of the assembler code from the Motorola chips we used to play with in EE labs. &nbsp;I couldn't tell you what the hell it means though, but iirc CMP - compare, ADD - addition, SUB - subtract, but those are kinda obvious&nbsp;<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_cool.gif" alt="B)" />.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/26/iphone-3gs-jailbreak-and-unlock-is-comming-soon?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[iPhone 3GS jailbreak is coming soon]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
    </post>
    <post id="c9a5592a-7661-4c0a-be1f-eeb5f4cdc6e2" date-created="2009-06-23T18:07:00" date-modified="2009-10-05T09:34:17" approved="true" post-url="/post/2009/06/23/Making-iPhone-ringtunes-quickly-and-painlessly.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Making iPhone ringtunes quickly and painlessly]]></title>
      <content type="text"><![CDATA[<p><a href="http://reviews.cnet.com/tips-tricks/make-your-own-iphone/9602-12576_7-0.html?messageID=2510972">http://reviews.cnet.com/tips-tricks/make-your-own-iphone/9602-12576_7-0.html?messageID=2510972</a></p>
<p>Some of you may have noticed you can't use iTunes to make ringtunes from songs that you didn't purchase through iTunes. Well you are in luck, <a href="http://reviews.cnet.com/tips-tricks/make-your-own-iphone/9602-12576_7-0.html?messageID=2510972">this little article</a> has <em>extremely </em>easy to follow instructions on how to make custom ringtunes from <em>any</em> of your songs (itunes DRM or not) using only iTunes.&nbsp; It really couldn't be easier (well obviously it could be, iTunes could let you make the ringtunes directly&nbsp;<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" />).</p>
<p>Honestly, I will never get Apple's attitude towards its customers.&nbsp; If it is gonna be this easy anyways why prevent people from right-clicking on any song and making it a ringtune? Sometimes it seems like Apple's mission statement is: "rip off the lazy and stupid".</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/23/making-iphone-ringtunes-quickly-and-painlessly?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Making iPhone ringtunes quickly and painlessly]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
    </post>
    <post id="1c7c014d-bd43-4512-a1d6-5b1af94351c9" date-created="2009-06-22T21:07:00" date-modified="2010-03-20T13:53:15" approved="true" post-url="/post/2009/06/22/My-new-iPhone-3G-sport-and-some-app-store-recommendations.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[My new iPhone 3G "sport" and some app store recommendations]]></title>
      <content type="text"><![CDATA[<p>So i finally got an iPhone.&nbsp; Look it was a long drawn out decision and I still debate whether a Blackberry would have been better.&nbsp; What I'd actually like is probably an Android but it seems like it could be a while before a decent Android handset comes to market let alone is available in Canada and the iPhone still probably has the larger selection of applications (lets face facts market share rules).</p>
<p>So iPhone&nbsp; it is.&nbsp; I am no Apple fanboi but I will say it is a pretty versatile and well designed device overall.&nbsp; I personally can't wait until I can jailbreak the thing and make it even <em>more</em> versatile.&nbsp; I am thinking SSH client, remote VNC/RDP to my other computers, all sorts of stupid geek tools.&nbsp; Until then I have to make due with the selection of apps available in the app store.</p>
<p>&nbsp;</p>
<p>Personally, I hate the app store.&nbsp; It seems to just encourage adware companies which typically make two versions of every little conceivable app.  Most of the free ones come with annoying ads or crippling limitations and the paid ones where you pay as much as $10 for an app just let you do something on your iPhone that a dozen free programs can let you do on a PC (e.g. RDP and VNC clients).&nbsp; Not that I am not willing to pay for good software, but I am not willing to pay for commonplace functionality just because it is on an iPhone.&nbsp; But I digress, there are still some amazing apps <em>for free</em> in the app store:</p>
<p>&nbsp;</p>
<ul>
<li><strong>Shazam</strong>:&nbsp; You've all probably seen the commercials showing this one.&nbsp; It listens to a song that is playing nearby and tells you what it is.&nbsp; This thing is near flawless.&nbsp; If you have not tried it you absolutely must!</li>
<li><strong>TweetDeck</strong>:&nbsp; The newest, if not the best twitter client for the iPhone and the desktop.&nbsp; On the desktop it is easily the most powerful twitter client with multiple groups and columns, on the iphone it doesn't have the greatest interface but it is the <em>only</em> free twitter app that does not have ads all over it, so I say use it!</li>
<li><strong>Facebook</strong>: Nothing really needs to be said here.</li>
<li><strong>WeatherEye</strong>: Much better than the Yahoo weather app with data from The Weather Network</li>
<li><strong>CanPages</strong>: Best 411 app for Canada.&nbsp; Voice recognition search without even making a phone call.&nbsp; A number of other features like reverse lookup and traffic cams</li>
<li><strong>Translink</strong>:&nbsp; Obviously only for Vancouver, but an awesome app if you need to take transit in Vancouver.&nbsp; Can find stops near you using GPS and tell you when the bus is coming</li>
<li><strong>Stanza</strong>: Since the Kindle for iPhone app is not available in Canada (thanks Rogers...) this is the only decent eReader.&nbsp; The company was actually bought by Amazon so hopefully you will be able to buy books through Amazon soon.</li>
<li><strong>RK_Free</strong>:&nbsp; A GPS Running application.&nbsp; Will track your route and other statistics on your run.&nbsp; I actually have a nike+ but I will probably never use it now.</li>
<li><strong>Epicurious</strong>:&nbsp; A great recipe application</li>
<li><strong>Google Earth</strong>: A really cool way to look up where you are, but largely a redundant map application</li>
<li><strong>Truephone and Fring</strong>: Since you can't get Skype for iPhone in Canada (again, thanks a lot Rogers...)</li>
</ul>
<p>I find it amusing that Rogers is too ignorant to realize how ubiquitous VOIP apps have become.  You can't get Skype but you can still download one of these two for free and make VOIP calls using either a Skype account or some other VOIP system (I can't remember the name now).&nbsp; I have tried this with Skype already and I can guarantee it works.&nbsp; Enjoy cheap long distance and sticking it to Rogers!&nbsp; Of course if you jailbreak your phone you can just install the regular Skype app, or you can follow one of the many blogs online on how to setup an American app store account.</p>
<p>I am <em>not</em> posting this from my iPhone yet.&nbsp; I couldn't find a decent free bloggin tool that works with b2evo and iBlogger is $10!!! (yeah I'm cheap) Anyways, I doubt I would want to type much in a blog post from an iPhone, even with the landscape keyboard typing isn't exactly 100WPM.</p>
<p>Edit: Well I got to try out RK_Free for a run yesterday and I can say that it is fraking awesome!&nbsp; It even tells me my average speed as I run.&nbsp; Sure it is only as accurate as GPS allows, but seeing the uploaded results for distance, speed and altitude (yes altitude) are awesome pants.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/22/my-new-iphone-3g-sport-and-some-app-store-recommendations?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[My new iPhone 3G "sport" and some app store recommendations]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="cf1f8747-baf3-4952-8d1a-659dfad1e794" />
      </categories>
      <tags>
        <tag ref="iPhone" />
      </tags>
    </post>
    <post id="50df318f-1ff8-4cb4-8ef1-2610619451ed" date-created="2009-06-18T22:29:00" date-modified="2009-10-05T09:33:54" approved="true" post-url="/post/2009/06/18/Custom-HttpModules-and-AJAX-errors.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Custom HttpModules and AJAX errors]]></title>
      <content type="text"><![CDATA[<p>Seems like all I do lately is fix other people's GA plugins.  This one is really handy though.  It creates a plugable HttpModule to insert the GA script on all your ASPX pages.  I found the original post <a href="http://weblogs.asp.net/cazzu/archive/2006/06/08/instantgoogleanalytics.aspx">here</a>:</p>
<p>First thing I noticed was the google script is out of date which was easy enough to fix.  More recently. I found out it also doesn't play nice with things like AJAX which apparently trigger HttpApplication.BeginRequest a whole lot.  I received <a href="http://forums.asp.net/t/1243449.aspx">this</a> error on one of my pages that uses AJAX.</p>
<p>Unfortunately, the suggested solutions are many fold, most likely because the causes of that particular error are many fold.  In my case it was the HttpModule.  The thing is, I couldn't just turn it off, my client likes the GA statistics as much as I do <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_biggrin.gif" alt=":D" />.</p>
<p>To fix this all you need to do is make sure the module logic is <em>only </em>fired if the source of event is an .aspx page.  The relevant code looks like this:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">void</span> OnBeginRequest(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">EventArgs</span> e)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: green;">//only if the request comes from an .aspx page</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (<span style="color: #2b91af;">HttpContext</span>.Current.Request.Path.ToLower().IndexOf(<span style="color: #a31515;">".aspx"</span>) &gt; -1)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; application.Response.Filter = <span style="color: blue;">new</span> <span style="color: #2b91af;">AnalyticsStream</span>(application.Response.Filter, accountNumber);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>This like will solve similar problems with other IHttpModule implementations out there too.</p>
<p>You can get the source for the fixed Clarius.GoogleAnalytics module here:</p>
<p><a href="http://www.lucisferre.org/media/blogs/coding/GoogleAnalytics.zip">GoogleAnalytics.zip</a></p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/06/18/custom-httpmodules-and-ajax-errors">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Custom HttpModules and AJAX errors]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="ASP.NET" />
      </tags>
    </post>
    <post id="85fe8717-6999-4485-a840-620ab0a2b917" date-created="2009-06-18T15:48:00" date-modified="2010-09-10T09:15:58" approved="true" post-url="/post/2009/06/18/Speed-up-nHibernate-startup-with-object-serialization.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Speed up nHibernate startup with object serialization]]></title>
      <content type="text"><![CDATA[<p><strong>Edit:</strong> <a href="http://www.tunatoksoz.com/">Tuna</a> pointed out to me that <a href="http://nhforge.org/blogs/nhibernate/archive/2009/03/13/an-improvement-on-sessionfactory-initialization.aspx">his solution</a> is not, in fact, Castle specific and it clearly isn't I really don't know what I was smoking back then.&nbsp; Also I noticed that somewhere in my code I am getting the assInfo from ass.Location so my code is also not age appropriate.&nbsp; So for the sake of the children, definitely feel free to <a href="http://nhforge.org/blogs/nhibernate/archive/2009/03/13/an-improvement-on-sessionfactory-initialization.aspx">check out Tuna's post</a> on nhForge.</p>
<p>This is gonna be a good one.&nbsp; I spent some time yesterday trying to speed up my applications start time.&nbsp; I knew from reading a few other blogs that nHibernate is often the culprit due to the time it takes to process XML configuration files and then create the SessionFactory.&nbsp; However, a discussion in nhusers mentioned using serialization of the Configuration object after it has loaded the XML files to speed this up in subsequent startups.</p>
<p>One of the reasons nhibernate can take a while to start up is that it is validating each XML configuration file individually.&nbsp; If you are like me (an anyone else who follows best practices) you have seperated you hbm.xml files into one-per-entity.&nbsp; Unfortunately that likely means that the more entities you have the longer nhibernate will take to create the Configuration object.&nbsp; This is not a good thing.&nbsp; You could try just having one hbm, but that is also not a good thing.&nbsp; Persisting your Configuration after the first time you create it seems to be the best solution available.</p>
<p>It would be nice if persisting the Configuration using serialization was part of nHibernate, but as of yet I don't believe it is so you have to "roll your own" which isn't all that hard.&nbsp; You can read a bit more on it <a href="http://nhforge.org/blogs/nhibernate/archive/2009/03/13/an-improvement-on-sessionfactory-initialization.aspx">here</a>, however that is specific to the Castle project <strong>(note: I am an idiot and Tuna's post is not Castle specific at all...)</strong> and not much use to people who are not using Castle.&nbsp; Still it didn't seem that hard, create the configuration, save it to a file using BinaryFormatter and the load it the next time the program starts.&nbsp; It took me a little bit to figure it out, but the results were dramatic.&nbsp; On my development machine a 4-5s start time became &lt;2s.&nbsp; For one of my users a 20second start time becamee 5s.</p>
<p>I use a Singleton object to setup the Configuration, SessionFactory and provide Session objects.&nbsp; It has a Property for Configuration:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">public</span> <span style="color: #2b91af;">Configuration</span> Configuration</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">get</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (_configuration == <span style="color: blue;">null</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: green;">//Check for previously serialized configuration</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (<span style="color: #2b91af;">File</span>.Exists(ConfigFile) &amp;&amp; IsConfigurationFileValid())</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _configuration = LoadConfigurationFromFile();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (_configuration != <span style="color: blue;">null</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _sessionFactory = _configuration.BuildSessionFactory();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> _configuration;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _configuration = <span style="color: blue;">new</span> <span style="color: #2b91af;">Configuration</span>()</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .SetProperty(<span style="color: #2b91af;">Environment</span>.Dialect, <span style="color: blue;">typeof</span> (<span style="color: #2b91af;">MsSql2005Dialect</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .SetProperty(<span style="color: #2b91af;">Environment</span>.ConnectionDriver, <span style="color: blue;">typeof</span> (<span style="color: #2b91af;">SqlClientDriver</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .SetProperty(<span style="color: #2b91af;">Environment</span>.ConnectionString,</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #a31515;">"Server=10.10.0.185;initial catalog=Accounting_Test;Integrated Security=SSPI"</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .SetProperty(<span style="color: #2b91af;">Environment</span>.ProxyFactoryFactoryClass,</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">typeof</span> (<span style="color: #2b91af;">ProxyFactoryFactory</span>).AssemblyQualifiedName)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; .AddAssembly(<span style="color: #2b91af;">Assembly</span>.Load(<span style="color: #a31515;">"AccountingManager.Data"</span>));</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#if</span> DEBUG</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _configuration.SetProperty(<span style="color: #2b91af;">Environment</span>.ShowSql, <span style="color: #a31515;">"true"</span>);</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#endif</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; SaveConfigurationToFile();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; _sessionFactory = _configuration.BuildSessionFactory();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> _configuration;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>A few things to notice.&nbsp; First, I only persist the configuration in the Release version of my software.&nbsp; I see no reason to worry about startup time if I am debugging.&nbsp; I have set the filename as a constant but you can set the filename however you want.&nbsp; Now I also have logic to tell the program when it needs to create the configuration from scratch and when it doesn't in IsConfigurationFileValid():</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">private</span> <span style="color: #2b91af;">Boolean</span> IsConfigurationFileValid()</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> ass = <span style="color: #2b91af;">Assembly</span>.GetCallingAssembly();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (ass.Location == <span style="color: blue;">null</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">false</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> configInfo = <span style="color: blue;">new</span> <span style="color: #2b91af;">FileInfo</span>(ConfigFile);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> assInfo = <span style="color: blue;">new</span> <span style="color: #2b91af;">FileInfo</span>(ass.Location);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (configInfo.LastWriteTime &lt; assInfo.LastWriteTime)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">false</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">true</span>;</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<p>All this method really does is return false if the calling assembly (which contains my hbms) is newer than the saved configuration file.  If a more recently compiled version of the assembly is present I assume the configuration is out of date and tell the program to create a new configuration and overwrite the old one.  So every time a publish a new version the first start up will be slower but subsequent startups will use the saved configuration.</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: blue;">void</span> SaveConfigurationToFile()</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#if</span> DEBUG</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span>;</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#endif</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> file = <span style="color: #2b91af;">File</span>.Open(ConfigFile, <span style="color: #2b91af;">FileMode</span>.Create);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> bf = <span style="color: blue;">new</span> <span style="color: #2b91af;">BinaryFormatter</span>();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; bf.Serialize(file, _configuration);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; file.Close();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">private</span> <span style="color: blue;">static</span> <span style="color: #2b91af;">Configuration</span> LoadConfigurationFromFile()</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#if</span> DEBUG</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">null</span>;</p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">#endif</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">try</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> file = <span style="color: #2b91af;">File</span>.Open(ConfigFile, <span style="color: #2b91af;">FileMode</span>.Open);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> bf = <span style="color: blue;">new</span> <span style="color: #2b91af;">BinaryFormatter</span>();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> config = bf.Deserialize(file) <span style="color: blue;">as</span> <span style="color: #2b91af;">Configuration</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; file.Close();</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> config;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">catch</span> (<span style="color: #2b91af;">Exception</span>)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">return</span> <span style="color: blue;">null</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p>
</div>
<p>Again we see that I do not use this code if we are debugging.&nbsp; I always want to create a new configuration for that.</p>
<p>All in all a very simple, though perhaps not elegant, solution that you can use if you are not using Castle.&nbsp; If you are using Castle then I suggest using the methods it provides for this as mentioned  <a href="http://nhforge.org/blogs/nhibernate/archive/2009/03/13/an-improvement-on-sessionfactory-initialization.aspx">here</a>.</p>
<p>-Chris</p>
<p>&nbsp;</p>]]></content>
      <post-name type="text"><![CDATA[Speed up nHibernate startup with object serialization]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
      </tags>
      <comments>
        <comment id="d1b67dd8-6c90-44b2-83e2-1aad19836a06" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-11T18:28:58" date-modified="2009-08-11T18:28:58" approved="true" user-name="dario-g [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[Works great. Thanks :)]]></content>
        </comment>
        <comment id="41696fb3-5b34-4886-8be7-ee76108e8d49" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-12T14:48:31" date-modified="2009-08-12T14:48:31" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[Glad I could be of some help Dario ;-)]]></content>
        </comment>
        <comment id="5a2ec701-6b15-44ff-bf7f-736b36ce66aa" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-15T05:04:17" date-modified="2009-08-15T05:04:17" approved="true" user-name="Brian [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[Kudos - pretty decent improvement and fail-safe, if the config doesn't load for whatever reason, just discard it and create a new one.<br />
<br />
Thanks!]]></content>
        </comment>
        <comment id="76bf62a1-db0c-493f-9e78-d16ba9b5d84d" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-21T11:14:19" date-modified="2009-08-21T11:14:19" approved="true" user-name="Linda [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[This looks great, but I'm struggeling to get it to work.  Get an error that Nhibernate.Cfg.Configuration is not marked as serializable.]]></content>
        </comment>
        <comment id="6fd753aa-3bf2-4de9-9b30-3d38bbe662bc" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-29T16:31:07" date-modified="2009-08-29T16:31:07" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[That's odd, what version of nHibernate are you using.  The only thing I can think is that at some point Configuration was not serializable.]]></content>
        </comment>
        <comment id="19032fb7-759c-46bc-be42-b26d800f84aa" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-26T00:08:16" date-modified="2010-03-26T00:08:16" approved="true" user-name="Pavel Tisunov" user-email="tisunov.pavel@gmail.com" user-ip="95.32.122.23" user-url="">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[Great! Thank you very much, I was struggling to improve my app startup time and your solution gave me exactly what I was looking for!]]></content>
        </comment>
        <comment id="564756e1-3330-41a3-9abe-926f09d3141d" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-05-11T15:57:03" date-modified="2010-05-11T15:57:03" approved="true" user-name="Tuna Toksoz" user-email="tehlike@gmail.com" user-ip="217.131.182.30" user-url="http://tunatoksoz.com/">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[Well, it wasn't specific to Castle Project.
Hey! This post has more comments than my blogpost had! Great work!]]></content>
        </comment>
        <comment id="60faf962-25dd-4db7-9683-e7c247799116" parentid="564756e1-3330-41a3-9abe-926f09d3141d" date-created="2010-05-11T16:46:36" date-modified="2010-05-11T16:46:36" approved="true" user-name="Chris Nicola" user-email="chnicola@gmail.com" user-ip="209.17.159.3" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Speed up nHibernate startup with object serialization]]></title>
          <content type="text"><![CDATA[They are all just me using various fake e-mails.  It makes me happy ;-).  I think part of the problem might have been the really low SEO nhForge seemed to have at the time.  Not sure how much it has improved lately though.

You're right about it not being castle specific too, I don't know why I didn't see that at the time :-/.  You will have to excuse my naivety with Castle and all things nHibernate at the time, all of this was like months old to me and I was excited whenever I got anything new to work.

I guess for some reason I wasn't figuring out how to use your solution so I ended up coding my own, though I can't quite remember why anymore.  I am going to update this post to make a note about what a twit I am.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="ce0dcf05-ca64-4aca-8f25-76a43c7afa5e" date-created="2009-06-17T15:56:00" date-modified="2010-06-24T22:08:36" approved="true" post-url="/post/2009/06/17/Google-Analytics-Plugin-for-b2evolution-320.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Google Analytics Plugin for b2evolution 3.2.0]]></title>
      <content type="text"><![CDATA[<p>When I upgraded my blog software recently it broke the GA plugin I was using.  Which is sad cause I like to see all the pretty visitors.  I found a <a href="http://www.travisswicegood.com/index.php/2008/01/26/google-analytics-plugin-for-b2evolution">new plugin </a>that appeared to work shortly after, but for the past two weeks I have had no visiters (I know, sad panda <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_cry.gif" alt=":'(" />).</p>
<p>I eventually figured it out.  The new plugin I found however was also broken.&nbsp;  The plugin neglected (or google changed the script) to add brackets around the GA user number.  This was very small so it was hard to notice so I just assumed no one cared about my site (which is also entirely possible but there is no way to be sure when the plugin is broken).</p>
<p>There are several comments on the authors site with no answer so I assume he is not updating it at all anymore.  So I have taken it upon myself to fix the plugin as well as package it property (getting b2evo to recognize this plugin requires renaming the file as it was not properly named).&nbsp; GA plugins are not very complicatedso it isn't much of a change but I will make it available to download here for those who want a trouble free GA plugin for b2evo.</p>
<p>&nbsp;</p>
<p>Update: I have removed the download link as it is broken.&nbsp; I'm not actually sure if I still have the files or if it even works with the latest B2Evo.</p>]]></content>
      <post-name type="text"><![CDATA[Google Analytics Plugin for b2evolution 3.2.0]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <comments>
        <comment id="ac60f592-58bc-4e97-9a4e-f2dc7a467836" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-07T02:54:57" date-modified="2009-08-07T02:54:57" approved="true" user-name="Nicole Pereira [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Google Analytics Plugin for b2evolution 3.2.0]]></title>
          <content type="text"><![CDATA[might want to fix your plugin posting at b2e since it goes to your blog main page and not to this posting]]></content>
        </comment>
        <comment id="e67ef624-73ca-4ccc-a3db-6cca28128718" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-08-10T22:50:28" date-modified="2009-08-10T22:50:28" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Google Analytics Plugin for b2evolution 3.2.0]]></title>
          <content type="text"><![CDATA[Nicole, thanks for letting me know, but I can't edit the posting.  <br />
<br />
When you make a plugin submission, the b2evo guys approve and then post it.  Perhaps they made an error with the link (though perhaps it was me).  I also changed the url to these pages so that could have cause it too.<br />
<br />
I will see if I can get it fixed.  Thanks.]]></content>
        </comment>
        <comment id="2d8a4d05-9a15-4219-99ef-37e6240d2f5a" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-06-23T23:08:02" date-modified="2010-06-23T23:08:02" approved="true" user-name="Shai" user-email="shai@shaibn.com" user-ip="192.117.110.233" user-url="">
          <title type="text"><![CDATA[re: Google Analytics Plugin for b2evolution 3.2.0]]></title>
          <content type="text"><![CDATA[First, thanks for the plugin. I really found it odd that we don't have more of these and up-to-date for b2e. That's just sad.

When I try to download this plugin, I get a &quot;HTTP Error 404.0 - Not Found&quot;. Can you confirm the URL for googleanalytics_plugin.zip ?]]></content>
        </comment>
        <comment id="7c066ba3-aa6a-40f5-8f70-d53fefbeb608" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-06-23T23:18:06" date-modified="2010-06-23T23:18:06" approved="true" user-name="Shai" user-email="shai@shaibn.com" user-ip="192.117.110.233" user-url="">
          <title type="text"><![CDATA[re: Google Analytics Plugin for b2evolution 3.2.0]]></title>
          <content type="text"><![CDATA[I was sure I had posted a comment here just a moment ago :( I guess I didn't so I'll try again.

First of all, thanks for the plugin. That's a shame we don't have more of these that are up-to-date for b2e.

Further more, can you check the link to the .zip file because it seems to be broken.

Thanks in advance!]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="f556f362-5073-42e4-89ba-1d47d301da7d" date-created="2009-06-16T21:54:00" date-modified="2009-10-05T09:28:37" approved="true" post-url="/post/2009/06/16/Things-I-didnt-know-about-squid.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Things I didnt know about squid]]></title>
      <content type="text"><![CDATA[<p>Apparently the fish monger knows some things about squid anatomy I don't...</p>
<p>&nbsp;</p>
<div class="image_block"><img src="/media/blogs/general/IMGP0924.JPG" alt="" width="480" height="333" /></div>
<p>&nbsp;</p>
<p>I imagine that was a bit of an inside joke going on at the Salmon Shop that day.</p>
<p>&nbsp;</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/16/things-i-didnt-know-about-squid?blog=1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Things I didnt know about squid]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="60961e3d-020b-4362-8aad-91d6b33f1261" />
      </categories>
      <tags>
        <tag ref="Funny" />
      </tags>
    </post>
    <post id="ad84f4ca-c06b-44dd-85e4-9f767568d9e1" date-created="2009-06-15T01:39:00" date-modified="2009-12-03T10:45:56" approved="true" post-url="/post/2009/06/15/On-Irans-election-twitter-and-the-failure-of-western-media.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[On Iran's election, twitter, and the failure of western media]]></title>
      <content type="text"><![CDATA[<p>Wow, have I been out of touch for the past few days.  The Devteach and ALT.NET conferences kept so me busy,&nbsp; I had no idea that for the past two days there have been protesting, riots and violence in Iran over the apparently fraudulent Iranian election.&nbsp; Though I probably wasn't the only one, since apparently all of the major news networks had no idea either until recently.&nbsp; The twitterverse/blagosphere however took notice.</p>
<p>Many of the people in the Devteach and ALT.NET communities are big twitter users.&nbsp; I regularly use IRC (look it up) to network and have discussions with other developers in channels like ##csharp and #alt.net, however for some twitter is appears to be replacing IRC as their medium of choice (perhaps there isn't a good IRC app for the iPhone?).&nbsp; Sadly, I have caved and got a<a href="http://twitter.com/LucisFerre"> twitter account</a> and while looking around at the main twitter page I noticed that the majority of "tweets" (twits?) were directed at&nbsp; <a href="http://search.twitter.com/search?q=%23iranelection">#iranelection</a>.&nbsp; Go check it out it is pretty interesting, I have really spent absolutely no time looking at twitter at all, but this was eye opening.&nbsp; Many of these are coming directly from students currently surrounded by riot police.&nbsp; One of them has been posting pretty<a href="http://twitter.com/Change_for_Iran"> regular updates</a>.</p>
<p>The phenomenon of twitter in this context is interesting.&nbsp; It provides these protesters and students with a sense of solidarity with people far from them, at the same time though I find it slightly disturbing how people far removed (and likely with little understanding about the conflict) really feel like they are part of just just because they "tweet" about it.&nbsp; A reality check might be in order.</p>
<p>Almost as popular as #iranelection is <a href="http://search.twitter.com/search?q=%23cnnfail">#cnnfail</a> (as well as #msnbcfail and @abcfail, there is a #foxfail too, but seriously, who the hell cares about Fox?) filled with twitter vitrol at CNN for taking a full 48-hours to cover anything about what was happening in Iran.</p>
<p>Personally, I was not planning on paying much attention to the election in Iran.&nbsp; Regardless of the result, the "Supreme" leader will remain unchanged, although what supreme leader doesn't prefer having a puppet (I'm looking at you Putin...).&nbsp; Regardless, it appears the "dictator for life" saw fit to steal the election which, very fortunately, seems to have enraged much of the population who do believe there is hope for change without Ahmedi'Nijad.&nbsp; Unfortunately, totalitarian regimes don't respond very positively to grassroots movements for change.</p>
<p>These events, could mark a turning point for the country Iran and, quite possibly, also in the status of global social networking as a tool for global change, or they could just be yet another troubling chapter in a long history of totalitarian regimes using brute force and violence to maintain their power and control.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/14/on-iran-s-election-twitter-and-the-failure-of-western-media?blog=5">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[On Iran's election, twitter, and the failure of western media]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1b70b1a2-2a7c-4e85-a6ba-6accc0b980f8" />
      </categories>
      <tags>
        <tag ref="Politics" />
        <tag ref="Opinion" />
      </tags>
    </post>
    <post id="dc5f4c88-1f20-4294-a484-36f9528f0f95" date-created="2009-06-14T17:46:00" date-modified="2010-04-10T09:15:45" approved="true" post-url="/post/2009/06/14/Devteach-and-ALTNET-Canada-are-over.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Devteach and ALT.NET Canada are over]]></title>
      <content type="text"><![CDATA[<p>If I have been quiet lately it is because I have been in back-to-back conferences of Devteach and ALT.NET Canada since last Monday.  What spare time I had I used for sleeping, eating and trying to keep up on work.    The sessions were outstanding and it was also a valuable opportunity to finally meet other people in my industry.  I have left with a better understanding of concepts I was just starting to grasp, a mile long list of websites and books to read up on and more confidence in what I am doing.  I will try to condense some of what I have been learning into some new posts over the next few days in the hopes that it is useful both for myself and maybe others.  Thanks to everyone who organized and spoke at both conferences!</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/06/14/devteach-and-alt-net-canada-are-over">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Devteach and ALT.NET Canada are over]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="alt.net" />
        <tag ref="devteach" />
      </tags>
    </post>
    <post id="c9e952ed-2a19-43c6-a790-b6ecd3692aa5" date-created="2009-06-07T20:16:00" date-modified="2010-03-22T11:47:19" approved="true" post-url="/post/2009/06/07/Loading-RAW-files-in-Qtpfsgui-on-64-bit-windows.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Loading RAW files in Qtpfsgui on 64-bit windows]]></title>
      <content type="text"><![CDATA[<p>When I first downloaded Qtpfsgui for creating HDR images I had a problem where I could not load my camera's raw format images (Pentax PEF).  Qtpfsgui uses dcraw for loading RAW images and whenever it tried to load the PEF files Qtpfsgui spit out a misleading error that led me to believe that perhaps dcraw didn't support PEF files.  This was not the case, running dcraw directly from the command line gave me the answer I needed:  <code>This version of C:\Program Files (x86)\Qtpfsgui\dcraw.exe is not compatible with  the version of Windows you're running. Check your computer's system information  to see whether you need a x86 (32-bit) or x64 (64-bit) version of the program, and then contact the software publisher.</code> I solved this by downloading the DcrawMS.exe from <a href="http://www.insflug.org/raw/Downloads/">here</a> which works under 64-bit windows.  I put it in the Qtpfsgui folder, deleted dcraw.exe and renamed dcrawMS.exe -&gt; dcraw.exe so that Qtpfsgui would find the new version.  Worked like a charm, however the HDR wizard doesn't show a preview when importing PEF files.  Oh well, at least it is working for now.  If anyone else is trying to use Qtpfsgui under 64-bit Vista or Windows 7 I hope this is helpful.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/07/loading-raw-files-in-qtpfsgui-on-64-bit-windows?blog=6">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Loading RAW files in Qtpfsgui on 64-bit windows]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="b483fd48-b2f5-44af-b1ae-6fb4648d5bc2" />
      </categories>
      <tags>
        <tag ref="Photography" />
        <tag ref="HDR" />
      </tags>
      <comments>
        <comment id="a072a058-ce1b-4009-b332-81bfa0d4df58" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-06-17T20:55:00" date-modified="2009-06-17T20:55:00" approved="true" user-name="Marie [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Loading RAW files in Qtpfsgui on 64-bit windows]]></title>
          <content type="text"><![CDATA[your explanation was very helpful. I would like to know if there will be an upgrade eventually to see thumbnails with Vista 64<br />
<br />
Thank you greatly<br />]]></content>
        </comment>
        <comment id="85a0037c-224c-4b5a-99d5-855e6afd6e30" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-06-29T22:19:04" date-modified="2009-06-29T22:19:04" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: Loading RAW files in Qtpfsgui on 64-bit windows]]></title>
          <content type="text"><![CDATA[Your welcome, I'm not sure if they will be doing that soon as I am not an active contributor to the project.  I did send this to the maintainer who added it to the Wiki, so I know he is aware of it and it will probably get fixed in the next version.]]></content>
        </comment>
        <comment id="445d1e36-2878-4912-8d0f-96581da0e0b9" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-20T15:54:42" date-modified="2010-03-20T15:54:42" approved="true" user-name="qwertz" user-email="safasgaa@yahoo.de" user-ip="85.182.77.165" user-url="">
          <title type="text"><![CDATA[re: Loading RAW files in Qtpfsgui on 64-bit windows]]></title>
          <content type="text"><![CDATA[This doesn't work for me in 64-bit Windows 7. I tried replacing dcraw with dcrawms and I also tried compiling dcraw myself (with both GCC and Microsoft's compiler). Dcraw converts my raw files (DNG) alright, if run directly from the command line, but qtpfsgui still gives the error message. Any suggestions? Thanks!]]></content>
        </comment>
        <comment id="e605236e-9544-47ed-845a-7e437ba554a5" parentid="00000000-0000-0000-0000-000000000000" date-created="2010-03-20T16:00:38" date-modified="2010-03-20T16:00:38" approved="true" user-name="chrisn" user-email="chnicola@gmail.com" user-ip="174.6.66.116" user-url="http://www.lucisferre.net/">
          <title type="text"><![CDATA[re: Loading RAW files in Qtpfsgui on 64-bit windows]]></title>
          <content type="text"><![CDATA[Hmm, I haven't used qtpfsgui recently, so I don't know if anything has changed.  You made sure the rename the dcrawms.exe -&gt; dcraw.exe right?  Other than that I don't know what else to suggest.  You might try e-mailing the project maintainer.]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="fcaf347a-e5b4-4585-98a9-b91033b0f289" date-created="2009-06-04T22:45:00" date-modified="2009-12-02T13:08:07" approved="true" post-url="/post/2009/06/04/Persistence-Laws-Use-Surrogate-Keys.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Persistence Laws: Use Surrogate Keys]]></title>
      <content type="text"><![CDATA[<p>As I learned nHibernate, several sources recommended that one <em>always</em> use a surrogate primary key for all entities.&nbsp; I follow this rule strictly.  My personal preference now is to use the hilo identity generator nHibernate provides.</p>
<p>Today, I was working on updating values in a table from one of my first databases when the reason for this rule became very apparent.&nbsp; All I am trying to do here is update the folder locations in a table of file references.&nbsp; Here is a snippet of the code:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//Create a new file link and delete the old one</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//Have to do this cause I fail and was to stupid to use surrogate keys</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//I made the Filename the primary key... I mean they're unique right???</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">var</span> newfile = <span style="color: blue;">new</span> <span style="color: #2b91af;">Insurance_File</span></p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; Filename = fi.FullName.Replace(rootdir, newname),</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; fk_idPolicy = file.fk_idPolicy,</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; Policy = file.Policy</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; };</p>
<p style="margin: 0px; padding: 0px;">_datacontext.Insurance_Files.DeleteOnSubmit(file);</p>
<p style="margin: 0px; padding: 0px;">_datacontext.Insurance_Files.InsertOnSubmit(newfile);</p>
</div>
<p>&nbsp;</p>
<p>The problem here is fairly apparent.&nbsp;  Acting on the suggestions I had read in a number of blogs and guides on building relational database I chose to make the clearly unique field of the Filename a primary key.&nbsp; However, as a result I now have to delete each file entry and add a new one since one can't modify primary key values.</p>
<p>This is not a very efficient use of the database for this task.&nbsp; It is however a good example of why you should always use surrogate keys.  Oh, and yes, that is Linq2SQL I'm using not nHibernate.  It is just a quick one-off utility I needed to update with and I find linq2sql to be really quick to do things like this sometimes.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/06/04/persistence-laws-surruoate-keys">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Persistence Laws: Use Surrogate Keys]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
        <category ref="0ae10b56-7656-4192-bd7d-4aac5a14e403" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
      </tags>
    </post>
    <post id="90e0c645-c72c-4846-914e-ac2d3af2ad14" date-created="2009-06-02T15:46:00" date-modified="2009-10-05T09:26:08" approved="true" post-url="/post/2009/06/02/Creating-HDR-images-with-free-open-source-software.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Creating HDR images with free open-source software]]></title>
      <content type="text"><![CDATA[<p><a href="http://garmahis.com/tutorials/hdr-tutorial-free-software/">http://garmahis.com/tutorials/hdr-tutorial-free-software/</a></p>
<p>I am a big fan of free/OSS software.  Though it is not always the best, it is a testament to what interested and motivated people can do for others.  Many of the packages I've used provide amazing functionality for a price that literally can't be beat.  A few examples of top quality software are Open Office, the GIMP (GNU image manipulation program) a great alternative to photoshop and Mozilla Firefox.  There are many, many more though.</p>
<p>Now that I am spending more time doing photography again I have become interested in how to create High Dynamic Range images.  I was looking into tools to perform this and one of the most common is photomatix for $99 (which is honestly a very good price).  However still wanting to look into FOSS options I located QTPFSGUI (I think the worst thing about OSS software is the names sometimes <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" />).</p>
<p>The link above is to an excellent beginner tutorial to using QTPFSGUI + GIMP to create HDR images.&nbsp; The results are quite extreme actually as you can see in the tutorial.</p>
<p>I am planning to put together a few HDR processed images as soon as I have some decent bracketed photos and a tripod to take them on.&nbsp; I get a great view of the downtown skyline at night near where I am so I am hoping to produce some impressive HDR night shots of Vancouver for you all.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/06/02/creating-hdr-images-with-free-open-source-software?blog=6">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Creating HDR images with free open-source software]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="0ef29b7d-d0ff-4312-858e-fdc6791dd80b" />
      </categories>
      <tags>
        <tag ref="Photography" />
        <tag ref="HDR" />
      </tags>
    </post>
    <post id="c31c67b4-beab-4396-9a1c-b18667662d31" date-created="2009-05-31T01:21:00" date-modified="2009-10-05T09:44:00" approved="true" post-url="/post/2009/05/31/Downtown-Alleyway.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Downtown Alleyway]]></title>
      <content type="text"><![CDATA[<p><img style="max-width: 800px;" src="/media/blogs/photo/downtown_alley_blog.jpg" alt="" /></p>
<blockquote>Pentax K200D - f/11 - 1/180 - 55mm - ISO 400<br /></blockquote>
<p>I took this out downtown near Cambie and Hastings.&nbsp; There was a lot of color for an alleyway.&nbsp; I took some time to darken the shadows and saturate some of the color in the photo.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/05/30/downtown-alleyway?blog=6">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Downtown Alleyway]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="0ef29b7d-d0ff-4312-858e-fdc6791dd80b" />
        <category ref="b483fd48-b2f5-44af-b1ae-6fb4648d5bc2" />
      </categories>
      <tags>
        <tag ref="Photography" />
        <tag ref="Vancouver" />
      </tags>
    </post>
    <post id="5e58a90b-3981-4ecf-8fbd-25d25940fdc6" date-created="2009-05-30T21:27:11" date-modified="2009-09-19T15:40:09" approved="true" post-url="/post/2009/05/30/North-Vancouver-Sunset.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[North Vancouver Sunset]]></title>
      <content type="text"><![CDATA[<div class="image_block"><img src="/media/blogs/photo/Sunset_North_Van_Blog.jpg" alt="" width="640" height="430" /></div>
<p>&#160;</p>
<blockquote>Pentax K200D - f/8.0 - 1/250 - 28.1mm - ISO 100<br /></blockquote>
<p>A Picture I took on Sam's balcony in North Vancouver.  I retouched it a bit, increased the shadows a lot, brought up the highlights and saturation very slightly.  Just small changes in Google Picasa.  I actually like Google Picasa for retouching because it limits the adjustments and changes I can make.  If I was editing in Photoshop I'd probably be tweaking it for hours.</p><div class="item_footer"><p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/05/30/title?blog=6">Original post</a></small></p></div>]]></content>
      <post-name type="text"><![CDATA[North Vancouver Sunset]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="0a5ca7b4-d45c-4df1-9e90-8928262d248b" />
      </categories>
    </post>
    <post id="b98da56e-5b9d-4357-93b8-e0eb0674e617" date-created="2009-05-30T04:18:00" date-modified="2010-03-01T08:25:51" approved="true" post-url="/post/2009/05/30/WPF-TreeView-Its-The-Simple-Things.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[WPF TreeView: It's The Simple Things]]></title>
      <content type="text"><![CDATA[<p>I have generally found learning WPF very rewarding.  It is a significant improvement to UI development over the old WinForms approach.  That said you can tell it is new and it still needs a lot of work.  I often say that WPF makes complex things simple (spend some time with the MVVM pattern and you will beging to understand this) but often makes simple things &gt;:XX...</p>
<p>Today I ran into one of those simple things...</p>
<p>&nbsp;</p>
<p>The WPF TreeView like all WPF controls is very, very flexible in what you can do with it, how you can extend it, change the look, feel, etc.&nbsp; I have it currently being used as a data editing control.&nbsp; Each TreeViewItem displays a custom UserControl containing a set of editable TextBox and ComboBox controls whenever it is selected.&nbsp; The user can edit this data, and when it is deselected it will persist to the database via nHibernate.</p>
<p>One of my users noticed that whenever she presses the keypad's minus key (in .NET this is <code>Key.Subtract</code>) it collapses the current branch.&nbsp; Since this is an accounting applications, and hence, the users are accountants, they like to use the keypad to make decimal entries.&nbsp; So essentially this is preventing them from entering negative numbers in their standard way.</p>
<p>"No problem," I figured, I'm sure I can disable the keyboard navigation, or intercept the event or something like that with little trouble.</p>
<p>Turns out there is no way to quickly disable the TreeView's default navigation control.&nbsp;&nbsp; Even worse there doesn't even seem to be a way to customize it.&nbsp; A pretty glaring oversight in my opinion.&nbsp; You can see this discussed briefly here in this <a href="http://www.codeproject.com/KB/WPF/CustomTreeViewLayout.aspx">CodeProject article by Josh Smith</a>.&nbsp; He solves this by handling the <code>PreviewKeyDown </code>event.&nbsp; This has the unfortunate side-effect of disabling <em>all text entry</em> in the TreeView.&nbsp; Not a solution for a data entry control.</p>
<p>In the end I just had to handle the <code>PreviewKeyDown </code>even for the textboxes that handle the decimal inputs.&nbsp; This is by no means an ideal solution but it works.&nbsp; To get a good UI feel, you need to make sure it checks the current selection, cursor position and behaves as a user would expect it to.&nbsp; Here is the event handler:</p>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;summary&gt;</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: gray;">///</span><span style="color: green;"> Since TreeView is retarded, we need to insert a minus sign when the user uses the keypad this way</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;/summary&gt;</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;param name="sender"&gt;&lt;/param&gt;</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: gray;">///</span><span style="color: green;"> </span><span style="color: gray;">&lt;param name="e"&gt;&lt;/param&gt;</span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> txtAmount_PreviewKeyDown(<span style="color: blue;">object</span> sender, <span style="color: #2b91af;">KeyEventArgs</span> e)</p>
<p style="margin: 0px; padding: 0px;">{</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; <span style="color: blue;">if</span> (e.Key == <span style="color: #2b91af;">Key</span>.Subtract)</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; {</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">var</span> textbox = sender <span style="color: blue;">as</span> <span style="color: #2b91af;">TextBox</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> start = textbox.SelectionStart;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">int</span> end = start + textbox.SelectionLength;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> beginning = textbox.Text.Substring(0, start);</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="color: blue;">string</span> ending = textbox.Text.Substring(end, textbox.Text.Length - end);&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; textbox.Text = beginning + <span style="color: #a31515;">"-"</span> + ending;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; textbox.SelectionStart = start + 1;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; e.Handled = <span style="color: blue;">true</span>;</p>
<p style="margin: 0px; padding: 0px;">&nbsp;&nbsp;&nbsp; }</p>
<p style="margin: 0px; padding: 0px;">}</p>
</div>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/05/29/wpf-treeview">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[WPF TreeView: It's The Simple Things]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="WPF" />
      </tags>
    </post>
    <post id="ef843393-31c4-4042-82f3-5df89ef55085" date-created="2009-05-22T16:56:00" date-modified="2009-12-02T13:09:49" approved="true" post-url="/post/2009/05/22/Going-to-DevTeach-and-ALTNET-Vancouver-2009.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Going to DevTeach and ALT.NET Vancouver 2009]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.devteach.com/Index.aspx">http://www.devteach.com/Index.aspx</a></p>
<p>So I just found out about DevTeach this week thanks to <a href="http://ayende.com/Blog/archive/2009/05/20/dev-teach-vancouver-amp-alt.net-canada.aspx">Ayende</a>, which is both good and bad.&nbsp; Good, because I found out in time to register for what looks like an amazing event that will cover a lot of topics I am just starting to grasp like Inversion of Control and ORM.&nbsp; Bad, because I found out way too late for the early-bird discounts :-(.&nbsp; I did manage to find a $100 discount code though by googling for them so it wasn't all bad.</p>
<p>I plan to spend a lot of time in the Agile track sessions but there are some other sessions I will likely try to attend.&nbsp; I am torn between learning how to develop for the iPhone in .NET and attending Oren Eini's session on advanced IoC <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_confused.gif" alt=":-/" />.&nbsp; I will be attending the pre-conference workshop on <a href="http://www.devteach.com/PreConference.aspx#PreAgile">Agile, IoC and ORM</a> which Oren is co-presenting so perhaps I can use that as an excuse to satisfy my selfish desire to learn how to code for the iPhone (I don't even own one...<img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt=":roll:" />).</p>
<p>Right after DevTeach there is a free conference&nbsp; for Alt.NET (<a href="http://altnetconfcanada.com/home/index.castle">http://altnetconfcanada.com/home/index.castle</a>)&nbsp; I think there is still a lot of space to register and it is is <strong>free</strong>!</p>
<p>I expect it to be a busy week.</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/05/22/going-to-devteach-and-alt-net-vancouver-2009">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Going to DevTeach and ALT.NET Vancouver 2009]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="02e1c448-89bc-4ed3-b7eb-616a79502dec" />
        <category ref="2d8fc2fe-cb40-4d21-b2ec-5400c1693ff4" />
      </categories>
      <tags>
        <tag ref="devteach" />
        <tag ref="alt.net" />
      </tags>
    </post>
    <post id="98c0f43e-acc7-4005-9684-af27b5fc1318" date-created="2009-05-21T00:14:00" date-modified="2009-12-02T13:08:30" approved="true" post-url="/post/2009/05/21/Can-DateTime-spare-a-quarter.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Can DateTime spare a quarter?]]></title>
      <content type="text"><![CDATA[<p>Ok so this isn't really very impressive for a blog post, but I am curious if anyone has a more sensible way to do this.</p>
<p>The DateTime struct understands, seconds, minutes, hours, days, months, years, etc.  However, I find it kind of odd that the DateTime struct doesn't understand "quarters".  Quarters of a year are a common concept in any finance application and unlike weeks they are not all the same length.</p>
<p>What I need to determine is the start and end dates of the quarter for the current date minus one month.  There are a million ways I could do this:</p>
<ol>
<li>I could just have a helper class with the 4 start date of the quarter and have it do comparisons.  Seems a bit overkill to have a class. </li>
<li>I could just compare the DateTime.Month value to values 1, 4, 7, 10 to figure out which quarter I am in and then set the start and end dates.  This is nice and simple. </li>
<li> Instead I did this:</li>
</ol>
<div style="font-family: Courier New; font-size: 8pt; color: black; background: white; margin: 16px; padding: 8px;">
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//Get the previous month mod(3) (0,1,2) </span></p>
<p style="margin: 0px; padding: 0px;"><span style="color: blue;">var</span> monthInQuarter = (<span style="color: #2b91af;">DateTime</span>.Today.Month + 1) % 3;</p>
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//Set start and end dates</span></p>
<p style="margin: 0px; padding: 0px;">EndDate = <span style="color: #2b91af;">DateTime</span>.Today.AddDays(-(<span style="color: #2b91af;">DateTime</span>.Today.Day));</p>
<p style="margin: 0px; padding: 0px;"><span style="color: green;">//Start date is the first day of the beginning of the quarter</span></p>
<p style="margin: 0px; padding: 0px;">StartDate = EndDate.AddMonths(-1*monthInQuarter).AddDays(-(EndDate.Day-1));</p>
</div>
<p style="margin: 0px;">mmmmm... mod math ;-).&nbsp; Ok so it isn't that cool, but I'm sure I'm gonna need to use this again.</p>
<p style="margin: 0px;">Chris</p>
<p>Edit: Fixed my total failure with brackets <img class="middle" src="http://www.lucisferre.org/rsc/smilies/icon_confused.gif" alt=":-/" /></p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/05/20/can-datetime-spare-a-quarter-1">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[Can DateTime spare a quarter?]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="csharp" />
      </tags>
    </post>
    <post id="f926a1d0-735b-4eff-9bfa-9086ce8bbf5f" date-created="2009-05-19T19:42:00" date-modified="2009-12-03T10:42:27" approved="true" post-url="/post/2009/05/19/nHibernate-Linq-and-Queries.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[nHibernate, Linq and Queries]]></title>
      <content type="text"><![CDATA[<p style="text-align: justify;"><img style="float: left; margin: 5px;" src="/media/blogs/coding/NHibernate_2_logo.png" alt="" width="269" height="100" />I have been using nHibernate a lot in my latest project.  nHibernate is a persistence layer, it handles mapping of entities (objects) to a database or other storage medium.  In this case a SQLServer database.  I am not going to go into a big introduction to nHibernate here as there are many excellent resources for that available (<a href="http://blogs.hibernatingrhinos.com/">http://blogs.hibernatingrhinos.com/</a> for examples).</p>
<p style="text-align: justify;">Learning nHibernate initially wasn't very hard, in fact it really couldn't be much simpler.  Mastering nHibernate, and specifically the art of persistence and <a href="http://domaindrivendesign.org/">domain-driven design</a> has been more difficult.&nbsp; I have relied on several online blogs, one of them being <a href="http://ayende.com/Blog">Ayende Rahien's blog</a>.One specific problem has been exactly how best to seperate the program into layers, often called <a href="http://en.wikipedia.org/wiki/Separation_of_concerns">seperation of concerns</a>.&nbsp; This involves seperating out things like the Presentation/UI layer, the domain/model or sometimes "business" layer and the data access layer which typically handles persistence.&nbsp; A common sample of building an application this way using nHibernate is <a href="http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx">this sample </a>of "best practices" which is often used by people new to nHibernate as a starting.&nbsp; This was also what I used to learn with as well.</p>
<p style="text-align: justify;">Despite being very easy to understand an implement I I find this design lacking in ways I find hard to describe, needless to say I find it clunky in some respects which is why I was really interested by <a href="http://ayende.com/Blog/archive/2009/04/18/the-dal-should-go-all-the-way-to-ui.aspx#30325">this post</a> by Ayende.&nbsp; Ayende has argued a few times (and I am sure I will explain this poorly) that nHibernate really <em>is</em> the data layer and that building an entire data layer on top of nHibernate is overkill.</p>
<p style="margin: 0px; text-align: justify;">Anyways, I didn't want to refactor my entire program just yet to eliminate my DAL so instead, to try out this IQueryable approach I added a simple method to the&nbsp;<span style="color: #2b91af;">AbstractNHibernateDao</span>&lt;T&gt; class:</p>
<p style="margin: 0px; text-align: justify;">&nbsp;</p>
<div style="background: white none repeat scroll 0% 0%; font-family: Courier New; font-size: 10pt; color: black;">
<p style="margin: 0px;"><span style="color: #2b91af;"> 19</span> <span style="color: blue;">public</span> <span style="color: blue;">virtual</span> <span style="color: #2b91af;">IQueryable</span>&lt;T&gt; GetQuery()</p>
<p style="margin: 0px;"><span style="color: #2b91af;"> 20</span> {</p>
<p style="margin: 0px;"><span style="color: #2b91af;"> 21</span> <span style="color: blue;">return</span> (<span style="color: blue;">from</span> entity <span style="color: blue;">in</span> NHibernateSession.Linq&lt;T&gt;()</p>
<p style="margin: 0px;"><span style="color: #2b91af;"> 22</span> <span style="color: blue;">select</span> entity);</p>
<p style="margin: 0px;"><span style="color: #2b91af;"> 23</span> }</p>
</div>
<p style="text-align: justify;">This is basically a method using generics which returns a generic query from Linq2Nhibernate.&nbsp; It is very similar to Ayende's example, but it doesn't have any query logic.&nbsp; That is ok though since whatever asks for the query can easily extend the query using .Where()</p>
<p style="text-align: justify;">I am curious what people think about this approach.&nbsp; Is it sensible, or can you forsee pitfalls to it?</p>
<p style="text-align: justify;">-Chris</p>
<div class="item_footer">
<p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/05/19/nhibernate-linq-and-queries">Original post</a></small></p>
</div>]]></content>
      <post-name type="text"><![CDATA[nHibernate, Linq and Queries]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="5cd0be3a-3124-4224-9a21-46b4befb628f" />
      </categories>
      <tags>
        <tag ref="nHibernate" />
        <tag ref="linq" />
      </tags>
    </post>
    <post id="ff468039-e768-4de2-8662-5910a8ce3a00" date-created="2009-05-09T21:57:13" date-modified="2010-04-19T18:41:26" approved="true" post-url="/post/2009/05/09/Radio-in-Vancouver.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[Radio in Vancouver]]></title>
      <content type="text"><![CDATA[<div class="videoblock"><object data="http://www.youtube.com/v/GEI4U5KyAS0" type="application/x-shockwave-flash" wmode="transparent" width="425" height="350"><param name="movie" value="http://www.youtube.com/v/GEI4U5KyAS0"></param><param name="wmode" value="transparent"></param></object></div><p>I doubt there is much disagreement among Vancouverites that the local commercial radio stations are a pile of total crap.  However, this year we got a couple new stations and one of them has been real gem in what is the tailings pit of local <a href="http://www.youtube.com/watch?v=rBUr1pSWTVI">radio ga-ga</a>. <a href="http://thepeak.fm">The Peak FM</a>.  Radio in Vancouver has, historically, been a pretty little more than a disappointing collection of terrible stations with boring DJs playing largely the same top40 on repeat or some other crap. Sure, sometimes I'll tune into CITR (the University station) if they had a decent program on (but eclectic doesn't always mean "good").  The CBC can also be good if there is something interesting on.  Generally, if I'm in the car, I spend my time flipping between stations praying a decent song might be on something.  More often than not I found myself changing the station just because they were playing some seriously god-awful crap that I just couldn't listen to (*cough* Nickleback *cough*).  For some time now I have relied on internet music services and stations when I want to hear new music and bands including the excellent <a href="http://radio3.cbc.ca/">CBC Radio 3</a> podcasts and <a href="http://last.fm">Last.fm</a>.  If you have never heard of either of those I highly recommend checking them out.  Unfortunately, this isn't an option if I'm in the car (unless you have Sirius, in which case you can get Radio 3).  Recently Vancouver got two new stations.  The one everyone heard about was Virgin Vancouver.  Initially I was kind of excited for this.  I actually enjoyed Virgin UK via their internet stream (even if they tended to have a pretty repetitive playlist).  Despite my initial optimism, Virgin Vancouver has turned out to be <em>easily </em>the worst radio station Vancouver has ever had.  This is a significant achievement really, in Vancouver <em>worst radio station</em> is a highly coveted title <img src="http://www.lucisferre.org/rsc/smilies/icon_cool.gif" alt="&#66;&#41;" class="middle" />.    However, this story still has a happy ending for me.  In what was a pretty quiet start-up with very little fan-fare for a radio station the Pattison media group (who also own the local country radio station <img src="http://www.lucisferre.org/rsc/smilies/icon_rolleyes.gif" alt="&#58;&#114;&#111;&#108;&#108;&#58;" class="middle" />) started a new station called <a href="http://www.thepeak.fm">The Peak</a> (100.5 Mhz).  It was a completely new format for Radio in vancouver, playing indie music and local bands along with what is, generally speaking, a pretty decent playlist of other music.    Just a sample of some of the bands I've heard on the peak so far: I've heard Mother Mother, Yeah, Yeah, Yeahs, Kaiser Chiefs, Stars, Puscifer, Smiths, Dudes, Regina Spektor, etc., etc., etc.  Sure they play a few bands I honestly don't care for: Snow Patrol, Coldplay, MGMT and a few others, but it is a much smaller list.  So far I've actually been able to listen to it for hours without wanting to duct tape my radio to a hand grenade.  Ok, so maybe the bar for radio success in Vancouver isn't set very high, but still I have to say I've been pretty satisfied with the peak so far.  It's definitely worth a listen.</p><div class="item_footer"><p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/05/09/radio-in-vancouver?blog=1">Original post</a></small></p></div>]]></content>
      <post-name type="text"><![CDATA[Radio in Vancouver]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="38f5fc4d-2f6a-4f4d-9015-9d44ae6d607b" />
      </categories>
    </post>
    <post id="98164122-ad3d-40a1-9531-faebf83872f6" date-created="2009-05-09T18:49:03" date-modified="2010-02-24T13:44:55" approved="true" post-url="/post/2009/05/09/BCs-Single-Transferrable-Vote-(STV).aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[B.C.'s Single Transferrable Vote (STV)]]></title>
      <content type="text"><![CDATA[<p><a href="http://www.stv.ca/">http://www.stv.ca/</a></p><p>Well, it's election time in B.C. and instead of just voting for your MLA, this year we will also be voting on a referendum to reform our electoral system.  The proposal is to switch to a single transferable vote system.  Now as an ex-student of applied math this is pretty interesting for me.  Voting mechanisms are a subject of <a href="http://en.wikipedia.org/wiki/Game_theory">game theory</a> and are often studied in order to determine how much relative power a person's vote has in one or another <a href="http://en.wikipedia.org/wiki/Voting_system">voting system</a>.  The STV system is interesting because it is a kind of self-optimizing version of the voting game.  It automatically applies strategic voting decisions for each voter and all they have to do is <em>rank their candidates in preferential order</em>.  But wait! There's more!    Actually, they are changing more than the way we vote, they are making a substantial change to <em>who we vote for</em>.  Ridings are being grouped into districts and your vote will determine who is elected to a block of 2-7 seats depending on your district's population.  A pretty big change from voting for just one seat.  So if you are voting in this election (which you should be) it is probably worth your time to understand how this new proposed system works.  The STV referendum will likely be more significant to B.C. politics than who we actually elect on May 12th, so be sure to make your vote count.  You can find out more about how the system works <a href="http://www.stv.ca/learn">here</a>.  I found this flow chart to be quite useful though:  <img style="float: right;" src="http://www.stv.ca/sites/all/files/chart.png" alt="" width="250" height="348" /> For those still a bit confused the process is like this:</p>
<ol>
<li>Count the 1st choice votes for each candidate.</li>
<li>When any candidate reaches the minimum quota of votes required to guarantee a seat (which equals 1+ [totalvotes/(seats + 1)]) they are given a seat and any further votes for that person are redistributed to second choice candidate</li>
<li>If no candidates have enough votes for quota the lowest vote candidate is eliminated and their votes are redistributed to the second choice candidate</li>
</ol>
<p>There are two strategic decisions occurring in this process where your vote will be transferred.    The first is if you voted for a candidate that already has enough votes to win, then your vote is automatically transferred to your second choice.  Essentially your first choice already had made the quota so surplus votes are redistributed to their second choice candidate.  This part of the process is a bit weird for me though because it seems to imply that the result might depend on the order of the vote counting but maybe there is something I am not understanding here.   Now, this doesn't mean that if you vote Liberal and the Liberal candidate reaches quota your vote goes to the NDP candidate.  If you are a Liberal supporter you can select multiple Liberal candidates (remember there is more than one seat being voted on so there will typically be more than one candidate from a single party to vote for), when any one of them reaches the quota, the remaining votes can still be used by the next candidate.    The second situation is if you voted for someone who had no chance of winning then your vote is automatically applied to the next person on your list.  This avoids the need for so-called "strategic voting" as was advocated by groups hoping to topple the conservatives in the last election.  Strategic voting suggested that even if you support the Greens, vote Liberal in this riding because they have the best changes to beat the Conservative candidate.  With STV this process is applied automatically.  Finally, if you don't like the idea of your vote being transferred, simply choose only one candidate.  Your vote will go to that candidate and no other.  Of course, you run the risk of casting a wasted vote, but hey, that's your choice right?</p><div class="item_footer"><p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/05/09/b-c-s-single-transferrable-vote-stv?blog=5">Original post</a> blogged on <a href="http://b2evolution.net/">b2evolution</a>.</small></p></div>]]></content>
      <post-name type="text"><![CDATA[B.C.'s Single Transferrable Vote (STV)]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="1b70b1a2-2a7c-4e85-a6ba-6accc0b980f8" />
      </categories>
    </post>
    <post id="8f9f96ae-05d4-4e1d-a144-9e7d4e50477e" date-created="2009-05-08T22:55:20" date-modified="2010-03-01T16:04:58" approved="true" post-url="/post/2009/05/08/SVN-Trac-and-Windows-oh-my!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[SVN, Trac and Windows, oh my!]]></title>
      <content type="text"><![CDATA[<p>All I have to say is <img src="http://www.lucisferre.org/rsc/smilies/icon_wth.gif" alt="&#124;&#45;&#124;" class="middle" />.    While many of the linux based open source projects are able to run under Windows, and some even have slick installers, there always seems to be some degree of frustration involved in getting them to work.  I think it is some kind of punishment for using Windows to run these programs in the first place.  Typically, I would rarely bother but in some cases Windows is a requirement so I settle in for a good session of heavy googling and try to figure it out.  In this case what I wanted to do was get Trac setup with VisualSVN under windows so that it was integrated with VisualSVN and was able to use the VisualSVN configured NTLM authentication.  Shouldn't be too big a deal right...?   First google search turned up <a href="http://www.visualsvn.com/server/trac/">this</a>, perfect, piece of cake, for the most part.  You still have to configure trac through the command prompt, but generally that should be considered par for the course with these systems.  Only problem is that this link hasn't been updated in over a year and it doesn't work with the latest versions of VisualSVN and SVN.  Well no problem, I can probably figure this out, use the latest versions and get the latest version of Trac installed to boot, right?  Well, yes and no, there are a million issues with this.  Projects like this rely on a lot of bindings to get python to work with SVN, SVN to work with Trac, Apache to work with everything else, etc.  Long story short after about a day of tooling around with it I found a solution so for those of you crazy enough to want to have VisualSVN 1.7.1 working with Trac <em>and </em>NTLM here is my solution:  I won't even explain how to install VisualSVN.  It is dead simple and if you are having problems with that dare not to read on, this isn't for you.  Once you have VisalSVN installed and set up with the NTLM authentication we can start with Trac.</p>
<blockquote>Note: Make sure to set up at least one VisualSVN repository so we can test out trac.  Even better if you have an existing repository you can load into VisualSVN for the testing.</blockquote>
<p>The trac install instructions are actually a good place to start.  I recommend this <a href="http://trac.edgewall.org/wiki/TracOnWindows">page</a> from the Trac Wiki.  Follow the instructions making sure to choose a 2.5.x version of Python.  Once you have it set up use one of your VisualSVN repositories to test it out as follows:</p>
<ol>
<li>Create a root folder for your Trac projects like C:\Trac</li>
<li>Initialize the trac environment.  Go to the C:\Python25\Scripts folder (or wherever you installed it to) and do the following: <code>trac-admin C:\Trac\MyProjectName\ initenv</code></li>
<li>You will be asked a series of questions, enter your project name, select the default database, the svn repository option (also default) and the directory for your repository.  If you chose the defauly when setting up VisualSVN that should be C:\VisualSVN\MyProjectName\</li>
<li>Finally give yourself admin privledges: <code>trac-admin C:\Trac\MyProjectName permission add myusername</code></li>
</ol>
<p>Test it all out when you are done as the trac wiki suggests with the tracd server.  Make sure it works.  If it doesn't then you will have to figure out what is wrong because at this point you should be able to open up the trac page in a browser.  Now we don't want to use the tracd server we want to use VisualSVN's apache server instead so shut down tracd and we will set up VisualSVN's apache settings to work with our trac setup.  First we need to install mod_python which you can get <a href="http://apache.sunsite.ualberta.ca/httpd/modpython/win/3.3.1/">here</a>.  Get the one for apache 2.2 and python 2.5.  Before you install it, go to C:\Program Files\VisualSVN Server\ and create a folder called "modules" (if you installed elsewhere you know what to do <img src="http://www.lucisferre.org/rsc/smilies/icon_wink.gif" alt="&#59;&#41;" class="middle" />).  Now install mod_python and when it asks where apache is point it to your VisualSVN Server folder.  It will put the mod_python.so file in there.  Next we use the instructions from the VisualSVN trac page:</p>
<blockquote>Add following line at the top of file C:\Program Files\VisualSVN Server\httpd-wrapper.bat:  <code>set PYTHONHOME=C:\Python25</code> I'm not sure this is absolutely necessary but it is just a modification of the original instructions to fit the default python location (obviously if you have it installed somewhere else use that path).</blockquote>
<p>Also we need to add the following to the /conf/httpd-custom.conf file:</p>
<p>
<pre>LoadModule python_module "modules/mod_python.so"<br />LoadModule authz_user_module bin/mod_authz_user.so<br />&lt;location /trac&gt;<br /> SetHandler mod_python<br /> PythonInterpreter main_interpreter<br /> PythonHandler trac.web.modpython_frontend<br /> PythonOption TracEnvParentDir C:\Trac<br /> PythonOption TracUriRoot /trac<br /><br /> AuthName "Trac"<br /> AuthType Basic<br /> AuthBasicProvider visualsvn<br /> Require valid-user<br />&lt;/location&gt;</pre></p><br />

<p>If you have used different folder location for your trac folders then adjust as needed.    Now if you try to restart Visual SVN and go to the /trac/Myproject url on your VisualSVN http address you will get a SVN error from trac.  This is caused by an incompatibility between DLL versions in your version of the python-subvsion binding and the DLL in the apache version from VisualSVN (pretty stupid, I know).  This is fixed by copying the dll here:  <code>C:\Python25\Lib\site-packages\libsvn\libapr-1.dll</code> Into here:  <code>C:\Program Files\VisualSVN Server\bin</code> How did I find this?  After hours of googling a million potential solutions for this problem I came across this <a href="http://www.mail-archive.com/trac-users@googlegroups.com/msg06937.html">post</a>.  The first two items were not relevent to my problem, but the third one was right on the money.  Anyways, if you have followed these instructions so far you should be able to go to your VisualSVN URL and add /trac/MyProjectName and browse your SVN repository through Trac.  VisualSVN is promising an integrated plugin for trac (or trac like functionality) "soon".  Which could easily be never.  Until then this is one way to get it working "soon-er".</p>
<blockquote>Pro tip: Unless you absolutely need/want NTLM authentication and trac integrated with the VisualSVN apache server I suggest either using linux for this or install trac seperately using a trac stack (http://bitnami.org/stack/trac).  It will save a lot of headaches.</blockquote>

<blockquote>Update 24/07/2009: Ivan just posted below to let me know that they have updated the Visual SVN plugin for 2.0.  Go check it out and save yourself all this hassle ;-).</blockquote><div class="item_footer"><p><small><a href="http://74.220.215.57/~lucisfer/coding/index.php/2009/05/08/svn-trac-and-windows-oh-my">Original post</a></small></p></div>]]></content>
      <post-name type="text"><![CDATA[SVN, Trac and Windows, oh my!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="80a93719-d0b6-493d-a18c-d82537b759e3" />
      </categories>
      <comments>
        <comment id="4403f75a-5e64-49f4-b37b-50b0197c968f" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-06-04T12:35:29" date-modified="2009-06-04T12:35:29" approved="true" user-name="Markus [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[Seems I can't switch to page number 2 because I get redirected to the first page right away ;-) Would be really interested in finishing your article!<br />
<br />
Regards]]></content>
        </comment>
        <comment id="cb2ac616-4005-45c6-a699-896444bc2206" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-06-12T10:31:11" date-modified="2009-06-12T10:31:11" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[Odd, there may be some bugs when I upgraded the blog to b2evo 3.2.0 beta.  I will try removing the multipages.<br />
<br />
Thanks for reading ;-)]]></content>
        </comment>
        <comment id="7c14dbf1-8a30-432b-b8e7-35645c550933" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-09T12:12:28" date-modified="2009-07-09T12:12:28" approved="true" user-name="SimTex [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[This is a good guide, but I can't really get it to work after they updated svn to 1.6.3 even though I also updated visualSVN to 1.7.3 which supposely is also using svn 1.6.3. I installed updated python svn bindings as you said. And my tracd server works. But when i try to get it to work with visualsvn's apatche server I get the following error: <br />
Warning: Can't synchronize with the repository (Unsupported version control system "svn": "DLL load failed: The Request Procedure wasnt found" ). Look in the Trac log for more information.<br />
<br />
I tried to move around the dlls both from phyton25\lib\site-packages\libsvn\ to visualSVN server\bin and the other way around. Tried moving all dlls with arp in their name, but no luck. The dll's claim they have same version number but their sizes are different so it's really messed up. <br />
<br />
Do you have any good ideas?]]></content>
        </comment>
        <comment id="b5500a30-a0e8-4886-9b00-869170f99f9f" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-10T02:32:41" date-modified="2009-07-10T02:32:41" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[Yes this definitely isn't the best solution, ideally VisualSVN would have either its own issue tracking plugin or keep an up-to-date Trac plugin.<br />
<br />
Nevertheless this should still work.  I am currently using 1.7.1 right now though.  I will say that for ease of use getting a LAMP stack with Trac and SVN will save a ton of time.  If you really want NTAUTH integrated you can try to hook that up manually, apache does support it.<br />
<br />
I have to be honest, I have not been using Trac as much as I thought I would.  I still find it's SVN integration somewhat limited.  I would really like an issue tracking system more integrated with VisualSVN or AnkhSVN and Visual Studio, and at the moment Trac Explorer isn't quite cutting it for me.<br />
<br />
Sorry i can't be of more help.]]></content>
        </comment>
        <comment id="57dcc6d6-3820-4afc-9692-5e79f9e3cb5b" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-15T14:30:54" date-modified="2009-07-15T14:30:54" approved="true" user-name="Ivan Zhakov [Visitor]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[VisualSVN Team just updated Trac plugin and instruction for recently released VisualSVN Server 2.0:<br />]]></content>
        </comment>
        <comment id="f3bf31bd-6784-4423-8fd8-7e0e58e6aa9e" parentid="00000000-0000-0000-0000-000000000000" date-created="2009-07-18T20:58:10" date-modified="2009-07-18T20:58:10" approved="true" user-name="chrisn [Member]" user-email="" user-ip="" user-url="">
          <title type="text"><![CDATA[re: SVN, Trac and Windows, oh my!]]></title>
          <content type="text"><![CDATA[That's great to hear Ivan,  I will definitely check that out asap.  Any word on having some kind of integrated issue tracking just for VisualSVN?  I know it was mentioned once.  Would definitely be worth it even if it was for pay ;-).]]></content>
        </comment>
      </comments>
      <trackbacks />
    </post>
    <post id="af448c3e-bcbe-41c2-8281-c2de380ce566" date-created="2009-05-08T22:15:51" date-modified="2010-03-17T08:41:00" approved="true" post-url="/post/2009/05/08/First-Post!.aspx" type="normal" hasexcerpt="false" views="0" is-published="True">
      <title type="text"><![CDATA[First Post!]]></title>
      <content type="text"><![CDATA[<p>Ok this is getting kind of cliche.  Every time I do a new blog (rarely) I do one of these posts and call it "first post" (it's a meme, look it up <img src="http://www.lucisferre.org/rsc/smilies/icon_wink.gif" alt="&#59;&#41;" class="middle" />).  Anyways, I am hoping this blog is finally a bit more permanent.  I went and got some hosting space months ago and just didn't get around to using it till now.  I have a ton of stuff I want to get up here now though, so expect the posts to be frequent for a while.  I have been doing some software design in C# and Visual Studio (among other things) for the past year or so and I have found other programmer's blogs invaluable in the process of learning.  I felt it was time I contributed to that community.  I also will put in some generic bloging in Vancouver type posts (in general...) some stuff on politics and other argumentative bull (polemics) and I am gonna put together a photoblog for some of my photos.  I generally find it hard to come up with names for things.  Once I have one even if I am not totally sold on it I usually stick with it and use it over and over again.  For example, my gaming pseudonym: Seipher/seiph3r, which came from FFVIII but it really isn't that I thought Seipher was an awesome character, I just like the name and the spelling.  I used to go by lucif3r in some FPS games, and that is to some degree where I got the domain name for the site. <em> Lucis</em> (light) and <em>ferre</em> (to carry or bring) are the latin orgins of the name of the angel Lucifer, bringer of light.  As I understand it, the word light in this sense actually implies knowledge or enlightenment.  I always thought it interesting, that in the biblical story of Genesis how blatently it defines human knowledge as original sin.  Though I digress, I am not going to get into a lot of Religious analysis here, I just found the idea interesting and hence I like the name and what it implies (in the literal sense, there is no Satan worshiping going on around here...<img src="http://www.lucisferre.org/rsc/smilies/icon_crazy.gif" alt="&#58;&#99;&#114;&#97;&#122;&#121;&#58;" class="middle" />)  Anyways, the site name is lucisferre.org (.com was <a href="http://www.lucisferre.com">taken (what the hell is this?)</a><img src="http://www.lucisferre.org/rsc/smilies/icon_confused.gif" alt="&#58;&#45;&#47;" class="middle" />) and while some may find the name odd or offensive, it's mine now and I'm sticking with it.  Now I just hope that this site will live up to its meaning.  -Chris</p><div class="item_footer"><p><small><a href="http://74.220.215.57/~lucisfer/index.php/2009/05/08/first-post?blog=1">Original post</a></small></p></div>]]></content>
      <post-name type="text"><![CDATA[First Post!]]></post-name>
      <authors>
        <author ref="chrisn" />
      </authors>
      <categories>
        <category ref="69991539-4bfc-4cb9-a66d-09f836c0b344" />
      </categories>
    </post>
  </posts>
</blog>
